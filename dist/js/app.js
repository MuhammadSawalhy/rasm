!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PLOTTO=t()}(this,(function(){"use strict";function generateName(){return(Date.now()+generateName.randomNameNum++).toString(36)}generateName.randomNameNum=0;let mathFunc={log:function(e,t=10){return Math.log10(e)/Math.log10(t)},ln:e=>Math.log(e,Math.E),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),sinh:e=>(Math.exp(e)-Math.exp(-e))/2,cosh:e=>(Math.exp(e)+Math.exp(-e))/2,tanh:e=>Math.sinh(e)/Math.cosh(-e),asinh:e=>Math.log,acosh:e=>(Math.exp(e)+Math.exp(-e))/2,atanh:e=>Math.sinh(e)/Math.cosh(-e),gcd:(...e)=>{let t=Math.abs(e[0]),s=Math.abs(e[1]);if(t%1!=0||s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s);for(let i=2;i<e.length;i++){if(s=Math.abs(e[i]),s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s)}return t},gcd2:(e,t)=>(e=Math.abs(e),0===(t=Math.abs(t))||0===e||e===t?e:e%t==0?t:e-t>t?Math.gcd(e-t,t):Math.gcd(t,e-t)),lcm:(...e)=>{let t,s=1;for(let i=0;i<e.length;i++){if(t=e[i],t%1!=0)return NaN;s*=t}return Math.abs(s)/Math.pow(Math.gcd(...e),e.length-1)},mod:(e,t)=>e%t};Object.assign(Math,mathFunc);let vars$1={pi:Math.PI,e:Math.E};function getJSfunction(e,t,s=!0){return e instanceof Function?e:e instanceof MagicalParser.Node?MathPackage.Parser.parsedTOjsFunction(e,t):MathPackage.Parser.maximaTOjsFunction(e,t,s)}Object.assign(Math,vars$1);class GraphChild$1{constructor(e){this.checkOptions(e),e.id||(e.id=generateName()),e.handlers=e.handlers||{},e.renderable=!e.hasOwnProperty("renderable")||e.renderable,this.sketch=e.sketch,Object.assign(this,e),this.gs=this.sketch.gs,this.gs.childrenIDs.push(e.id)}checkOptions(e){let t;if(!e.sketch)throw t="sketch",new Error("Your options passed to the shetchChild is not valid, it doesn't has sketch property, or it is falsy value")}get id(){return this._id}set id(e){this._id=this.sketch.gs.checkId(e)}render(e,t=[]){this.handlers.onrender&&this.handlers.onrender(...t)}remove(e){this.sketch.children.delete(this.id),this.gs.childrenIDs=this.gs.childrenIDs.filter(e=>e!==this.id),this.handlers.remove&&this.handlers.remove(...e)}error(e){this.handlers.onerror(e)}}class Canvas{constructor(e={}){if(this.elt=e.canvas||document.createElement("canvas"),this.ctx=this.elt.getContext("2d"),e.parent&&(e.parent.appendChild(this.elt),this.elt.width=e.parent.clientWidth,this.elt.height=e.parent.clientHeight),e.attributes)for(let t in e.attributes)this.elt.setAttribute(t,e.attributes[t]);this.font={width:15,family:"Arial"}}get width(){return this.elt.width}get height(){return this.elt.height}resize(e,t){this.elt.width=e,this.elt.height=t}clear(e){e?(this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.elt.clientWidth,this.elt.clientHeight)):this.ctx.clearRect(0,0,this.elt.width,this.elt.height)}setFont(e){e.size&&(this.font.size=e.size),e.family&&(this.font.family=e.family),this.ctx.font=`${this.font.size}px ${this.font.family}`}measureString(e){let t=this.ctx.measureText(e);return t.height=this.font.size,t}line(e,t,s,i){this.ctx.moveTo(e,t),this.ctx.lineTo(s,i)}ellipse(e,t,s,i,n=0,a=0,r=2*Math.PI,o=!1){i=i||s,this.ctx.beginPath(),this.ctx.ellipse(e,t,s,i||s,n,a,r,o),this.ctx.fill(),this.ctx.stroke()}}class pen{constructor(e,t=1,s="solid"){this.color=e,this.weight=t,this.style=s}setup(e){(e=e instanceof Canvas?e.ctx:e).strokeStyle=this.color.toString(),e.lineWidth=this.weight}}class color{constructor(e,t,s,i){this.r=e,this.g=t,this.b=s,this.a=i}brightness(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,n=e;return t>i&&(i=t),s>i&&(i=s),t<n&&(n=t),s<n&&(n=s),(i+n)/2}hue(){if(this.r==this.g&&this.g==this.b)return 0;let e=this.r/255,t=this.g/255,s=this.b/255,i=0,n=e,a=e;t>n&&(n=t),s>n&&(n=s),t<a&&(a=t),s<a&&(a=s);let r=n-a;return e==n?i=(t-s)/r:t==n?i=2+(s-e)/r:s==n&&(i=4+(e-t)/r),i*=60,i<0&&(i+=360),i}saturation(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,n=e;return t>i&&(i=t),s>i&&(i=s),t<n&&(n=t),s<n&&(n=s),i==n?0:(i+n)/2<=.5?(i-n)/(i+n):(i-n)/(2-i-n)}isDark(){return!(this.brightness()>.4)}toArray(){return[this.r,this.g,this.b,this.a]}toString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}}class colorPackage{static brightness(e){let t=e.r/255,s=e.g/255,i=e.b/255,n=t,a=t;return s>n&&(n=s),i>n&&(n=i),s<a&&(a=s),i<a&&(a=i),(n+a)/2}static hue(e){if(e.r==e.g&&e.g==e.b)return 0;let t=e.r/255,s=e.g/255,i=e.b/255,n=0,a=t,r=t;s>a&&(a=s),i>a&&(a=i),s<r&&(r=s),i<r&&(r=i);let o=a-r;return t==a?n=(s-i)/o:s==a?n=2+(i-t)/o:i==a&&(n=4+(t-s)/o),n*=60,n<0&&(n+=360),n}static saturation(e){let t=e.r/255,s=e.g/255,i=e.b/255,n=t,a=t;return s>n&&(n=s),i>n&&(n=i),s<a&&(a=s),i<a&&(a=i),n==a?0:(n+a)/2<=.5?(n-a)/(n+a):(n-a)/(2-n-a)}static isDark(e){return!(colorPackage.brightness(e)>.35)}static randomColor(){return new color(MathPackage.Core.random(255),MathPackage.Core.random(255),MathPackage.Core.random(255))}static randomDarkColor(){let e=colorPackage.randomColor();do{e=colorPackage.randomColor()}while(!e.isDark());return e}static randomLightColor(){let e=colorPackage.randomColor();do{e=colorPackage.randomColor()}while(e.isDark());return e}}function measureString(e){return canvas.elt.getContext("2d").measureText(e)}var drawing$1=Object.freeze({__proto__:null,pen:pen,color:color,colorPackage:colorPackage,measureString:measureString});class Xfunction extends GraphChild$1{constructor(e){let t;if(t="expr",!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has expr property, or it is falsy value");if(!e.pen){let t=e.sketch.coor.coorSettings.background.isDark()?drawing$1.colorPackage.randomLightColor():drawing$1.colorPackage.randomDarkColor();t.a=155,e.pen=new drawing$1.pen(t,2)}super(e),this.expression=getJSfunction(this.expr,["x"],!0)}static fromString(e,t){if(str.replace(/==+/,"").indexOf("=")>-1)throw new Error('there is "=" opertor!');return new Xfunction({expr:e,sketch:t})}async render(e){if(this.renderable)try{let t,s,i,n,a=e.ctx;a.strokeStyle=this.pen.color.toString(),a.lineWidth=this.pen.weight,a.beginPath();for(let e=this.gs.viewport.xmin;e<=this.gs.viewport.xmax;e+=this.gs.drawingStep){t=this.gs.coorTOpx(e,this.expression(e)),i=this.gs.coorTOpx(e-this.gs.drawingStep/2,this.expression(e-this.gs.drawingStep/2)),!isNaN(t.x)&&!isNaN(t.y)&&Math.abs(t.x)<1e5&&Math.abs(t.y)<1e5&&(n&&(Math.sign(t.y-i.y)===Math.sign(i.y-s.y)||Math.abs(t.y-s.y)/this.gs.drawingStep<20)||!n)?(n?a.lineTo(t.x,t.y):a.moveTo(t.x,t.y),s={x:t.x,y:t.y},n=!0):n&&(a.stroke(),a.beginPath(),n=!1)}a.stroke()}catch(e){this.error(e)}this.handlers.onrender&&this.handlers.onrender(...handlerArgs)}toString(){return this.expression}}class XYfunction extends GraphChild$1{constructor(e){let t;if(t="expr",!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has expr property, or it is falsy value");if(!e.pen){let t=e.sketch.coor.coorSettings.background.isDark()?drawing$1.colorPackage.randomLightColor():drawing$1.colorPackage.randomDarkColor();t.a=155,e.pen=new drawing$1.pen(t,2)}super(e),this.expression=getJSfunction(this.expr,["x"],!0)}static fromString(e,t){if(str.replace(/==+/,"").indexOf("=")>-1)throw new Error('there is "=" opertor!');return new XYfunction({expr:e,sketch:t})}async render(e){if(this.renderable)try{let t,s,i,n,a=e.ctx;a.strokeStyle=this.pen.color.toString(),a.lineWidth=this.pen.weight,a.beginPath();for(let e=this.gs.viewport.xmin;e<=this.gs.viewport.xmax;e+=this.gs.drawingStep){t=this.gs.coorTOpx(e,this.expression(e)),i=this.gs.coorTOpx(e-this.gs.drawingStep/2,this.expression(e-this.gs.drawingStep/2)),!isNaN(t.x)&&!isNaN(t.y)&&Math.abs(t.x)<1e5&&Math.abs(t.y)<1e5&&(n&&(Math.sign(t.y-i.y)===Math.sign(i.y-s.y)||Math.abs(t.y-s.y)/this.gs.drawingStep<20)||!n)?(n?a.lineTo(t.x,t.y):a.moveTo(t.x,t.y),s={x:t.x,y:t.y},n=!0):n&&(a.stroke(),a.beginPath(),n=!1)}a.stroke()}catch(e){this.error(e)}this.handlers.onrender&&this.handlers.onrender(...handlerArgs)}toString(){return this.expression}}class Point extends GraphChild$1{constructor(e){let t;if(e.pen=e.pen||new drawing.pen(new drawing.color(0,0,255),10),t="x",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="y",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");super(e),this.x=getJSfunction(this.x),this.y=getJSfunction(this.y)}static fromString(e,t){if(e){let s,i=/^\s*\(\s*(.+?)\s*,\s*(.+?)\s*\)\s*$/;if(e.replace(i,(e,i,n)=>{s=new Point({sketch:t,x:i,y:n})}),s)return s;throw new Error("error while trying to add a point: "+e)}throw new Error("your str is empty :'(")}async render(e,t=[]){if(this.renderable){switch(this.pen.style){case"solid":e.strokeWeight(2),e.stroke(200),e.fill(...this.pen.color.toArray().splice(0,3),150);break;case"shallow":e.ctx.lineWidth=3,e.ctx.strokeStyle(this.pen.color.toString()),e.ctx.fillStyle(this.sketch.coor.coorSettings.background.toString())}let t=this.gs.coorTOpx(this.x.eval(),this.y.eval());e.ellipse(t.x,t.y,this.pen.weight,this.pen.weight)}this.handlers.onrender&&this.handlers.onrender(...t)}toString(){return`(${this.x}, ${this.y})`}}class EvalExpr extends GraphChild$1{constructor(e){let t;if(t="expr",!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has expr property, or it is falsy value");super(e),this.expr.check({type:"operator",name:"="})?this.eval=new Function("return "+MathPackage.Parser.__generateJS(this.expr.args[0])+" === "+MathPackage.Parser.__generateJS(this.expr.args[1])):this.evalFunc=getJSfunction(this.expr)}static fromString(e,t){if(e)return new EvalExpr({expr:expr});throw new Error("your expression is empty :'(")}eval(){try{return this.evalFunc()}catch(e){this.error(e)}}}class Variable extends GraphChild$1{constructor(options){let propName,funcBody;if(propName="id",!options[propName])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(propName="value",!options[propName])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(super(options),!this.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${this.id} is invalid.`);funcBody=this.value.check({type:"operator",name:"="})?MathPackage.Parser.__generateJS(this.expr.args[0])+" === "+MathPackage.Parser.__generateJS(this.expr.args[1]):MathPackage.Parser.__generateJS(this.value),eval(`this.value = {func: ()=>${funcBody}, valueOf: function(){return this.func();}};`),Math[this.id]=this.value}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}remove(){delete Math[this.id],this.sketch.children.delete(this.id),this.gs.childrenIDs=this.gs.childrenIDs.filter(e=>e!==this.id),this.handlers.remove&&this.handlers.remove(...handlerArgs)}}class Empty extends GraphChild$1{constructor(e){super(e)}}class Slider extends GraphChild$1{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="value",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(super(e),!this.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${this.id} is invalid.`);Math[this.id]=this.value}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}remove(){delete Math[this.id],this.sketch.children.delete(this.id),this.gs.childrenIDs=this.gs.childrenIDs.filter(e=>e!==this.id),this.handlers.remove&&this.handlers.remove(...handlerArgs)}}class ChildControl{constructor(e){this.elt=document.createElement("div"),this.elt.innerHTML=`\n      <li class="control" id="${this.id}">\n        <div class="side-status" cancel-move>\n          <div class="order-container">\n            <span class='order'>12</span>\n          </div>\n        </div>\n        <div class="main" cancel-move cancel-hiding-keypad>\n         <div class=script-container><span type="text" class="script"></span></div>\n        </div>\n        <div class="side-ctrl">\n          <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n          <span class="move">\n            <div>\n              <span>..</span>\n              <span>..</span>\n              <span>..</span>\n            </div>\n          </span>\n        </div>\n      </li>\n      `,this.elt=this.elt.childNodes[1],this.graphChild=e||new Empty({sketch:mySketch}),this.__updateElts(null,this.graphChild),this.setEvents()}get id(){return this._id}set id(e){this._id=e,this.elt.id=e}get graphChild(){return this._graphChild}set graphChild(e){e.handlers.onremove=e=>{e&&this.remove(!1)},e.handlers.onerror=e=>{this.error(e)},e.control=this,mySketch.children.set(e.id,e),this._graphChild=e,this.id=e.id}setEvents(){let e=this.elt.querySelector(".script");this.removeELT=this.elt.querySelector(".remove"),this.orderELT=this.elt.querySelector(".order");let t=MQ.MathField(e,{handlers:{edit:()=>{this.update(t.latex())},enter:()=>{addControl(new ChildControl,parseInt(this.orderELT.textContent))}}});this.mathField=t,this.elt.querySelector(".main").addEventListener("focusin",e=>{this.focus(!1)}),this.elt.querySelector(".main").addEventListener("focusout",e=>{this.blur(!1)}),this.removeELT.addEventListener("click",e=>{this.remove()})}update(e,t){if(!this.disableHandling&&!t){try{this._graphChild.remove();let t=this._graphChild;if(""===e)this.parsedScript=new MagicalParser.Node(""),this.graphChild=new Empty({sketch:mySketch});else{if(mySketch.gs.childrenIDs=mySketch.gs.childrenIDs.filter(e=>e!==this.id),e&&(this.parsedScript=null,this.parsedScript=mySketch.scriptParser.parse(MathPackage.Parser.latexTOmaxima(e))),!this.parsedScript)return;let t={};this.graphChild&&this.graphChild.pen&&(t.pen=this.graphChild.pen),this.graphChild=mySketch.childFromParsed(this.parsedScript,t)}this.__updateElts(t,this.graphChild),this.__checkVars(),this.__checkFunctions()}catch(e){this.error(e)}this.__updateDependants(),mySketch.update()}}__getAll(e,t={}){let s=[];if(e.check(t))return[e];for(let i=0;i<e.args.length;i++)s=s.concat(this.__getAll(e.args[i],t));return s}__checkVars(){let e=this.__getAll(this.parsedScript,{type:"variable"});this.vars=e;let t=[];if(this.graphChild instanceof Xfunction||this.graphChild instanceof XYfunction)for(let s=0;s<e.length;s++)Math.hasOwnProperty(e[s].name)||"x"===e[s].name||"y"===e[s].name||t.find(t=>t.name===e[s].name)||t.push(e[s]);else for(let s=0;s<e.length;s++)Math.hasOwnProperty(e[s].name)||this.graphChild instanceof Xfunction&&"x"===e[s].name||t.find(t=>t.name===e[s].name)||t.push(e[s]);if(this.varsNotExist&&this.varsNotExist.length>0&&(this.elt.querySelector(".main .vars-not-exist").remove(),this.varsNotExist=[],this.isError&&(this.elt.classList.remove("error"),this.elt.querySelector(".error-elt").remove(),this.isError=!1)),t.length>0){let e=$(`\n               <div class='vars-not-exist'>\n                  ${t.reduce((e,t)=>e+`<button class="var">${t.name}</button>`,"")}\n               </div>\n               `);throw $(".var",e).bind("click",(function(){alert("adding new var called: "+this.innerText)})),this.elt.querySelector(".main").append(e[0]),this.varsNotExist=t,this.graphChild.renderable=!1,new Error("Undefined vars ["+t.reduce((e,t)=>e+`${t.name}, `,"").slice(0,-2)+"], click the button to define.")}this.graphChild.renderable=!0}__checkFunctions(){let e=this.__getAll(this.parsedScript,{type:"function"});this.funcs=e;let t=[];for(let s=0;s<e.length;s++)Math.hasOwnProperty(e[s].name)||this.graphChild instanceof Xfunction&&"x"===e[s].name||t.find(t=>t.name===e[s].name)||t.push(e[s]);if(this.funcsNotExist&&this.funcsNotExist.length>0&&(this.elt.querySelector(".main .funcs-not-exist").remove(),this.funcsNotExist=[],this.isError&&(this.elt.classList.remove("error"),this.elt.querySelector(".error-elt").remove(),this.isError=!1)),t.length>0){let e=$(`\n               <div class='funcs-not-exist'>\n                  ${t.reduce((e,t)=>e+`<button class="var">${t.name}</button>`,"")}\n               </div>\n               `);throw $(".var",e).bind("click",(function(){alert("adding new var called: "+this.innerText)})),this.elt.querySelector(".main").append(e[0]),this.funcsNotExist=t,this.graphChild.renderable=!1,new Error("Undefined functions ["+t.reduce((e,t)=>e+`${t.name}, `,"").slice(0,-2)+"], click the button to define.")}this.graphChild.renderable=!0}__updateDependants(){if(this._graphChild instanceof Variable||this._graphChild instanceof Slider){let e=mySketch.children.size;mySketch.children.forEach(t=>{e--,e<0||t&&t!==this._graphChild&&t.control.vars&&t.control.vars.find(e=>this._graphChild.id===e.name)&&t.control.update()})}else if(this._graphChild instanceof Function){let e=mySketch.children.size;mySketch.children.forEach(t=>{e--,e<0||t&&t!==this._graphChild&&t.control.vars&&t.control.functions.find(e=>this._graphChild.id===e.name)&&t.control.update()})}}setScript(e,t=!0){t||(this.disableHandling=!0),this.mathField.latex(e),t||(this.disableHandling=!1)}focus(e=!0){keypadSettings.focusedControl&&keypadSettings.focusedControl!==this&&keypadSettings.focusedControl.blur(),keypadSettings.focusedControl=this,keypadSettings.mathField=this.mathField,e&&this.mathField.focus(),this.elt.classList.add("focus")}blur(e=!0){e&&this.mathField.blur(),this.elt.classList.remove("focus")}error(e){this.isError&&this.elt.querySelector(".error-elt").remove(),this.elt.classList.add("error"),this.isError=!0,this.graphChild.renderable=!1;let t=$('\n      <div class="error-elt">\n         <i class="fas fa-bug"></i>\n      </div>\n      ');t.balloon({html:!0,contents:e.message,minLifetime:1e3,css:{"font-size":"1em"}}),t.hide(),this.elt.querySelector(".side-status").append(t[0]),t.fadeOut(0).delay(200).fadeIn(500)}remove(e=!0){removeControl(this),e&&(this.graphChild&&this.graphChild.remove(),this.__updateDependants()),mySketch.update()}__updateElts(e,t){this.isError&&(this.elt.classList.remove("error"),this.elt.querySelector(".error-elt").remove(),this.isError=!1),t&&(t instanceof Empty?this.__toEmpty():t instanceof Xfunction?e instanceof Xfunction?this.__updateXfunction():this.__toXfunction():t instanceof EvalExpr?e instanceof EvalExpr?this.__updateEvalExpr():this.__toEvalExpr():t instanceof Variable?e instanceof Variable?this.__updateVariable():this.__toVariable():t instanceof Slider&&(e instanceof Slider?this.__updateSlider():this.__toSlider()))}__toEmpty(){this.elt.type="Xfunction";this.elt.querySelector(".side-status");this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()})}__toXfunction(){this.elt.type="Xfunction";let e=this.elt.querySelector(".side-status");this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()}),e.append($('<div class="visible special-elt"><div class="inner"></div></div>')[0]),this.__updateXfunction()}__updateXfunction(){this.elt.querySelector(".side-status").querySelector(".visible").setAttribute("style",`--color: ${this.graphChild.pen.color.toString()}`)}__toEvalExpr(){this.elt.type="EvalExpr",this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()});let e=$('<div class="value special-elt"><span></span></div>');e.hide(),this.elt.querySelector(".main").append(e[0]),e.fadeIn();let t=$('<div class="value-type special-elt" type=decimal>\n            <span><i class="fas fa-divide"></i></span>\n         </div>');this.elt.querySelector(".side-status").append(t[0]),t.click(()=>{switch(t.attr("type")){case"decimal":t.attr("type","fract"),e.height(56);break;case"fract":t.attr("type","quotient"),e.height(56);break;case"quotient":t.attr("type","decimal"),e.height(33)}this.__updateEvalExpr()}),this.specialProps={valueType:t[0],valueElt:e[0]},this.graphChild.handlers.onrender=()=>{this.__updateEvalExpr()}}__updateEvalExpr(){this.graphChild.handlers.onrender=()=>{this.__updateEvalExpr()};try{let e=this.graphChild.eval();if(isNaN(e))throw new Error("error on evaluating, it seems to be cause by undefined variable.");switch(e+=0,this.specialProps.valueType.getAttribute("type")){case"decimal":this.specialProps.valueElt.innerHTML=`<span>${e}</span>`;break;case"fract":{let t=MathPackage.Core.fraction(e);1===t.denominator?this.specialProps.valueElt.innerHTML=`<span>${t.numerator}</span>`:(this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}break;case"quotient":{let t=MathPackage.Core.quotientRemainder(e);0===t.numerator?this.specialProps.valueElt.innerHTML=`<span>${t.quotient}</span>`:(0==t.quotient?this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`:this.specialProps.valueElt.innerHTML=`<span>${t.quotient}\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}}}catch(e){this.specialProps.valueElt.innerHTML="<span>NaN</span>",this.error(e)}}__toSlider(){this.elt.type="Slider",this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()});let e=$('\n      <div class="slider-outer special-elt">\n         <div class=\'range-container\'>\n            <span class=\'slider-controller-toggle\'><i class="fas fa-sort-down"></i></span>\n            <input type=range class=slider min=-5 max=5 step=0.1 />\n            <span class=\'play-pause\'><i class="fas fa-play"></i></span>\n         </div>\n         <div class=\'slider-controller\'>\n            <label>min</label>:<span class="math-field min">-5</span>\n            <label>max</label>:<span class="math-field max">5</span>\n            <label>step</label>:<span class="math-field step">0.1</span>\n         </div>\n      </div>');this.elt.querySelector(".main").append(e[0]);let t=e[0].querySelector(".slider");t.addEventListener("change",()=>{this.specialProps.invokeOnchange&&(this.graphChild.setValue(parseFloat(t.value),[!1]),this.setScript(this.graphChild.id+" = "+t.value,!1),this.isError&&(this.isError=!1,this.__updateDependants(),this.elt.querySelector(".error-elt").remove()))}),$(t).on("mousemove touchmove",()=>{t.ismousedown&&(this.graphChild.setValue(parseFloat(t.value)),this.setScript(this.graphChild.id+" = "+t.value,!1),this.isError&&(this.isError=!1,this.__updateDependants(),this.elt.querySelector(".error-elt").remove()))}),$(t).on("mousedown touchstart",()=>{t.ismousedown=!0}),$(t).on("mouseup touchend",()=>{t.ismousedown=!1});let s={min:MQ.MathField(e[0].querySelector(".slider-controller .math-field.min"),{handlers:{edit:function(){t.min=MathPackage.Parser.maximaTOjsFunction(MathPackage.Parser.latexTOmaxima(s.min.latex()))()}}}),max:MQ.MathField(e[0].querySelector(".slider-controller .math-field.max"),{handlers:{edit:function(){t.max=MathPackage.Parser.maximaTOjsFunction(MathPackage.Parser.latexTOmaxima(s.max.latex()))()}}}),step:MQ.MathField(e[0].querySelector(".slider-controller .math-field.step"),{handlers:{edit:function(){t.step=Math.max(.01,MathPackage.Parser.maximaTOjsFunction(MathPackage.Parser.latexTOmaxima(s.step.latex()))())}}})};this.specialProps={slider:t,scmfs:s,invokeOnchange:!0},this.__updateSlider()}__updateSlider(){this.graphChild.handlers.onchange=(t=!0)=>{t&&(e.value=this.graphChild.getValue()),mySketch.update(!0,!1)};let e=this.specialProps.slider,t=this.graphChild.getValue();this.specialProps.scmfs.min.latex(Math.min(parseFloat(e.min),parseFloat(t))),this.specialProps.scmfs.max.latex(Math.max(parseFloat(e.max),parseFloat(t))),this.specialProps.invokeOnchange=!1,e.value=t,this.specialProps.invokeOnchange=!0}__toVariable(){this.elt.type="Variable",this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()}),this.specialProps={}}__updateVariable(){}}class Transform{constructor(e){this.gs=e,this._xAngle=0,this.xSpace=80,this.xSpaceValue=2,this.xSpaceModifier=1,this.xSpaceModifier=1,this._yAngle=Math.PI/2,this.ySpace=80,this.ySpaceValue=2,this.ySpaceModifier=1,this.ySpaceModifier=1,this.angleMargin=angles.deg(20),this.zoomLimits=[80,180],this.zoomLimits[1]=2*this.zoomLimits[1]/5<this.zoomLimits[0]?5*this.zoomLimits[0]/2+1:this.zoomLimits[0],this.zoomRatio=1.1,this.xZoomingState=2,this.yZoomingState=2,this.invokeOnchange=!0}get transformOrigin(){return this._transformOrigin}set transformOrigin(e){if(e&&e instanceof vector){this._transformOrigin={pxVector:e};let t=this.gs.pxTOcoor(e.x,e.y);this._transformOrigin.coorVector=new vector(t.x,t.y)}else this._transformOrigin=void 0}get xAngle(){return this._xAngle}set xAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._yAngle+Math.PI-this.angleMargin)))))}this._xAngle=t}get yAngle(){return this._yAngle}set yAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._xAngle+Math.PI-this.angleMargin)))))}this._yAngle=t}rotate(e,t="rad"){isNaN(e)||("deg"===t&&(e=e/180*Math.PI),this.invokeOnchange=!1,this.xAngle+=e,this.yAngle+=e,this.invokeOnchange=!0,this.onchange())}rotateX(e,t="rad"){isNaN(e)||(this.invokeOnchange=!1,"deg"===t&&(e=e/180*Math.PI),this.xAngle+=e,this.invokeOnchange=!0,this.onchange())}rotateY(e,t="rad"){isNaN(e)||(this.invokeOnchange=!1,"deg"===t&&(e=e/180*Math.PI),this.yAngle+=e,this.invokeOnchange=!0,this.onchange())}translate(e){this.gs._center=new vector(this.gs.center.x+e.x,this.gs.center.y+e.y),this.onchange(this.invokeOnchange,!1)}translateX(e){this.gs._center=new vector(this.gs.center.x+e.x,this.gs.center.y+e.y),this.onchange(this.invokeOnchange,!1)}translateY(e){this.gs._center=new vector(this.gs.center.x+e.x,this.gs.center.y+e.y),this.onchange(this.invokeOnchange,!1)}zoomIn(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e,this.invokeOnchange=!1,this.xZoomIn(),this.yZoomIn(),this.invokeOnchange=!0,this.onchange()}zoomOut(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e,this.invokeOnchange=!1,this.xZoomOut(),this.yZoomOut(),this.invokeOnchange=!0,this.onchange()}xZoomIn(){this.xSpace<=this.zoomLimits[1]&&(this.xSpace*=this.zoomRatio),this.reformXspace(),this.onchange()}xZoomOut(){this.xSpace>=this.zoomLimits[0]&&(this.xSpace/=this.zoomRatio),this.reformXspace(),this.onchange()}yZoomIn(){this.ySpace<=this.zoomLimits[1]&&(this.ySpace*=this.zoomRatio),this.reformYspace(),this.onchange()}yZoomOut(){this.ySpace>=this.zoomLimits[0]&&(this.ySpace/=this.zoomRatio),this.reformYspace(),this.onchange()}setViewport(e,t,s){(e=e||{}).xmin=0===e.xmin?0:e.xmin||this.gs.viewport.xmin,e.xmax=0===e.xmax?0:e.xmax||this.gs.viewport.xmax,e.ymin=0===e.ymin?0:e.ymin||this.gs.viewport.ymin,e.ymax=0===e.ymax?0:e.ymax||this.gs.viewport.ymax;let i=this.invokeOnchange;this.invokeOnchange=!1;let n=this.gs.pxTOcoor(this.gs.width/2,this.gs.height/2);t=t||new vector(0,0),t=this.gs.pxTOcoor(t.x,t.y);let a=this.xSpace,r=this.ySpace;if(this.xSpace=this.xSpace/((e.xmax-e.xmin)/(this.gs.viewport.xmax-this.gs.viewport.xmin)),s?this.ySpace*=this.xSpace/a:this.ySpace=this.ySpace/((e.ymax-e.ymin)/(this.gs.viewport.ymax-this.gs.viewport.ymin)),(this.ySpace<=0||this.xSpace<=0||isNaN(this.xSpace)||!isFinite(this.xSpace)||isNaN(this.ySpace)||!isFinite(this.ySpace))&&(this.xSpace=a,this.ySpace=r),this.reformXspace(),this.reformYspace(),this.invokeOnchange=!0,this.onchange(),t=this.gs.coorTOpx(t.x,t.y),t=new vector(t.x,t.y),this.translate(t.mult(-1)),this.onchange(),s){let t=this.gs.coorTOpx(n.x,(e.ymax+e.ymin)/2);this.translate(new vector(0,this.gs.height/2-t.y))}this.onchange(),this.invokeOnchange=i}getViewport(e){let t=this.gs.xToCoor(e.xmin,Math.tan(this.yAngle)>0?e.ymin:e.ymax),s=this.gs.xToCoor(e.xmax,Math.tan(this.yAngle)<=0?e.ymin:e.ymax),i=this.gs.yToCoor(Math.tan(this.xAngle)>0?e.xmax:e.xmin,e.ymax),n=this.gs.yToCoor(Math.tan(this.xAngle)<=0?e.xmax:e.xmin,e.ymin);return{xmin:s<t?s:t,xmax:s>t?s:t,ymin:n<i?n:i,ymax:n>i?n:i}}reformXspace(){let e=!1;for(;this.xSpace>this.zoomLimits[1];){if(5==this.xZoomingState){this.xZoomingState=2;let e=.4;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=1;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(1==this.xZoomingState){this.xZoomingState=5;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}e=!0}if(!e)for(;this.xSpace<this.zoomLimits[0];)if(1==this.xZoomingState){this.xZoomingState=2;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=5;let e=2.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(5==this.xZoomingState){this.xZoomingState=1;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}}reformYspace(){let e=!1;for(;this.ySpace>this.zoomLimits[1];){if(5==this.yZoomingState){this.yZoomingState=2;let e=.4;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=1;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(1==this.yZoomingState){this.yZoomingState=5;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}e=!0}if(!e)for(;this.ySpace<this.zoomLimits[0];)if(1==this.yZoomingState){this.yZoomingState=2;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=5;let e=2.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(5==this.yZoomingState){this.yZoomingState=1;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}}reset(){this.transformOrigin=void 0,this.invokeOnchange=!1,this.xSpace=80,this.xSpaceValue=2,this.xSpaceModifier=1,this.xZoomingState=2,this.ySpace=80,this.ySpaceValue=2,this.ySpaceModifier=1,this.yZoomingState=2,this._xAngle=0,this._yAngle=Math.PI/2,this.translate(new vector(this.gs.width/2-this.gs.center.x,this.gs.height/2-this.gs.center.y)),this.invokeOnchange=!0,this.onchange()}assign(e){Object.assign(this,e)}onchange(e=this.invokeOnchange,t=!0){if(e){let e=this.xSpaceModifier*Math.abs(Math.cos(this.xAngle-this.yAngle))+1,s=this.ySpaceModifier*Math.abs(Math.cos(this.xAngle-this.yAngle))+1;if(this.xScale=this.xSpace*e/this.xSpaceValue,this.yScale=this.ySpace*s/this.ySpaceValue,this.gs.viewport=this.getViewport({xmin:0,xmax:this.gs.width,ymin:0,ymax:this.gs.height}),this.gs.drawingStep=(this.gs.viewport.xmax-this.gs.viewport.xmin)/1e4,this.transformOrigin&&t){let e=this.invokeOnchange;this.invokeOnchange=!1;let t=this.gs.coorTOpx(...this.transformOrigin.coorVector.toArray());this.translate(this.transformOrigin.pxVector.subtract(t)),this.onchange(!0,!1),this.invokeOnchange=e}if((this.gs.viewport.xmin+this.gs.drawingStep/2<=this.gs.viewport.xmin||this.gs.viewport.xmax-this.gs.drawingStep/2>=this.gs.viewport.xmax||!math.isNumeric(this.xScale)||!math.isNumeric(this.yScale)||!math.isNumeric(this.gs.viewport.xmin)||!math.isNumeric(this.gs.viewport.xmax)||!math.isNumeric(this.gs.viewport.ymin)||!math.isNumeric(this.gs.viewport.ymax)||!math.isNumeric(this.gs.drawingStep)||this.gs.viewport.xmax-this.gs.viewport.xmin>1e12||this.gs.viewport.ymax-this.gs.viewport.ymin>1e12||this.gs.viewport.xmax-this.gs.viewport.xmin<1e-12||this.gs.viewport.ymax-this.gs.viewport.ymin<1e-12||!math.isNumeric(this.gs.center.x)||!math.isNumeric(this.gs.center.y)||this.transformOrigin&&t&&(!math.isNumeric(this.transformOrigin.coorVector.x)||!math.isNumeric(this.transformOrigin.coorVector.y)||!math.isNumeric(this.transformOrigin.pxVector.x)||!math.isNumeric(this.transformOrigin.pxVector.y)))&&this.lastEdition)return this.assign(this.lastEdition.transform),this.gs.viewport=Object.assign({},this.lastEdition.viewport),this.gs.drawingStep=this.lastEdition.drawingStep,void(this.gs._center=Object.assign(new vector,this.lastEdition.center));this.lastEdition={transform:Object.assign(new this.constructor,this),viewport:Object.assign({},this.gs.viewport),drawingStep:this.gs.drawingStep,center:Object.assign(new vector,this.gs.center)}}}}class GraphSettings{constructor(e,t,s){this.sketch=e,this._width=t,this._height=s,this._center=new vector(this.width/2,this.height/2),this.transform=new Transform(this),this.transform.onchange(),this.physicsRun=!1,this.childrenIDs=[]}get coor(){return this.sketch.coor}get width(){return this._width||0}set width(e){this._width=e,this.transform.onchange()}get height(){return this._height||0}set height(e){this._height=e,this.transform.onchange()}get iVector(){return vector.fromAngle(-this.transform.xAngle).mult(this.transform.xScale)}get jVector(){return vector.fromAngle(-this.transform.yAngle).mult(this.transform.yScale)}get center(){return this._center}centrate(){this.transform.translate(new vector(this.width/2-this.center.x,this.height/2-this.center.y))}reset(){this.transform.reset()}coorTOpx(e,t){return{x:this.xToPixel(e,t),y:this.yToPixel(e,t)}}pxTOcoor(e,t){return{x:this.xToCoor(e,t),y:this.yToCoor(e,t)}}xToPixel(e,t){return this.center.x+e*this.transform.xScale*Math.cos(this.transform.xAngle)+t*this.transform.yScale*Math.cos(this.transform.yAngle)}yToPixel(e,t){return this.center.y-(t*this.transform.yScale*Math.sin(this.transform.yAngle)+e*this.transform.xScale*Math.sin(this.transform.xAngle))}xToCoor(e,t){return e-=this.center.x,t=this.center.y-t,(Math.cos(this.transform.yAngle)*t-Math.sin(this.transform.yAngle)*e)/Math.sin(this.transform.xAngle-this.transform.yAngle)/this.transform.xScale}yToCoor(e,t){return e-=this.center.x,t=this.center.y-t,(Math.cos(this.transform.xAngle)*t-Math.sin(this.transform.xAngle)*e)/Math.sin(this.transform.yAngle-this.transform.xAngle)/this.transform.yScale}checkId(e){if(!e)throw new Error("can't set a falsy value to the name of this sketch child.");let t=e.replace(/^\s*([_a-zA-z\d]+)\s*$/,"$1");if(!t)throw new Error(`"${e}" is not valid to use.`);if(this.childrenIDs.find(t=>t===e))throw new Error(`"${e}" is used before.`);return t}}class Coordinates{constructor(e,t){this.gs=e;let s={type:"default",xUnit:"",yUnit:"",background:new drawing.color(255,255,255,255),font:"Georgia",drawDecimalLines:!0,drawMainLines:!0,drawAxisesLines:!0,drawPolarCircles:!1,drawPolarLines:!1,drawPolarAngles:!1,drawNumbers:!0,decimalLinesSpace:5,polarCirclesSpace:5,polarLinesAnglesSpace:6,penDecimalLines:null,penMainLines:null,penXaxis:null,penYaxis:null,penPolarCircles:null,penPolarLines:null,autoRefiningOnZoomimg:!0};Object.assign(s,{color:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),antiBackground:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),drawDecimalLines:!s.background.isDark(),penDecimalLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,30/255):new drawing.color(50,50,50,30/255),1),penMainLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,100/255),1),penXaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penYaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penPolarCircles:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1),penPolarLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1)}),t?(this.coorSettings={},Object.assign(this.coorSettings,s),Object.assign(this.coorSettings,t)):this.coorSettings=s}render(e){switch(this.coorSettings.type){case"default":this.custom(e);break;case"rad":this.radian(e)}}custom(e,t=1){let s,i,n,a,r,o,h;if(s=Math.floor(this.gs.viewport.xmin/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,n=Math.ceil(this.gs.viewport.xmax/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,i=Math.floor(this.gs.viewport.ymin/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,a=Math.ceil(this.gs.viewport.ymax/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,this.coorSettings.drawDecimalLines){e.ctx.beginPath(),this.coorSettings.penDecimalLines.setup(e);for(let r=s;r<=n;r+=this.gs.transform.xSpaceValue*t/this.coorSettings.decimalLinesSpace)e.line(this.gs.xToPixel(r,i),this.gs.yToPixel(r,i),this.gs.xToPixel(r,a),this.gs.yToPixel(r,a));for(let t=i;t<=a;t+=this.gs.transform.ySpaceValue/this.coorSettings.decimalLinesSpace)e.line(this.gs.xToPixel(s,t),this.gs.yToPixel(s,t),this.gs.xToPixel(n,t),this.gs.yToPixel(n,t));e.ctx.stroke()}if(this.coorSettings.drawMainLines){e.ctx.beginPath(),this.coorSettings.penMainLines.setup(e);for(let r=s;r<=n;r+=this.gs.transform.xSpaceValue*t)e.line(this.gs.xToPixel(r,i),this.gs.yToPixel(r,i),this.gs.xToPixel(r,a),this.gs.yToPixel(r,a));for(let t=i;t<=a;t+=this.gs.transform.ySpaceValue)e.line(this.gs.xToPixel(s,t),this.gs.yToPixel(s,t),this.gs.xToPixel(n,t),this.gs.yToPixel(n,t));e.ctx.stroke()}if(this.coorSettings.drawAxisesLines&&(e.ctx.beginPath(),this.coorSettings.penXaxis.setup(e),e.line(this.gs.xToPixel(s,0),this.gs.yToPixel(s,0),this.gs.xToPixel(n,0),this.gs.yToPixel(n,0)),e.ctx.stroke(),e.ctx.beginPath(),this.coorSettings.penYaxis.setup(e),e.line(this.gs.xToPixel(0,i),this.gs.yToPixel(0,i),this.gs.xToPixel(0,a),this.gs.yToPixel(0,a)),e.ctx.stroke()),s=Math.floor(s/this.gs.transform.xSpaceValue/t),n=Math.ceil(n/this.gs.transform.xSpaceValue/t),i=Math.floor(i/this.gs.transform.ySpaceValue),a=Math.ceil(a/this.gs.transform.ySpaceValue),this.coorSettings.drawNumbers){let c,l;e.ctx.fillStyle=this.coorSettings.color.toString(),e.ctx.strokeStyle=`rgba(${this.coorSettings.background.toArray().splice(0,3).join(", ")}, 200)`,e.ctx.lineWidth=2,e.setFont({size:15}),Math.abs(Math.tan(this.gs.transform.yAngle))>Math.abs(Math.tan(this.gs.transform.xAngle))?(c="v",l="h"):(c="h",l="v");for(let i=s;i<=n;i+=1)if(o=i*this.gs.transform.xSpaceValue,h=Math.abs(o)<.001||Math.abs(o)>=999999?o.toExponential(3).replace(/\.?0+e\+?/,"×10^"):o.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=o){h+=(t===Math.PI/2?"pi":"")+this.coorSettings.xUnit;let s=this.__getLabelPos(e,this.gs.coorTOpx(o,0),h,c,this.gs.jVector);e.ctx.fillText(h,s.x,s.y)}for(let t=i;t<=a;t+=1)if(r=t*this.gs.transform.ySpaceValue,h=Math.abs(r)<.001||Math.abs(r)>=999999?r.toExponential(3).replace(/\.?0+e\+?/,"×10^"):r.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=r){h+=this.coorSettings.yUnit;let t=this.__getLabelPos(e,this.gs.coorTOpx(0,r),h,l,this.gs.iVector);e.ctx.fillText(h,t.x,t.y)}}}radian(e){this.custom(e,Math.PI/2)}__getLabelPos(e,t,s,i,n){let a=e.measureString(s);if(a.height=10,t=new vector(t.x,t.y),"h"===i){let e=[4,this.gs.width-a.width-4];if(t.x<e[0]){let s=(e[0]-t.x)/n.x;return t.add(n.mult(s))}if(t.x>e[1]){let s=(e[1]-t.x)/n.x;return t.add(n.mult(s))}return t}{let e=[4,this.gs.height-a.height-4];if(t.y<e[0]){let s=(e[0]-t.y)/n.y;return t.add(n.mult(s))}if(t.y>e[1]){let s=(e[1]-t.y)/n.y;return t.add(n.mult(s))}return t}}}class Sketch{constructor(e){this.canvas=new Canvas({parent:e,attributes:{id:"canvas"}}),this.subcanvas=new Canvas({parent:e,attributes:{id:"sub-canvas"}}),this.ChildrenCanvas=new Canvas({parent:e,attributes:{id:"children-canvas"}}),this.gs=new GraphSettings(this,this.canvas.width,this.canvas.height),this.coor=new Coordinates(this.gs),this.children=new Map,this.scriptParser=new MagicalParser.CustomParsers.Math}appendChild(e){if(!e.id)throw new Error("Your sketch child should have had an id :'(");e instanceof GraphChild||this.childFromScript(e);this.children.set(e.id,e)}childFromScript(e,t={}){let s=this.getChildParser.parse(e.replace(/\^/g,"**"));return childFromParsed(s,t)}childFromParsed(e,t={}){if(t.sketch=this,""===e.type)return new Empty(t);if("="===e.name){let s=e.args[0],i=e.args[1];if(s.check({type:"variable",name:"y"})&&!i.contains({type:"variable",name:"y"}))return new Xfunction(Object.assign(t,{expr:i}));if(s.check({type:"functionCalling"})&&!this.gs.reservedFunction.find(e=>Math.hasOwnProperty(s.name))){if(1==s.args.length&&s.args[0].check({type:"variable",name:"x"})&&!i.contains({type:"variable",name:"y"}))return new Xfunction({sketch:this,expr:i,id:s.name})}else{if("variable"===s.type&&"number"===i.type)return new Slider(Object.assign(t,{id:s.name,value:i.value}));if("variable"===s.type&&i.check({type:"prefixOperator",name:"-"})&&"number"===i.args[0].type)return new Slider(Object.assign(t,{id:s.name,value:-i.args[0].value}));if("variable"===s.type)return new Variable(Object.assign(t,{id:s.name,value:i}))}}else{if(e.contains({type:"variable",name:"x"}))return new Xfunction(Object.assign(t,{expr:e}));if(e.check({type:"block",name:"()"})&&1==e.args.length&&e.args[0].check({type:"separator",name:",",length:2})&&!vars.contains("t"))return new Point({x:e.args[0].args[0],y:e.args[0].args[1],...t})}return new EvalExpr(Object.assign(t,{expr:e,drawable:!1}))}getChildById(e){return this.children.get(e)}update(e=!0,t=!0){if(this.canvas){t&&(this.subcanvas.clear(),this.coor.render(this.subcanvas)),this.ChildrenCanvas.clear();for(let e of this.children.values())e&&e.render(this.ChildrenCanvas);e&&this.draw()}}draw(){this.canvas.clear(this.coor.coorSettings.background.toString())}}var subTools={details:SUI.TempMessege({layer:!1,toolsbar:!0,onhoverFix:!0,position:{bottom:20,left:20},duration:2500,content:'<p style="background: green; color:white;">There is no god but Allah',parent:document.querySelector("#canvas-parent")})},mouse={x:void 0,y:void 0},keypadSettings={backspaceInterval:void 0,mouseDownForInterval:!1,showHideKeyBtn:document.querySelector(".sh-keypad"),mathField:document.querySelector(".script")};function updateObjsOrder(){let e=document.querySelectorAll(".controls li"),t=1;for(let s of e)s.setAttribute("index",t-1),s.querySelector(".order").textContent=t++}function addControl(e,t="last",s=!0){var i=document.querySelector(".controls");let n="last"===(t=math.isNumeric(t)&&t>i.childElementCount-1?"last":t)?i.childElementCount-1:t;n>-1&&"last"!==t?(e.elt.querySelector(".order").textContent=n+1,i.insertBefore(e.elt,i.children[n]),updateObjsOrder()):(e.elt.setAttribute("index",i.childElementCount),e.elt.querySelector(".order").textContent=i.childElementCount+1,i.appendChild(e.elt)),s&&e.focus()}function removeControl(e){if(e===keypadSettings.focusedControl){let t=e.elt.previousElementSibling||e.elt.nextElementSibling;t&&mySketch.children.get(t.getAttribute("id")).control.focus()}e.elt.remove();var t=document.querySelector(".controls"),s=t.parentElement.querySelector("#add-new-control");0===t.childElementCount&&(s.classList.add("animate-shake"),t.parentElement.classList.add("blink-error"),setTimeout(()=>{s.classList.remove("animate-shake"),t.parentElement.classList.remove("blink-error"),addControl(new ChildControl)},400))}var canvasParent$1=document.querySelector("#canvas-parent");function resize(e=!0){checkSM(),document.body.style.height=window.innerHeight+"px",mySketch.canvas.resize(canvasParent$1.clientWidth,canvasParent$1.clientHeight),mySketch.subcanvas.resize(canvasParent$1.clientWidth,canvasParent$1.clientHeight),mySketch.ChildrenCanvas.resize(canvasParent$1.clientWidth,canvasParent$1.clientHeight),mySketch.gs.width=canvasParent$1.clientWidth,mySketch.gs.height=canvasParent$1.clientHeight;let t=mySketch.gs.viewport;if(mySketch.gs.transform.onchange(),mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(t,null,!0),e){let e=document.querySelector(".sidebar-container");$(".sidebar-container .resizer").draggable("option","containment",getContainment(e))}mySketch.update(),resize.prevSize={width:window.innerWidth,height:window.innerHeight}}function checkSM(){window.innerWidth<=600&&resize.prevSize.width>600?(document.body.querySelector(".app-container .container").append(document.body.querySelector(".keypad-container")),checkSM.smallScreen=!0):window.innerWidth>600&&resize.prevSize.width<=600&&(document.body.append(document.body.querySelector(".app-container .container .keypad-container")),checkSM.smallScreen=!1)}function getContainment(e){let t=window.getComputedStyle(e),s=parseInt(t.minWidth.replace("px","")),i=parseInt(t.maxWidth.replace("px",""));return s>i?[s,0,s,parseInt(t.height.replace("px",""))]:[s,0,i,parseInt(t.height.replace("px",""))]}function canvasEvents(){let e,t=MathPackage.Lines,s=s=>{e=!0;let i=n(canvas.elt);if("mousedown"===s.type)mouse.x=s.clientX-i.left,mouse.y=s.clientY-i.top;else{let e=s.touches[0];mouse.x=e.clientX-i.left,mouse.y=e.clientY-i.top}if(Object.assign(subTools,{type:subTools.type,mouse:new vector(mouse.x,mouse.y),iVector:new vector(...mySketch.gs.iVector.toArray()),jVector:new vector(...mySketch.gs.iVector.toArray())}),subTools.type.search("axises")>-1){let e=t.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),s=t.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=30,n={x:t.distToLine(subTools.mouse,e),y:t.distToLine(subTools.mouse,s)};if(n.x<i&&n.y<i)subTools.axis="xy",subTools.xSpace=mySketch.gs.transform.xSapce,subTools.ySpace=mySketch.gs.transform.ySapce,subTools.xAngle=mySketch.gs.transform.xAngle,subTools.yAngle=mySketch.gs.transform.yAngle,subTools.transformOrigin=new vector(mySketch.gs.center.x,mySketch.gs.center.y),subTools.xPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penXaxis.color),subTools.yPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penYaxis.color),mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155),mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155);else if(n.x<i){subTools.axis="x",subTools.space=mySketch.gs.transform.xSapce,subTools.angle=mySketch.gs.transform.xAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.x!==mySketch.gs.center.x&&(e=subTools.mouse),subTools.transformOrigin=e,subTools.penColor=[mySketch.coor.coorSettings.penXaxis.color].slice()[0],mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155)}else if(n.y<i){subTools.axis="y",subTools.space=mySketch.gs.transform.ySapce,subTools.angle=mySketch.gs.transform.yAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.y!==mySketch.gs.center.y&&(e=subTools.mouse),subTools.transformOrigin=e,subTools.penColor=[mySketch.coor.coorSettings.penYaxis.color].slice()[0],mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155)}else subTools.axis=void 0;subTools.increment=0,mySketch.draw()}else"zoom"===subTools.type&&(subTools.pxViewport={});s.preventDefault()};canvasParent.addEventListener("mousedown",s),canvasParent.addEventListener("touchstart",s);let i=s=>{let i=n(canvas.elt);if("mousemove"===s.type)mouse.x=s.clientX-i.left,mouse.y=s.clientY-i.top;else{let e=s.touches[0];mouse.x=e.clientX-i.left,mouse.y=e.clientY-i.top}if(e){switch(subTools.type){case"move":mySketch.gs.transform.translate(new vector(mouse.x,mouse.y).subtract(subTools.mouse)),mySketch.update(),canvas.ellipse(mouse.x,mouse.y,5),subTools.mouse=new vector(mouse.x,mouse.y);break;case"scale-axises":!function(e){if("x"==subTools.axis){let e=subTools.mouse,s=t.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),i=(math.dist(mouse.x,mouse.y,e.x,e.y)**2-t.distToLine(new vector(mouse.x,mouse.y),s)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.xAngle),new vector(mouse.x,mouse.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=subTools.transformOrigin,mySketch.gs.transform.xSpace+=i*s-subTools.increment,mySketch.gs.transform.reformXspace(),subTools.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),canvas.ellipse(e.x,e.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`*${(mySketch.gs.iVector.mag/subTools.iVector.mag).toFixed(2)}`])}else if("y"==subTools.axis){let e=subTools.mouse,s=t.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=(math.dist(mouse.x,mouse.y,e.x,e.y)**2-t.distToLine(new vector(mouse.x,mouse.y),s)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(mouse.x,mouse.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=subTools.transformOrigin,mySketch.gs.transform.ySpace+=i*s-subTools.increment,mySketch.gs.transform.reformYspace(),subTools.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),canvas.ellipse(e.x,e.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`*${(mySketch.gs.jVector.mag/subTools.jVector.mag).toFixed(2)}`])}else if("xy"==subTools.axis){let e=t.lineEquation(-(mySketch.gs.transform.yAngle+mySketch.gs.transform.xAngle)/2,mySketch.gs.center),s=t.projectionToLine(subTools.mouse,e),i=(math.dist(mouse.x,mouse.y,s.x,s.y)**2-t.distToLine(new vector(mouse.x,mouse.y),e)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let e=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(mouse.x,mouse.y).subtract(s)),t=e<Math.PI/2?1:e>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=subTools.transformOrigin;let n=(mySketch.gs.transform.ySpace+(i*t-subTools.increment))/mySketch.gs.transform.ySpace;n=math.constrain(n,.9,1.1),mySketch.gs.transform.ySpace*=n,mySketch.gs.transform.xSpace*=n,mySketch.gs.transform.reformYspace(),mySketch.gs.transform.reformXspace(),subTools.increment=i*t}mySketch.gs.transform.onchange(!0),mySketch.update(),canvas.ellipse(s.x,s.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`*${(mySketch.gs.jVector.mag/subTools.jVector.mag).toFixed(2)}`])}}();break;case"rotate-axises":!function(e){if("x"==subTools.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,mouse.x,mouse.y)>10){let e=subTools.mouse,t=angles.angle(subTools.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(mouse.x,mouse.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),"vectors");if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=angles.snapAngle(subTools.angle-t,[0,Math.PI]);let s=mySketch.gs.center;e=s.add(subTools.mouse.subtract(s).rotate(t))}mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),canvas.ellipse(e.x,e.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("y"==subTools.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,mouse.x,mouse.y)>10){let e=subTools.mouse,t=angles.angle(subTools.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(mouse.x,mouse.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),"vectors");if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.yAngle=angles.snapAngle(subTools.angle-t);let s=mySketch.gs.center;e=s.add(subTools.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),canvas.ellipse(e.x,e.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("xy"==subTools.axis&&math.dist(mySketch.gs.center.x,mySketch.gs.center.y,mouse.x,mouse.y)>10){let e=subTools.mouse,t=angles.angle(subTools.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(mouse.x,mouse.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),"vectors");if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=subTools.xAngle-t,mySketch.gs.transform.yAngle=subTools.yAngle-t;let s=mySketch.gs.center;e=s.add(subTools.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),canvas.ellipse(e.x,e.y,5),canvas.ellipse(mouse.x,mouse.y,5),r([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle)}`,`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle)}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}();break;case"zoom":!function(e){let s,i={xmin:subTools.mouse.x,ymin:subTools.mouse.y,xmax:mouse.x,ymax:mouse.y};subTools.pxViewport.xmin=Math.min(i.xmin,i.xmax),subTools.pxViewport.ymin=Math.min(i.ymin,i.ymax),subTools.pxViewport.xmax=Math.max(i.xmin,i.xmax),subTools.pxViewport.ymax=Math.max(i.ymin,i.ymax),subTools.pxViewport.width=subTools.pxViewport.xmax-subTools.pxViewport.xmin,subTools.pxViewport.height=subTools.pxViewport.ymax-subTools.pxViewport.ymin,i=subTools.pxViewport,i.width<10&&i.height<10&&(i.width=0,i.height=0);if(document.querySelector("#subtools-zoom-rr").checked||e.shiftKey){let e=angles.minAngle(vector.fromAngle(0),new vector(mySketch.gs.width,mySketch.gs.height)),s=t.lineEquation(e,subTools.mouse),n=t.projectionToLine(new vector(mouse.x,mouse.y),s);i={xmin:subTools.mouse.x,ymin:subTools.mouse.y,xmax:Math.round(n.x),ymax:Math.round(n.y)},subTools.pxViewport.xmin=Math.min(i.xmin,i.xmax),subTools.pxViewport.ymin=Math.min(i.ymin,i.ymax),subTools.pxViewport.xmax=Math.max(i.xmin,i.xmax),subTools.pxViewport.ymax=Math.max(i.ymin,i.ymax),subTools.pxViewport.width=subTools.pxViewport.xmax-subTools.pxViewport.xmin,subTools.pxViewport.height=subTools.pxViewport.ymax-subTools.pxViewport.ymin,i=subTools.pxViewport}else i.height<10&&i.width>10?(s={type:"vertical"},i.ymin=0,i.ymax=mySketch.gs.height,i.height=mySketch.gs.height):i.height>10&&i.width<10&&(s={type:"horizental"},i.xmin=0,i.xmax=mySketch.gs.width,i.width=mySketch.gs.width);mySketch.subcanvas.resize(mySketch.gs.width,mySketch.gs.height),mySketch.subcanvas.clear();let n=mySketch.canvas.get(0,0,mySketch.canvas.width,mySketch.canvas.height),a=mySketch.canvas.get(i.xmin,i.ymin,i.width,i.height);mySketch.subcanvas.image(n,0,0);let r=mySketch.coor.coorSettings.background.isDark()?[255,155]:[0,155];if(mySketch.subcanvas.background(...r),i.width&&i.height){let e=10,t=8,n=3;if(s){let e=20,t=8,n=3;"vertical"===s.type?(mySketch.subcanvas.stroke(0),mySketch.subcanvas.strokeWeight(t),mySketch.subcanvas.rect(i.xmin,subTools.mouse.y-e/2,e,e,n),mySketch.subcanvas.rect(i.xmax-e,subTools.mouse.y-e/2,e,e,n),mySketch.subcanvas.stroke(255,200),mySketch.subcanvas.strokeWeight(t-4),mySketch.subcanvas.rect(i.xmin,subTools.mouse.y-e/2,e,e,n),mySketch.subcanvas.rect(i.xmax-e,subTools.mouse.y-e/2,e,e,n)):(mySketch.subcanvas.stroke(0),mySketch.subcanvas.strokeWeight(8),mySketch.subcanvas.rect(subTools.mouse.x-e/2,i.ymin,e,e,n),mySketch.subcanvas.rect(subTools.mouse.x-e/2,i.ymax-e,e,e,n),mySketch.subcanvas.stroke(255,200),mySketch.subcanvas.strokeWeight(4),mySketch.subcanvas.rect(subTools.mouse.x-e/2,i.ymin,e,e,n),mySketch.subcanvas.rect(subTools.mouse.x-e/2,i.ymax-e,e,e,n))}else mySketch.subcanvas.stroke(0),mySketch.subcanvas.strokeWeight(t),mySketch.subcanvas.rect(i.xmin,i.ymin,e,e,n),mySketch.subcanvas.rect(i.xmax-e,i.ymin,e,e,n),mySketch.subcanvas.rect(i.xmin,i.ymax-e,e,e,n),mySketch.subcanvas.rect(i.xmax-e,i.ymax-e,e,e,n),mySketch.subcanvas.stroke(255,200),mySketch.subcanvas.strokeWeight(t-4),mySketch.subcanvas.rect(i.xmin,i.ymin,e,e,n),mySketch.subcanvas.rect(i.xmax-e,i.ymin,e,e,n),mySketch.subcanvas.rect(i.xmin,i.ymax-e,e,e,n),mySketch.subcanvas.rect(i.xmax-e,i.ymax-e,e,e,n);mySketch.subcanvas.image(a,i.xmin,i.ymin)}image(mySketch.subcanvas,0,0)}(s)}s.preventDefault()}};function n(e){let t={left:0,top:0};return e.offsetParent&&(t=n(e.offsetParent)),{left:e.offsetLeft+t.left,top:e.offsetTop+t.top}}window.addEventListener("mousemove",i,!0),window.addEventListener("touchmove",i,{passive:!1,capture:!0});let a=t=>{e&&(e=!1,"move"===subTools.type?mySketch.draw():subTools.type.search("axises")>-1?"x"==subTools.axis?(mySketch.coor.coorSettings.penXaxis.color=subTools.penColor,mySketch.draw()):"y"==subTools.axis?(mySketch.coor.coorSettings.penYaxis.color=subTools.penColor,mySketch.draw()):"xy"==subTools.axis&&(mySketch.coor.coorSettings.penXaxis.color=subTools.xPenColor,mySketch.coor.coorSettings.penYaxis.color=subTools.yPenColor,mySketch.draw()):"zoom"===subTools.type&&(subTools.pxViewport.width&&subTools.pxViewport.height&&(mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(mySketch.gs.transform.getViewport(subTools.pxViewport),new vector(subTools.pxViewport.xmin,subTools.pxViewport.ymin))),r(["x: {",`  xmin: ${mySketch.gs.viewport.xmin},`,`  xmax: ${mySketch.gs.viewport.xmax}`,"},","y: {",`  ymin: ${mySketch.gs.viewport.ymin},`,`  ymax: ${mySketch.gs.viewport.ymax}`,"}"]),mySketch.update()))};function r(e){let t='<div class="subtools-details">';for(let s of e)t+="<p>"+s+"</p>";t+="</div>",subTools.details.setContent(t),subTools.details.show()}window.addEventListener("mouseup",a),window.addEventListener("touchend",a),canvasParent.addEventListener("mousewheel",e=>{{e.preventDefault();let t=mySketch.gs.center,s=mouse;MathPackage.Core.dist(mouse.x,mouse.y,t.x,t.y)<30&&(s=t),e.wheelDelta>0?(mySketch.gs.transform.zoomIn(new vector(s.x,s.y)),mySketch.update()):(mySketch.gs.transform.zoomOut(new vector(s.x,s.y)),mySketch.update())}})}function toolsEvents(){let e=e=>{setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update())},20)},20)},20)},20)},20)},20)},20)})};document.querySelector("#zoom-in-btn").addEventListener("click",()=>{e("in")}),document.querySelector("#zoom-out-btn").addEventListener("click",()=>{e("out")}),document.querySelectorAll('.subtools-container input[type*="radio"]').forEach(e=>{subTools.type=e.checked?e.dataset.type:subTools.type,e.addEventListener("change",()=>{subTools.type=e.checked?e.dataset.type:subTools.type})}),document.querySelector("#home").addEventListener("click",()=>{mySketch.gs.reset(),mySketch.update()}),document.querySelector("#centrate").addEventListener("click",()=>{mySketch.gs.centrate(),mySketch.update()})}function setEvents(){window.addEventListener("resize",resize),window.addEventListener("mouseup",(function(e){keypadSettings.mouseDownForInterval&&(keypadSettings.mouseDownForInterval=!1,clearInterval(keypadSettings.backspaceInterval)),keypadSettings.hideKeyPad=!0})),window.addEventListener("touchend",(function(e){keypadSettings.mouseDownForInterval&&(keypadSettings.mouseDownForInterval=!1,clearInterval(keypadSettings.backspaceInterval)),keypadSettings.hideKeyPad=!0})),window.addEventListener("mousedown",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(keypadSettings.showHideKeyBtn.className);keypadSettings.hideKeyPad&&t&&keypadSettings.showHideKeyBtn.click()})),window.addEventListener("touchstart",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(keypadSettings.showHideKeyBtn.className);keypadSettings.hideKeyPad&&t&&keypadSettings.showHideKeyBtn.click()})),document.querySelector("#add-new-control").addEventListener("click",e=>{addControl(new ChildControl)}),document.querySelector("#show-hide-sidebar").addEventListener("click",(function(e){let t=$(this),s=t.hasClass("visible"),i=s?"visible":"unvisible",n=s?"unvisible":"visible",a=document.body.querySelector(".sidebar-container");s?(checkSM.smallScreen,a.style="width: "+a.clientWidth+"px",a.style="height: "+a.clientHeight+"px",document.body.querySelector(".app-container").appendChild(this)):(a.style="",a.querySelector(".header").append(this)),t.removeClass(i),t.addClass(n),a.classList.remove(i),a.classList.add(n),resize()})),canvasEvents(),toolsEvents()}function keypadEvents(){let e=$(".keypad-container"),t=$(keypadSettings.showHideKeyBtn);e.bind("focusin",(function(){keypadSettings.mathField.focus()})),$(document.body).delegate("[cancel-hiding-keypad]","mousedown touchstart",(function(e){keypadSettings.hideKeyPad=!1})),$(".control").delegate(".main","touchstart",(function(e){t.hasClass("hide")&&t.click()})),$(".keypad-container .rows button[mq-cmd]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?keypadSettings.mathField.cmd($(" > div.active > span.active",e).attr("mq-cmd")):e.hasClass("shiftable")?keypadSettings.mathField.cmd($(" > span.active",e).attr("mq-cmd")):keypadSettings.mathField.cmd(this.getAttribute("mq-cmd")),keypadSettings.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-write]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?keypadSettings.mathField.write($(" > div.active > span.active",e).attr("mq-write")):e.hasClass("shiftable")?keypadSettings.mathField.write($(" > span.active",e).attr("mq-write")):keypadSettings.mathField.write(this.getAttribute("mq-write")),keypadSettings.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-func]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?keypadSettings.mathField.write($(" > div.active > span.active",e).attr("mq-func")):e.hasClass("shiftable")?keypadSettings.mathField.write($(" > span.active",e).attr("mq-func")):keypadSettings.mathField.write(this.getAttribute("mq-func")),keypadSettings.mathField.cmd("("),keypadSettings.focusedControl.focus()}))})),$(".space").on("click",(function(){keypadSettings.mathField.keystroke("Right")})),$(".backspace").on("mousedown",(function(){""==keypadSettings.mathField.latex()?keypadSettings.focusedControl.remove():keypadSettings.mathField.keystroke("Backspace"),keypadSettings.mouseDownForInterval=!0,setTimeout((function(){keypadSettings.mouseDownForInterval&&(keypadSettings.backspaceInterval=setInterval((function(){keypadSettings.mathField.keystroke("Backspace")}),120))}),400)})),$(".go-left").on("click",(function(){keypadSettings.mathField.keystroke("Left")})),$(".go-right").on("click",(function(){keypadSettings.mathField.keystroke("Right")})),$(".go-up").on("click",(function(){keypadSettings.mathField.keystroke("Up")})),$(".go-down").on("click",(function(){keypadSettings.mathField.keystroke("Down")})),$(".enter").on("click",(function(){addControl(new ChildControl,parseInt(keypadSettings.focusedControl.orderELT.textContent))})),$(".shift").on("click",(function(){let e=$(this),t=e.parents(".rows");if(e.hasClass("active"))e.removeClass("active"),e.addClass("lock"),t.removeClass("shift-active"),t.addClass("shift-lock");else if(e.hasClass("lock")){$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.removeClass("lock"),t.removeClass("shift-lock")}else{$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.addClass("active"),t.addClass("shift-active")}})),$(".keypad-container .rows button").not(".shift, .double-shift").on("click",(function(){let e=$(this).parents(".rows");if(e.hasClass("shift-active")){let t=$("button.shift",e);$(".shiftable > span, .double-shiftable > div > span",e).toggleClass("active"),t.removeClass("active"),e.removeClass("shift-active")}})),$(".double-shift").on("click",(function(){let e=$(this);$(".double-shiftable > div",e.parents(".rows")).toggleClass("active"),e.toggleClass("active")}))}function setupKeypad(){keypadSettings.showHideKeyBtn.addEventListener("click",(function(e){let t=document.querySelector(".sidebar-container");/\svisible\s|^visible\s|\svisible$/.test(t.className)||document.querySelector("#show-hide-sidebar").click();let s=document.querySelector(".keypad-container"),i=$(this).hasClass("visible"),n=i?"visible":"unvisible",a=i?"unvisible":"visible";keypadSettings.showHideKeyBtn.classList.remove(n),keypadSettings.showHideKeyBtn.classList.add(a),s.classList.remove(n),s.classList.add(a),i?document.body.querySelector(".app-container").appendChild(keypadSettings.showHideKeyBtn):s.insertBefore(keypadSettings.showHideKeyBtn,s.firstElementChild),checkSM.smallScreen&&resize(),keypadSettings.focusedControl.focus()})),SUI.tabs(document.body.querySelector(".keypad-container .tabs-1")),keypadEvents()}function setupAPP(e){document.body.style.height=window.innerHeight+"px",window.MP=MathPackage,window.angles=MP.Angles,window.lines=MP.Lines,window.math=MP.Core,window.drawing=drawing$1,window.vector=MP.entities.Vector,window.MQ=MathQuill.getInterface(2),MQ.config({sumStartsWithNEquals:!0,supSubsRequireOperand:!0,autoSubscriptNumerals:!0,autoCommands:"pi theta sqrt abs floor ceil round random sum int prod",maxDepth:10}),window.mySketch=new Sketch(e),window.canvas=mySketch.canvas,window.canvasParent=e,resize.prevSize={width:1e3,height:1e3},checkSM(),resize.prevSize={width:window.innerWidth,height:window.innerHeight};let t=$(".math-field");for(let e=0;e<t.length;e++)MQ.StaticMath(t[e]);let s=$('\n      <li class="control">\n        <div class="side-status" cancel-move>\n          <div class="order-container">\n            <span class=\'order\'>123</span>\n          </div>\n        </div>\n        <div class="main" cancel-move cancel-hiding-keypad>\n         <div class=script-container><span type="text" class="script">NEW</span></div>\n        </div>\n        <div class="side-ctrl">\n          <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n          <span class="move">\n            <div>\n              <span>..</span>\n              <span>..</span>\n              <span>..</span>\n            </div>\n          </span>\n        </div>\n      </li>\n      ')[0];document.body.querySelector("#add-new-control").append(s),setEvents(),setupKeypad(),setupResizer(),setupSortable(),resize(),mySketch.gs.centrate(),mySketch.update(),$("#loading-layer").fadeOut(1e3,()=>{addControl(new ChildControl)}),console.log("%cPLOTTO","background: black; color: white; font: 50px consolas;"),console.log("%cWe are sciCave","color: blue; font: 25px consolas;")}function setupResizer(){var e=document.querySelector(".sidebar-container"),t=e.querySelector(".resizer");let s={};$(t).draggable({axis:"x",containment:getContainment(e),start:i=>{t.classList.add("dragging"),s.intialWidth=e.clientWidth,s.intialOffset=i.pageX,s.cursor=document.body.style.cursor,document.body.style.cursor="e-resize"},stop:()=>{t.classList.remove("dragging"),e.style.flexBasis=t.style.left,document.body.style.cursor=s.cursor},drag:()=>{e.style.flexBasis=t.style.left,resize(!1)}})}function setupSortable(){var e=document.querySelector(".outer-controls"),t=e.querySelector(".inner-controls");let s=!0;$(".controls.sortable").sortable({axis:"y",cancel:".control [cancel-move]",start:function(i,n){s=!0,e.classList.add("sorting"),t.clientHeight>e.clientHeight&&(e.style.overflowY="scroll"),n.item[0].classList.add("dragging");let a=n.item[0].getAttribute("id");for(let e in mySketch.children)e.id!==a||e.focus()},stop:function(t,i){s?(e.classList.remove("sorting"),e.style.overflowY="auto",i.item[0].classList.remove("dragging")):s=!1},update:function(){updateObjsOrder()}}),$(".controls.sortable").disableSelection()}return checkSM.prevSize={width:window.innerWidth,height:window.innerHeight},setupAPP(document.querySelector("#canvas-parent")),setupAPP}));
//# sourceMappingURL=app.js.map
