<<<<<<< HEAD
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PLOTTO=t()}(this,(function(){"use strict";class e extends Error{constructor(e){super('"'+e+'" has been defined before.'),this.id=e}}class t extends Error{constructor(e){super(""),this.undef=e}}function s(){return(Date.now()+s.randomNameNum++).toString(36)}s.randomNameNum=0;let i={log:function(e,t=10){return Math.log10(e)/Math.log10(t)},ln:e=>Math.log(e,Math.E),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),asec:e=>Math.acos(1/e),acsc:e=>Math.asin(1/e),acot:e=>Math.atan(1/e),sinh:e=>(Math.exp(e)-Math.exp(-e))/2,cosh:e=>(Math.exp(e)+Math.exp(-e))/2,tanh:e=>Math.sinh(e)/Math.cosh(-e),asinh:e=>Math.ln(e+Math.sqrt(e**2+1)),acosh:e=>Math.ln(e+Math.sqrt(e**2-1)),atanh:e=>.5*Math.ln((1+e)/(1-e)),sech:e=>1/Math.cosh(e),csch:e=>1/Math.sinh(e),coth:e=>1/Math.tanh(e),asech:e=>Math.acosh(1/e),acsch:e=>Math.asinh(1/e),acoth:e=>Math.atanh(1/e),fact:e=>e%1!=0||e<0?NaN:Math.__fact(e),__fact:e=>0===e?1:e*Math.__fact(e-1),gcd:(...e)=>{let t=Math.abs(e[0]),s=Math.abs(e[1]);if(t%1!=0||s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s);for(let i=2;i<e.length;i++){if(s=Math.abs(e[i]),s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s)}return t},gcd2:(e,t)=>0==t?e:Math.gcd(t,e%t),lcm:(...e)=>{let t,s=1;for(let i=0;i<e.length;i++){if(t=e[i],t%1!=0)return NaN;s*=t}return Math.abs(s)/Math.pow(Math.gcd(...e),e.length-1)},mod:(e,t)=>e%t};Object.assign(Math,i);let a={pi:Math.PI,e:Math.E};function n(e,s,i=!0,a=!0){let n;if(n=e instanceof MagicalParser.Node?MathPackage.Parser.parsedTOjsFunction(e,s,"Math",i):"object"===(typeof e).toLowerCase()?MathPackage.Parser.maximaTOjsFunction(MathPackage.Parser.latexTOmaxima(e.value),s,"Math",i):MathPackage.Parser.maximaTOjsFunction(e,s,"Math",i),a){if(n.undef.vars.length>0||n.undef.funcs.length>0)throw new t(n.undef);return n.func}return n.func}Object.assign(Math,a);class r{constructor(e,t){if(this.handlers=e.handlers||{},this.renderable=!e.hasOwnProperty("renderable")||e.renderable,e.hasOwnProperty("handlers")&&delete e.handlers,e.hasOwnProperty("renderable")&&delete e.renderable,!e.sketch)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has sketch property, or it is falsy value");this.sketch=e.sketch,this.gs=this.sketch.gs,this.coorManager=this.gs.coorManager,delete e.sketch,e.id=e.id||s(),Object.assign(this,e),t&&t(this),this.sketch.children.set(this.id,this)}get id(){return this._id}set id(e){this._id=this.sketch.gs.checkId(e)}update(e=[]){if(this.renderable)try{this._update(this.sketch.childrenCanvas,e)}catch(e){this.error(e)}this.handlers.onupdate&&this.handlers.onupdate(...e)}draw(){this.renderable&&this._draw(this.sketch.childrenCanvas)}_update(e){}_draw(e){}remove(e=[]){this._remove(),this.sketch.children.delete(this.id),this.handlers.onremove&&this.handlers.onremove(...e)}_remove(){}error(e){this.handlers.onerror(e)}}class o{constructor(e={}){if(this.elt=e.canvas||document.createElement("canvas"),e.parent&&(e.parent.appendChild(this.elt),this.elt.width=e.parent.clientWidth,this.elt.height=e.parent.clientHeight),e.attributes)for(let t in e.attributes)this.elt.setAttribute(t,e.attributes[t]);this.font={width:15,family:"Arial"},this.ctx=this.elt.getContext("2d"),this.ctx.textBaseline="top"}get width(){return this.elt.width}get height(){return this.elt.height}resize(e,t){let s=["lineJoin","textBaseline","miterLimit","lineWidth"],i={};for(let e of s)i[e]=this.ctx[e];this.elt.width=e,this.elt.height=t,Object.assign(this.ctx,i)}clear(e,t){e?(t=t||[0,0,this.elt.clientWidth,this.elt.clientHeight],this.ctx.fillStyle=e,this.ctx.fillRect(...t)):(t=t||[0,0,this.elt.clientWidth,this.elt.clientHeight],this.ctx.clearRect(...t))}setFont(e){e.size&&(this.font.size=e.size),e.family&&(this.font.family=e.family),this.ctx.font=`${this.font.size}px ${this.font.family}`}measureString(e){let t=this.ctx.measureText(e);return t.height=this.font.size,t}get transform(){return this._trans}set transform(e){this._trans=e;this._trans[0],this._trans[2],this._trans[1],this._trans[3]}setTransform(...e){this.transform=e,this.ctx.setTransform(...e)}getTransform(){return this.transform}get lineWidth(){return this.lw}set lineWidth(e){let t=((this._trans[0]+this._trans[2])**2+(this._trans[1]+this._trans[3])**2)**.5;this.ctx.lineWidth=e/t,this.lw=e}line(e,t,s,i){this.ctx.moveTo(e,t),this.ctx.lineTo(s,i)}ellipse(e,t,s,i,a=0,n=0,r=2*Math.PI,o=!1){i=i||s,this.ctx.beginPath(),this.ctx.ellipse(e,t,s,i||s,a,n,r,o),this.ctx.fill(),this.ctx.stroke()}}class h{constructor(e,t,s,i){this.r=e,this.g=t,this.b=s,this.a=i}get brightness(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,a=e;return t>i&&(i=t),s>i&&(i=s),t<a&&(a=t),s<a&&(a=s),(i+a)/2}get hue(){if(this.r==this.g&&this.g==this.b)return 0;let e=this.r/255,t=this.g/255,s=this.b/255,i=0,a=e,n=e;t>a&&(a=t),s>a&&(a=s),t<n&&(n=t),s<n&&(n=s);let r=a-n;return e==a?i=(t-s)/r:t==a?i=2+(s-e)/r:s==a&&(i=4+(e-t)/r),i*=60,i<0&&(i+=360),i}get saturation(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,a=e;return t>i&&(i=t),s>i&&(i=s),t<a&&(a=t),s<a&&(a=s),i==a?0:(i+a)/2<=.5?(i-a)/(i+a):(i-a)/(2-i-a)}isDark(){return!(this.brightness>.4)}toArray(e={}){return[e.r||0===e.r?e.r:this.r,e.g||0===e.g?e.g:this.g,e.b||0===e.b?e.b:this.b,e.a||0===e.a?e.a:this.a]}toString(e={}){return`rgba(${this.toArray(e).join(", ")})`}}class c{static brightness(e){let t=e.r/255,s=e.g/255,i=e.b/255,a=t,n=t;return s>a&&(a=s),i>a&&(a=i),s<n&&(n=s),i<n&&(n=i),(a+n)/2}static hue(e){if(e.r==e.g&&e.g==e.b)return 0;let t=e.r/255,s=e.g/255,i=e.b/255,a=0,n=t,r=t;s>n&&(n=s),i>n&&(n=i),s<r&&(r=s),i<r&&(r=i);let o=n-r;return t==n?a=(s-i)/o:s==n?a=2+(i-t)/o:i==n&&(a=4+(t-s)/o),a*=60,a<0&&(a+=360),a}static saturation(e){let t=e.r/255,s=e.g/255,i=e.b/255,a=t,n=t;return s>a&&(a=s),i>a&&(a=i),s<n&&(n=s),i<n&&(n=i),a==n?0:(a+n)/2<=.5?(a-n)/(a+n):(a-n)/(2-a-n)}static isDark(e){return!(c.brightness(e)>.35)}static randomColor(){return new h(MathPackage.Core.random(255),MathPackage.Core.random(255),MathPackage.Core.random(255))}static randomDarkColor(){let e=c.randomColor();do{e=c.randomColor()}while(!e.isDark());return e}static randomLightColor(){let e=c.randomColor();do{e=c.randomColor()}while(e.isDark());return e}}var l=Object.freeze({__proto__:null,pen:class{constructor(e,t=1,s="solid"){this.color=e,this.weight=t,this.style=s}setup(e){(e=e instanceof o?e.ctx:e).strokeStyle=this.color.toString(),e.lineWidth=this.weight}},color:h,colorPackage:c,measureString:function(e){return canvas.elt.getContext("2d").measureText(e)}});class g extends r{constructor(e){let t=e.id;if(!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+propName+" property, or it is falsy value");if(!e.pen){let t=e.sketch.coor.coorSettings.background.isDark()?l.colorPackage.randomLightColor():l.colorPackage.randomDarkColor();t.a=155,e.pen=new l.pen(t,2)}super(e,e=>{e.expression=n(e.expr,["x"],!0),e.path=new Path2D,t&&(Math[e.id]=e.expression)})}static fromString(e,t){if(str.replace(/==+/,"").indexOf("=")>-1)throw new Error('there is "=" opertor!');return new g({expr:e,sketch:t})}async _update(e){let t,s,i,a,n=new Path2D;for(let e=this.gs.viewport.xmin;e<=this.gs.viewport.xmax;e+=this.gs.drawingStep){t=this.coorManager.coorTOpx(e,this.expression(e)),i=this.coorManager.coorTOpx(e-this.gs.drawingStep/2,this.expression(e-this.gs.drawingStep/2)),!isNaN(t.x)&&!isNaN(t.y)&&Math.abs(t.x)<1e5&&Math.abs(t.y)<1e5&&(a&&(Math.sign(t.y-i.y)===Math.sign(i.y-s.y)||Math.abs(t.y-s.y)/this.gs.drawingStep<20)||!a)?(a?n.lineTo(t.x,t.y):n.moveTo(t.x,t.y),s={x:t.x,y:t.y},a=!0):a&&(a=!1)}this.path=n}_draw(e){let t=e.ctx;t.strokeStyle=this.pen.color.toString(),t.lineWidth=this.pen.weight,t.stroke(this.path)}_remove(){delete Math[this.id]}toString(){return this.expression}}class d extends r{constructor(e){let t;if(e.pen=e.pen||new drawing.pen(new drawing.color(0,0,255),10),t="x",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="y",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");super(e,e=>{e.x=n(e.x),e.y=n(e.y)})}static fromString(e,t){if(e){let s,i=/^\s*\(\s*(.+?)\s*,\s*(.+?)\s*\)\s*$/;if(e.replace(i,(e,i,a)=>{s=new d({sketch:t,x:i,y:a})}),s)return s;throw new Error("error while trying to add a point: "+e)}throw new Error("your str is empty :'(")}draw(e,t=[]){if(this.renderable){switch(this.pen.style){case"solid":e.strokeWeight(2),e.stroke(200),e.fill(...this.pen.color.toArray().splice(0,3),150);break;case"shallow":e.ctx.lineWidth=3,e.ctx.strokeStyle(this.pen.color.toString()),e.ctx.fillStyle(this.sketch.coor.coorSettings.background.toString())}let t=this.coorManager.coorTOpx(this.x.eval(),this.y.eval());e.ellipse(t.x,t.y,this.pen.weight,this.pen.weight)}this.handlers.onupdate&&this.handlers.onupdate(...t)}toString(){return`(${this.x}, ${this.y})`}}class m extends r{constructor(e){let t;if(t="expr",!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has expr property, or it is falsy value");super(e,e=>{e.evalFunc=n(e.expr)})}static fromString(e,t){if(e)return new m({expr:expr});throw new Error("your expression is empty :'(")}eval(){return this.evalFunc()}}class p extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="value",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");super(e,e=>{if(!e.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${e.id} is invalid.`);e.value={valueOf:n(e.value)},Math[e.id]=e.value})}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}_remove(){delete Math[this.id]}}class u extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="expr",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="params",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");super(e,t=>{if(!t.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${t.id} is invalid.`);t.func=n(e.expr,e.params),Math[t.id]=t.func})}_remove(){delete Math[this.id]}}class y extends r{constructor(e){super(e)}}class f extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="value",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");super(e,e=>{if(!e.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${e.id} is invalid.`);Math[e.id]=e.value})}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}_remove(){delete Math[this.id]}}class x{constructor(e){this.elt=document.createElement("div"),this.elt.innerHTML=`\n      <li class="control" id="${this.id}">\n         <div class="side-status" cancel-move>\n            <div class="order-container">\n               <span class='order'>12</span>\n            </div>\n         </div>\n         <div class='main' cancel-move>\n            <div class=script-container>\n               <span type="text" class="script"></span>\n            </div>\n         </div>\n         <div class="side-ctrl">\n            <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n            <span class="move">\n               <div>\n                  <span>..</span>\n                  <span>..</span>\n                  <span>..</span>\n               </div>\n            </span>\n         </div>\n      </li>\n      `,this.elt=this.elt.childNodes[1],this.status="ready",this.graphChild=e||new y({sketch:mySketch,control:this}),this.__updateElts(null,this.graphChild),this.setEvents()}get id(){return this._id}set id(e){this._id=e,this.elt.id=e}get graphChild(){return this._graphChild}set graphChild(e){e instanceof m?e.handlers.onupdate=()=>{this.__updateEvalExpr()}:e instanceof f&&(e.handlers.onchange=(e=!0,t=!0)=>{e&&(this.specialProps.$slider[0].value=this._graphChild.getValue()),t&&mySketch.update(!0,!1)}),this._graphChild=e,this.id=e.id}setEvents(){let e=this.elt.querySelector(".script");this.removeELT=this.elt.querySelector(".remove"),this.orderELT=this.elt.querySelector(".order");let t=MQ.MathField(e,{handlers:{edit:()=>{this.update(t.latex())},enter:()=>{this.enter()}}});this.mathField=t,this.elt.querySelector(".main").addEventListener("focusin",e=>{this.focus(!1)}),this.elt.querySelector(".main").addEventListener("focusout",e=>{this.blur(!1)}),this.removeELT.addEventListener("click",e=>{this.remove()})}async update(e){if(!this.disableHandling)if("ready"===this.status){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),this.status="updating",this._graphChild.remove(),this.id=void 0;try{let t=this._graphChild;if(""===e)this.parsedScript=new MagicalParser.Node(""),this.graphChild=new y({sketch:mySketch});else{if(e&&(this.parsedScript=null,this.parsedScript=mySketch.scriptParser.parse(MathPackage.Parser.latexTOmaxima(e)),this.vars=this.__getAll(this.parsedScript,{type:"variable"}).map(e=>e.name),this.funcs=this.__getAll(this.parsedScript,{type:"functionCalling"}).map(e=>e.name)),!this.parsedScript)return;let t={handlers:{onremove:e=>{e&&this.remove(!1)},onerror:e=>{this.error(e)}},control:this};this.graphChild&&this.graphChild.pen&&(t.pen=this.graphChild.pen),this.graphChild=mySketch.childFromParsed(this.parsedScript,t)}this.__updateElts(t,this.graphChild)}catch(e){this.error(e)}this.id||this._graphChild&&(this.id=this._graphChild.id,mySketch.children.set(this.id,this.graphChild)),this.__updateDependants(),mySketch.update(),"re-update"===this.status?(this.status="ready",this.update(this.mathField.latex())):"updating"===this.status&&(this.status="ready")}else this.status="re-update"}__getAll(e,t={}){let s=[];if(e.check(t))return[e];for(let i=0;i<e.args.length;i++)s=s.concat(this.__getAll(e.args[i],t));return s}__updateDependants(e){if(this._graphChild instanceof p||this._graphChild instanceof f){let t=mySketch.children.size;mySketch.children.forEach(s=>{t--,t<0||s&&s!==this._graphChild&&s.control.vars&&s.control.vars.find(t=>this._graphChild.id===t||e&&t===e.id)&&s.control.update()})}if(this._graphChild instanceof u){let t=mySketch.children.size;mySketch.children.forEach(s=>{t--,t<0||s&&s.control!==this&&s.control.vars&&s.control.funcs.find(t=>this._graphChild.id===t||e&&t===e.id)&&s.control.update()})}}setScript(e,t=!0){t||(this.disableHandling=!0),this.mathField.latex(e),t||(this.disableHandling=!1)}focus(e=!0){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),A.focusedControl&&A.focusedControl!==this&&A.focusedControl.blur(),A.focusedControl=this,A.mathField=this.mathField,e&&this.mathField.focus(),this.elt.classList.add("focus")}blur(e=!0){e&&this.mathField.blur(),this.elt.classList.remove("focus")}enter(){let e=parseInt(this.orderELT.textContent);if(1===this.isError){this.blur();let t=this.elt.querySelectorAll(".not-exist .var");for(let s of t)s.click(),e++;let s=this.elt.querySelectorAll(".not-exist .func");for(let t of s)t.click(),e++}O(new x,e)}error(e){if(e instanceof t){let t=e.undef,s=t.vars.reduce((e,t)=>e+t+", ","").slice(0,-2),i=t.funcs.reduce((e,t)=>e+t+", ","").slice(0,-2),a=(s?`undefined vars [${s}]`:"")+(i?`, undefined funcs [${i}]`:"");this.error(new Error(a+", click the button to add.")),1===this.isError&&this.elt.querySelector(".main .not-exist").remove();let n="",r="";t.vars.length>0&&(n="<div><span>vars: </span>",n+=t.vars.reduce((e,t)=>e+`<button class="var btn-3">${t}</button>`,"")||"",n+=t.vars.length>1?'<button class="all-vars btn-1">all</button>':"",n+="</div>"),t.funcs.length>0&&(r="<div><span>funcs: </span>",r+=t.funcs.reduce((e,t)=>e+`<button class="func btn-3">${t}</button>`,"")||"",r+=t.funcs.length>1?'<button class="all-funcs btn-1">all</button>':"",r+="</div>");let o=$(`<div class='not-exist'>${n+r}</div>`),h=this;$(".var",o).bind("click",(function(){O(`${this.innerText} = 1`,parseInt(h.orderELT.textContent))})),$(".func",o).bind("click",(function(){let e,t="a",s=0;for(;Math.hasOwnProperty(t)&&!e;)s>300?(t="a",e=1):t=s>100?String.fromCharCode(math.random(65,90)):String.fromCharCode(math.random(97,122)),s++;O(`${this.textContent}\\left(${t}\\right) = ${t}`,parseInt(h.orderELT.textContent))})),$(".all-vars",o).bind("click",()=>{let e=this.elt.querySelectorAll(".not-exist .var");for(let t of e)t.click()}),$(".all-funcs",o).bind("click",()=>{let e=this.elt.querySelectorAll(".not-exist .func");for(let t of e)t.click()}),this.elt.querySelector(".main").append(o[0]),this.isError=1}else{if(this.isError){this.elt.querySelector(".error-elt").setAttribute("aria-label",e.message)}else{this.elt.classList.add("error"),this.isError=!0,this.graphChild.renderable=!1;let t=$('\n            <div class="error-elt">\n               <i class="fas fa-bug"></i>\n            </div>\n            ');t[0].setAttribute("data-balloon-pos","right"),t[0].setAttribute("aria-label",e.message),t.hide(),this.elt.querySelector(".side-status").append(t[0]),t.fadeOut(0).delay(200).fadeIn(500)}console.log(e)}}remove(e=!0){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),function(e){if(e===A.focusedControl){let t=e.elt.previousElementSibling||e.elt.nextElementSibling;t&&mySketch.children.get(t.getAttribute("id")).control.focus()}e.elt.remove();var t=document.querySelector(".controls"),s=t.parentElement.querySelector("#add-new-control");0===t.childElementCount&&(s.classList.add("animate-shake"),t.parentElement.classList.add("blink-error"),setTimeout(()=>{s.classList.remove("animate-shake"),t.parentElement.classList.remove("blink-error"),O(new x)},400))}(this),e&&(this.graphChild&&this.graphChild.remove(),this.__updateDependants()),mySketch.update()}__updateElts(e,t){if(e&&t&&e.constructor!==t.constructor){this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()})}1===this.isError&&this.elt.querySelector(".not-exist").remove(),this.isError&&(this.elt.classList.remove("error"),this.elt.querySelector(".error-elt").remove(),this.isError=!1),t&&(t instanceof y?this.__toEmpty():t instanceof g?e instanceof g?this.__updateXfunction():this.__toXfunction():t instanceof m?e instanceof m?this.__updateEvalExpr():this.__toEvalExpr():t instanceof p?e instanceof p?this.__updateVariable():this.__toVariable():t instanceof f&&(e instanceof f?this.__updateSlider():this.__toSlider()))}__toEmpty(){this.elt.querySelector(".side-status")}__toXfunction(){let e=this.elt.querySelector(".side-status"),t=$('<div class="visible-elt special-elt visible"><div class="inner"></div></div>');t.bind("click",()=>{t.toggleClass("visible"),this.graphChild.renderable=t.hasClass("visible"),this.graphChild.update(),mySketch.draw()}),e.append(t[0]),this.__updateXfunction()}__updateXfunction(){this.elt.querySelector(".side-status").querySelector(".visible").setAttribute("style",`--color: ${this.graphChild.pen.color.toString()}`)}__toEvalExpr(){let e=$('<div class="value special-elt"><span></span></div>');e.hide(),this.elt.querySelector(".main").append(e[0]),e.fadeIn();let t=$('<div class="value-type special-elt" type=decimal>\n            <span><i class="fas fa-divide"></i></span>\n         </div>');this.elt.querySelector(".side-status").append(t[0]),t.click(()=>{switch(t.attr("type")){case"decimal":t.attr("type","fract"),e.height(56);break;case"fract":t.attr("type","quotient"),e.height(56);break;case"quotient":t.attr("type","decimal"),e.height(33)}this.__updateEvalExpr()}),this.specialProps={valueType:t[0],valueElt:e[0]}}__updateEvalExpr(){try{let e=this.graphChild.eval();if(isNaN(e))this.specialProps.valueElt.innerHTML="<span>NaN</span>";else switch(e+=0,e=parseFloat(e.toFixed(10)),this.specialProps.valueType.getAttribute("type")){case"decimal":this.specialProps.valueElt.innerHTML=`<span>${e}</span>`;break;case"fract":if(e.indexOf(".")>-1&&e.split(".")[1].length<5){let t=MathPackage.Core.fraction(e);1===t.denominator?this.specialProps.valueElt.innerHTML=`<span>${t.numerator}</span>`:(this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}else this.specialProps.valueElt.innerHTML=`<span>${e}</span>`;break;case"quotient":if(e.indexOf(".")>-1&&e.split(".")[1].length<5){let t=MathPackage.Core.quotientRemainder(e);0===t.numerator?this.specialProps.valueElt.innerHTML=`<span>${t.quotient}</span>`:(0==t.quotient?this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`:this.specialProps.valueElt.innerHTML=`<span>${t.quotient}\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}else this.specialProps.valueElt.innerHTML=`<span>${e}</span>`}}catch(e){this.specialProps.valueElt.innerHTML="<span>NaN</span>",this.error(e)}}__toSlider(){let e=$('\n      <div class="slider-outer special-elt">\n         <div class=\'range-container\'>\n            <span class=\'slider-controller-toggle\'>\n               <i class="fas fa-angle-right right"></i>\n            </span>\n            <input type=range class=slider min=-5 max=5 step=0.01 />\n            <span class=\'play-pause\'>\n               <svg role="img" width=15 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                  <path class="path"></path>\n               </sbg>\n            </span>\n         </div>\n         <div class=\'slider-controller\'>\n            <label>min</label>:<span class="math-field min">-5</span>\n            <label>max</label>:<span class="math-field max">5</span>\n            <label>step</label>:<span class="math-field step">0.01</span>\n         </div>\n      </div>');this.elt.querySelector(".main").append(e[0]);let t=$(".slider",e),s={min:MQ.MathField(e[0].querySelector(".slider-controller .math-field.min"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].min=n(s.min.latex())()}}}),max:MQ.MathField(e[0].querySelector(".slider-controller .math-field.max"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].max=n(s.max.latex())()}}}),step:MQ.MathField(e[0].querySelector(".slider-controller .math-field.step"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].step=n(s.step.latex())()}}}),dir:"oscillate",speed:400,speedModifier:1};this.specialProps={$slider:t,attrs:s,invokeOnchange:!0},t.on("change",(e,...s)=>{this.specialProps.invokeOnchange&&(this.graphChild.setValue(parseFloat(t[0].value),s),this.setScript(this.graphChild.id+" = "+t[0].value,!1))}).on("mousemove touchmove",()=>{t[0].ismousedown&&t.trigger("change",!1)}).on("mousedown touchstart",()=>{e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].ismousedown=!0}).on("mouseup touchend",()=>{t[0].ismousedown=!1}),$(".slider-controller-toggle",e).bind("click",()=>{e.toggleClass("controller-opended")}),$(".play-pause",e).bind("click",()=>{e.toggleClass("play"),e.hasClass("play")?T.push(this):T.pop(this)}),this.__updateSlider()}__updateSlider(){let e=this.specialProps.$slider[0],t=this.graphChild.getValue();this.specialProps.attrs.min.latex(Math.min(parseFloat(e.min),parseFloat(t))),this.specialProps.attrs.max.latex(Math.max(parseFloat(e.max),parseFloat(t))),this.specialProps.invokeOnchange=!1,e.value=t,this.specialProps.invokeOnchange=!0}__toVariable(){this.specialProps={}}__updateVariable(){}}class v{constructor(e){this.gs=e,this.coorManager=e.coorManager,this.handlers={},this.angleMargin=angles.deg(20),this.zoomLimits=[80,180],this.zoomLimits[1]=2*this.zoomLimits[1]/5<this.zoomLimits[0]?5*this.zoomLimits[0]/2+1:this.zoomLimits[0],this.zoomRatio=1.1,this.invokeOnchange=!0,this.reset()}get iVector(){return vector.fromAngle(-this.xAngle).mult(this.xScale)}get jVector(){return vector.fromAngle(-this.yAngle).mult(this.yScale)}getTransform(){let e=this.iVector,t=this.jVector,s=this.center;return{a:e.x,b:e.y,c:t.x,d:t.y,e:s.x,f:s.y}}get transformOrigin(){return this._transformOrigin}set transformOrigin(e){if(e&&e instanceof vector){this._transformOrigin={pxVector:e};let t=this.coorManager.pxTOcoor(e.x,e.y);this._transformOrigin.coorVector=new vector(t.x,t.y)}else this._transformOrigin=void 0}get xAngle(){return this._xAngle}set xAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._yAngle+Math.PI-this.angleMargin)))))}this._xAngle=t}get yAngle(){return this._yAngle}set yAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._xAngle+Math.PI-this.angleMargin)))))}this._yAngle=t}rotate(e,t="rad"){if(!isNaN(e)){"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.xAngle+=e,this.yAngle+=e,this.invokeOnchange=s,this.onchange()}}rotateX(e,t="rad"){if(!isNaN(e)){"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.xAngle+=e,this.invokeOnchange=s,this.onchange()}}rotateY(e,t="rad"){if(!isNaN(e)){this.invokeOnchange=!1,"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.yAngle+=e,this.invokeOnchange=s,this.onchange()}}get center(){return this._center}set center(e){this._center=e,this.onchange(this.invokeOnchange,!1)}translate(e){this.center=new vector(this._center.x+e.x,this._center.y+e.y)}zoomIn(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e;let t=this.invokeOnchange;this.invokeOnchange=!1,this.xZoomIn(),this.yZoomIn(),this.invokeOnchange=t,this.onchange()}zoomOut(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e;let t=this.invokeOnchange;this.invokeOnchange=!1,this.xZoomOut(),this.yZoomOut(),this.invokeOnchange=t,this.onchange()}xZoomIn(){this.xSpace<=this.zoomLimits[1]&&(this.xSpace*=this.zoomRatio),this.reformXspace(),this.onchange()}xZoomOut(){this.xSpace>=this.zoomLimits[0]&&(this.xSpace/=this.zoomRatio),this.reformXspace(),this.onchange()}yZoomIn(){this.ySpace<=this.zoomLimits[1]&&(this.ySpace*=this.zoomRatio),this.reformYspace(),this.onchange()}yZoomOut(){this.ySpace>=this.zoomLimits[0]&&(this.ySpace/=this.zoomRatio),this.reformYspace(),this.onchange()}setViewport(e,t){e.xmin=0===e.xmin?0:e.xmin||this.gs.viewport.xmin,e.xmax=0===e.xmax?0:e.xmax||this.gs.viewport.xmax,e.ymin=0===e.ymin?0:e.ymin||this.gs.viewport.ymin,e.ymax=0===e.ymax?0:e.ymax||this.gs.viewport.ymax;let s=this.invokeOnchange;this.invokeOnchange=!1;let i=this.coorManager.pxTOcoor(this.gs.width/2,this.gs.height/2),a=this.xSpace,n=this.ySpace;this.xSpace=this.xSpace/((e.xmax-e.xmin)/(this.gs.viewport.xmax-this.gs.viewport.xmin)),t?this.ySpace*=this.xSpace/a:this.ySpace=this.ySpace/((e.ymax-e.ymin)/(this.gs.viewport.ymax-this.gs.viewport.ymin)),(this.ySpace<=0||this.xSpace<=0||isNaN(this.xSpace)||!isFinite(this.xSpace)||isNaN(this.ySpace)||!isFinite(this.ySpace))&&(this.xSpace=a,this.ySpace=n),this.reformXspace(),this.reformYspace(),this.onchange(!0);let r=this.coorManager.coorTOpx(e.xmin,e.ymax);if(r=new vector(r.x,r.y),this.translate(r.mult(-1)),this.onchange(!0),t){let t=this.coorManager.coorTOpx(i.x,(e.ymax+e.ymin)/2);this.translate(new vector(0,this.gs.height/2-t.y))}this.onchange(),this.invokeOnchange=s}getViewport(e){e.xmin=e.xmin||0,e.xmax=e.xmax||this.gs.width,e.ymin=e.ymin||0,e.ymax=e.ymax||this.gs.height;let t=this.coorManager.xTOcoor(e.xmin,Math.tan(this.yAngle)>0?e.ymin:e.ymax),s=this.coorManager.xTOcoor(e.xmax,Math.tan(this.yAngle)<=0?e.ymin:e.ymax),i=this.coorManager.yTOcoor(Math.tan(this.xAngle)>0?e.xmax:e.xmin,e.ymax),a=this.coorManager.yTOcoor(Math.tan(this.xAngle)<=0?e.xmax:e.xmin,e.ymin);return{xmin:s<t?s:t,xmax:s>t?s:t,ymin:a<i?a:i,ymax:a>i?a:i}}reformXspace(){let e=!1;for(;this.xSpace>this.zoomLimits[1];){if(5==this.xZoomingState){this.xZoomingState=2;let e=.4;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=1;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(1==this.xZoomingState){this.xZoomingState=5;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}e=!0}if(!e)for(;this.xSpace<this.zoomLimits[0];)if(1==this.xZoomingState){this.xZoomingState=2;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=5;let e=2.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(5==this.xZoomingState){this.xZoomingState=1;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}}reformYspace(){let e=!1;for(;this.ySpace>this.zoomLimits[1];){if(5==this.yZoomingState){this.yZoomingState=2;let e=.4;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=1;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(1==this.yZoomingState){this.yZoomingState=5;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}e=!0}if(!e)for(;this.ySpace<this.zoomLimits[0];)if(1==this.yZoomingState){this.yZoomingState=2;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=5;let e=2.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(5==this.yZoomingState){this.yZoomingState=1;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}}reset(){this.transformOrigin=void 0,this.xSpace=120,this.xSpaceValue=2,this.xSpaceModifier=1,this.xZoomingState=2,this.ySpace=120,this.ySpaceValue=2,this.ySpaceModifier=1,this.yZoomingState=2,this._xAngle=0,this._yAngle=Math.PI/2,this._center=new vector(this.gs.width/2,this.gs.height/2),this.onchange()}assign(e,t){e.xSpace=t.xSpace,e.xSpaceValue=t.xSpaceValue,e.xSpaceModifier=t.xSpaceModifier,e.xZoomingState=t.xZoomingState,e.ySpace=t.ySpace,e.ySpaceValue=t.ySpaceValue,e.ySpaceModifier=t.ySpaceModifier,e.yZoomingState=t.yZoomingState,e._xAngle=t._xAngle,e._yAngle=t._yAngle,e._center=t._center}onchange(e=this.invokeOnchange,t=!0){if(e){let e=this.xSpaceModifier+Math.abs(Math.cos(this.xAngle-this.yAngle)),s=this.ySpaceModifier+Math.abs(Math.cos(this.xAngle-this.yAngle));this.xScale=this.xSpace*e/this.xSpaceValue,this.yScale=this.ySpace*s/this.ySpaceValue;let i=!math.isNumeric(this.xScale)||!math.isNumeric(this.yScale)||!math.isNumeric(this.center.x)||!math.isNumeric(this.center.y)||this.transformOrigin&&t&&(!math.isNumeric(this.transformOrigin.coorVector.x)||!math.isNumeric(this.transformOrigin.coorVector.y)||!math.isNumeric(this.transformOrigin.pxVector.x)||!math.isNumeric(this.transformOrigin.pxVector.y));if(i){let e=this.invokeOnchange;this.invokeOnchange=!1;try{this.assign(this,this.lastVersion.transform)}catch(e){this.reset()}return this.invokeOnchange=e,void this.onchange(!0)}this.coorManager.transform=this.getTransform();let a=this.getViewport({xmin:0,xmax:this.gs.width,ymin:0,ymax:this.gs.height});if(a.width=a.xmax-a.xmin,a.height=a.ymax-a.ymin,this.gs.viewport=a,this.gs.drawingStep=(this.gs.viewport.xmax-this.gs.viewport.xmin)/1e4,i=!math.isNumeric(this.gs.viewport.xmin)||!math.isNumeric(this.gs.viewport.xmax)||!math.isNumeric(this.gs.viewport.ymin)||!math.isNumeric(this.gs.viewport.ymax)||!math.isNumeric(this.gs.drawingStep)||this.gs.viewport.xmax-this.gs.viewport.xmin>1e12||this.gs.viewport.ymax-this.gs.viewport.ymin>1e12||this.gs.viewport.xmax-this.gs.viewport.xmin<1e-12||this.gs.viewport.ymax-this.gs.viewport.ymin<1e-12||this.gs.viewport.xmin+this.gs.drawingStep/2<=this.gs.viewport.xmin||this.gs.viewport.xmax-this.gs.drawingStep/2>=this.gs.viewport.xmax,i&&this.lastVersion){let e=this.invokeOnchange;this.invokeOnchange=!1;try{this.assign(this,this.lastVersion.transform)}catch(e){this.reset()}return this.invokeOnchange=e,void this.onchange(!0)}{if(this.transformOrigin&&t){let e=this.invokeOnchange;this.invokeOnchange=!1;let t=this.coorManager.coorTOpx(...this.transformOrigin.coorVector.toArray());return this.translate(this.transformOrigin.pxVector.subtract(t)),this.onchange(!0,!1),void(this.invokeOnchange=e)}this.handlers.onchange&&this.handlers.onchange();let e={};this.assign(e,this),this.lastVersion={transform:e}}}}}class S{constructor(e){this.transform=e||{a:1,b:0,c:0,d:1,e:0,f:0}}get transform(){return this.trans}set transform(e){this.e=e.e,this.f=e.f,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d;let t=(e=>{let t={},s=e.a*e.d-e.c*e.b;return t.a=e.d/s,t.d=e.a/s,t.c=-e.c/s,t.b=-e.b/s,t})(e);this.ia=t.a,this.ib=t.b,this.ic=t.c,this.id=t.d}coorTOpx(e,t){return{x:this.xToPixel(e,t),y:this.yToPixel(e,t)}}pxTOcoor(e,t){return{x:this.xTOcoor(e,t),y:this.yTOcoor(e,t)}}xToPixel(e,t){return this.a*e+this.c*t+this.e}yToPixel(e,t){return this.b*e+this.d*t+this.f}xTOcoor(e,t){return e-=this.e,t-=this.f,this.ia*e+this.ic*t}yTOcoor(e,t){return e-=this.e,t-=this.f,this.ib*e+this.id*t}}class w{constructor(e,t,s){this.sketch=e,this._width=t,this._height=s,this.coorManager=new S,this.transform=new v(this),this.center=new vector(this.width/2,this.height/2),this.physicsRun=!1}get coor(){return this.sketch.coor}get width(){return this._width||0}set width(e){this._width=e,this.transform.onchange()}get height(){return this._height||0}set height(e){this._height=e,this.transform.onchange()}get center(){return this.transform.center}set center(e){this.transform.center=e}get iVector(){return this.transform.iVector}get jVector(){return this.transform.jVector}centrate(){this.transform.center=new vector(this.width/2,this.height/2)}reset(){this.transform.reset()}checkId(t){if(!t)throw new Error("can't set a falsy value to the name of this sketch child.");let s=t.replace(/^\s*([_a-zA-z]+\d*)\s*$/,"$1");if(!s)throw new Error(`"${t}" is not valid to use.`);if(this.sketch.children.has(t))throw new e(t);if(Math.hasOwnProperty(t))throw new e(t);return s}}class k{constructor(e,t){this.gs=e,this.coorManager=this.gs.coorManager;let s={type:"default",xUnit:"",yUnit:"",background:new drawing.color(255,255,255,255),font:"Georgia",drawDecimalLines:!0,drawMainLines:!0,drawAxisesLines:!0,drawPolarCircles:!1,drawPolarLines:!1,drawPolarAngles:!1,drawNumbers:!0,decimalLinesSpace:5,polarCirclesSpace:5,polarLinesAnglesSpace:6,penDecimalLines:null,penMainLines:null,penXaxis:null,penYaxis:null,penPolarCircles:null,penPolarLines:null,autoRefiningOnZoomimg:!0};Object.assign(s,{color:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),antiBackground:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),drawDecimalLines:!s.background.isDark(),penDecimalLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,30/255):new drawing.color(50,50,50,30/255),1),penMainLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,100/255),1),penXaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penYaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penPolarCircles:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1),penPolarLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1)}),Object.assign(s,{fillColor:s.color.toString(),fillColorDim:s.color.toString({a:.5})}),t?(this.coorSettings={},Object.assign(this.coorSettings,s),Object.assign(this.coorSettings,t)):this.coorSettings=s}draw(e){switch(this.coorSettings.type){case"default":this.custom(e);break;case"rad":this.radian(e)}}custom(e,t=1){let s,i,a,n;if(s=Math.floor(this.gs.viewport.xmin/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,a=Math.ceil(this.gs.viewport.xmax/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,i=Math.floor(this.gs.viewport.ymin/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,n=Math.ceil(this.gs.viewport.ymax/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,this.coorSettings.drawDecimalLines){e.ctx.beginPath(),this.coorSettings.penDecimalLines.setup(e);for(let r=s;r<=a;r+=this.gs.transform.xSpaceValue*t/this.coorSettings.decimalLinesSpace)e.line(this.coorManager.xToPixel(r,i),this.coorManager.yToPixel(r,i),this.coorManager.xToPixel(r,n),this.coorManager.yToPixel(r,n));for(let t=i;t<=n;t+=this.gs.transform.ySpaceValue/this.coorSettings.decimalLinesSpace)e.line(this.coorManager.xToPixel(s,t),this.coorManager.yToPixel(s,t),this.coorManager.xToPixel(a,t),this.coorManager.yToPixel(a,t));e.ctx.stroke()}if(this.coorSettings.drawMainLines){e.ctx.beginPath(),this.coorSettings.penMainLines.setup(e);for(let r=s;r<=a;r+=this.gs.transform.xSpaceValue*t)e.line(this.coorManager.xToPixel(r,i),this.coorManager.yToPixel(r,i),this.coorManager.xToPixel(r,n),this.coorManager.yToPixel(r,n));for(let t=i;t<=n;t+=this.gs.transform.ySpaceValue)e.line(this.coorManager.xToPixel(s,t),this.coorManager.yToPixel(s,t),this.coorManager.xToPixel(a,t),this.coorManager.yToPixel(a,t));e.ctx.stroke()}if(this.coorSettings.drawAxisesLines&&(e.ctx.beginPath(),this.coorSettings.penXaxis.setup(e),e.line(this.coorManager.xToPixel(s,0),this.coorManager.yToPixel(s,0),this.coorManager.xToPixel(a,0),this.coorManager.yToPixel(a,0)),e.ctx.stroke(),e.ctx.beginPath(),this.coorSettings.penYaxis.setup(e),e.line(this.coorManager.xToPixel(0,i),this.coorManager.yToPixel(0,i),this.coorManager.xToPixel(0,n),this.coorManager.yToPixel(0,n)),e.ctx.stroke()),this.coorSettings.drawNumbers){let r,o,h,c,l;s=Math.floor(s/this.gs.transform.xSpaceValue/t),a=Math.ceil(a/this.gs.transform.xSpaceValue/t),i=Math.floor(i/this.gs.transform.ySpaceValue),n=Math.ceil(n/this.gs.transform.ySpaceValue),e.ctx.fillStyle=this.coorSettings.fillColor,e.ctx.strokeStyle=this.coorSettings.background.toString(),e.ctx.lineWidth=3,e.setFont({size:15}),Math.abs(Math.tan(this.gs.transform.yAngle))>Math.abs(Math.tan(this.gs.transform.xAngle))?(c="v",l="h"):(c="h",l="v");for(let i=s;i<=a;i+=1)if(o=i*this.gs.transform.xSpaceValue,h=Math.abs(o)<.001||Math.abs(o)>=999999?o.toExponential(3).replace(/\.?0+e\+?/,"×10^"):o.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=o){h+=(t===Math.PI/2?"pi":"")+this.coorSettings.xUnit;let s=this.__getLabelPos(e,this.coorManager.coorTOpx(o,0),h,c,this.gs.transform.jVector);e.ctx.strokeText(h,s.x,s.y),e.ctx.fillText(h,s.x,s.y)}for(let t=i;t<=n;t+=1)if(r=t*this.gs.transform.ySpaceValue,h=Math.abs(r)<.001||Math.abs(r)>=999999?r.toExponential(3).replace(/\.?0+e\+?/,"×10^"):r.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=r){h+=this.coorSettings.yUnit;let t=this.__getLabelPos(e,this.coorManager.coorTOpx(0,r),h,l,this.gs.transform.iVector);e.ctx.strokeText(h,t.x,t.y),e.ctx.fillText(h,t.x,t.y)}}}radian(e){this.custom(e,Math.PI/2)}__getLabelPos(e,t,s,i,a){let n=e.measureString(s);if(n.height=10,t=new vector(t.x+4,t.y+4),"h"===i){let e=[10,this.gs.width-n.width-10];if(t.x<e[0]){let s=(e[0]-t.x)/a.x;return t.add(a.mult(s))}if(t.x>e[1]){let s=(e[1]-t.x)/a.x;return t.add(a.mult(s))}return t}{let e=[10,this.gs.height-n.height-10];if(t.y<e[0]){let s=(e[0]-t.y)/a.y;return t.add(a.mult(s))}if(t.y>e[1]){let s=(e[1]-t.y)/a.y;return t.add(a.mult(s))}return t}}}class b{constructor(e){this.canvas=new o({parent:e,attributes:{id:"canvas"}}),this.childrenCanvas=new o({parent:e,attributes:{id:"children-canvas"}}),this.gs=new w(this,this.canvas.width,this.canvas.height),this.coor=new k(this.gs),this.children=new Map,this.scriptParser=new MagicalParser.CustomParsers.Math,this.childrenCanvas.ctx.miterLimit=1}childFromScript(e,t={}){let s=this.getChildParser.parse(e.replace(/\^/g,"**"));return childFromParsed(s,t)}childFromParsed(e,t={}){if(t.sketch=this,""===e.type)return new y(t);if("="===e.name){let s=e.args[0],i=e.args[1];if(s.check({type:"variable",name:"y"})&&!i.contains({type:"variable",name:"y"}))return new g(Object.assign(t,{expr:i}));if(s.check({type:"functionCalling"})){if(1==s.args.length&&s.args[0].check({type:"variable",name:"x"})&&!i.contains({type:"variable",name:"y"}))return new g({sketch:this,expr:i,id:s.name});{let e,a=[];if(s.args[0].check({type:"separator",name:","}))for(let t of s.args[0].args)"variable"===t.type?a.push(t.name):e=!0;else"variable"!==s.args[0].type&&(e=!0),e||a.push(s.args[0].name);if(!e)return new u(Object.assign(t,{id:s.name,params:a,expr:i}))}}else{if("variable"===s.type&&"number"===i.type)return new f(Object.assign(t,{id:s.name,value:i.value}));if("variable"===s.type&&i.check({type:"prefixOperator",name:"-"})&&"number"===i.args[0].type)return new f(Object.assign(t,{id:s.name,value:-i.args[0].value}));if("variable"===s.type)return new p(Object.assign(t,{id:s.name,value:i}))}}else{if(e.contains({type:"variable",name:"x"}))return new g(Object.assign(t,{expr:e}));if(e.check({type:"block",name:"()"})&&1==e.args.length&&e.args[0].check({type:"separator",name:",",length:2})&&!vars.contains("t"))return new d(Object.assign({x:e.args[0].args[0],y:e.args[0].args[1]},t))}return new m(Object.assign(t,{expr:e,drawable:!1}))}getChildById(e){return this.children.get(e)}update(e=!0,t=!0){if("updating"===this.status||"re-updating"===this.status)this.status="re-update";else{this.status="updating";for(let e of this.children.values())e&&e.update();e&&this.draw(t),"re-update"===this.status?(this.status="ready",this.update(e,t)):this.status="ready"}}draw(e=!0){e&&(this.canvas.clear(),this.coor.draw(this.canvas)),this.childrenCanvas.clear();for(let e of this.children.values())e&&e.draw(this.childrenCanvas)}}var M={details:SUI.TempMessege({layer:!1,toolsbar:!0,onhoverFix:!0,position:{bottom:20,left:20},duration:2500,content:'<p style="background: green; color:white;">There is no god but Allah',parent:document.querySelector("#canvas-parent").parentElement})},C={x:void 0,y:void 0},A={backspaceInterval:void 0,mouseDownForInterval:!1,showHideKeyBtn:document.querySelector(".sh-keypad"),mathField:document.querySelector(".script")},_=document.querySelector(".sidebar-container");function P(){let e=document.querySelectorAll(".controls li"),t=1;for(let s of e)s.setAttribute("index",t-1),s.querySelector(".order").textContent=t++}function O(e,t="last",s=!0){let i=e;"string"===(typeof e).toLowerCase()&&(i=new x,i.mathField.latex(e));var a=document.querySelector(".controls");let n="last"===(t=math.isNumeric(t)&&t>a.childElementCount-1?"last":t)?a.childElementCount-1:t;n>-1&&"last"!==t?(i.elt.querySelector(".order").textContent=n+1,a.insertBefore(i.elt,a.children[n]),P()):(i.elt.setAttribute("index",a.childElementCount),i.elt.querySelector(".order").textContent=a.childElementCount+1,a.appendChild(i.elt)),s&&i.focus()}function E(e=!0){document.body.style.height=window.innerHeight+"px",V(),mySketch.canvas.resize(canvasParent.clientWidth,canvasParent.clientHeight),mySketch.childrenCanvas.resize(canvasParent.clientWidth,canvasParent.clientHeight),mySketch.gs.transform.invokeOnchange=!1,mySketch.gs.width=canvasParent.clientWidth,mySketch.gs.height=canvasParent.clientHeight;let t=mySketch.gs.viewport;mySketch.gs.transform.onchange(!0),mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(t,!0),mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),e&&$(".resizer",_).draggable("option","containment",L(_)),mySketch.update(),E.prevSize={width:window.innerWidth,height:window.innerHeight}}function V(){window.innerWidth<=600&&E.prevSize.width>600?(document.body.querySelector(".app-container").classList.remove("large-screen"),document.body.querySelector(".app-container").classList.add("small-screen")):window.innerWidth>600&&E.prevSize.width<=600&&(document.body.querySelector(".app-container").classList.add("large-screen"),document.body.querySelector(".app-container").classList.remove("small-screen"))}function L(e){let t=window.getComputedStyle(e),s=parseInt(t.minWidth.replace("px","")),i=parseInt(t.maxWidth.replace("px",""));return s>i?[s,0,s,parseInt(t.height.replace("px",""))]:[s,0,i,parseInt(t.height.replace("px",""))]}V.prevSize={width:window.innerWidth,height:window.innerHeight};var T={workingSliders:[],interval:0,status:"all-stoped",push:function(e){let t=e.specialProps.$slider,s=t[0],i=e.specialProps.attrs,a={min:parseFloat(s.min),max:parseFloat(s.max),step:parseFloat(s.step),value:e.graphChild.getValue()},n={current:(a.value-a.min)/a.step,prev:(a.value-a.min)/a.step,max:(a.max-a.min)/a.step};this.workingSliders.push({sliderControl:e,stepConfig:n,sliderConfig:a,attrs:i,$slider:t}),"all-stoped"===this.status&&(this.status="working",this.startSlidersInterval())},pop:function(e){for(let t=0;t<this.workingSliders.length;t++)e===this.workingSliders[t].sliderControl&&this.workingSliders.splice(t,1);0===this.workingSliders.length&&(this.status="all-stoped",clearInterval(this.interval))},startSlidersInterval:function(){this.interval=setInterval(()=>{for(let e of this.workingSliders){let t=e.stepConfig,s=e.sliderConfig,i=e.$slider;if(t.current+=e.attrs.speed*e.attrs.speedModifier/1e3*15,Math.abs(t.current-t.prev)>1){switch(e.attrs.dir){case"oscillate":{let a=s.min+t.current*s.step;t.current<0||t.current>t.max?e.attrs.speedModifier*=-1:(i[0].value=a,i.trigger("change",!0,!1));break}case"forwards":{let e=s.min+t.current*s.step;t.current>t.max?t.current=0:(i[0].value=e,i.trigger("change",!0,!1));break}case"backwards":{let e=s.min+t.current*s.step;t.current<0?t.current=t.max:(i[0].value=e,i.trigger("change",!0,!1));break}}t.prev=t.current}}mySketch.update(!0,!1)},15)}};function q(){let e,t,s=MathPackage.Lines,i=i=>{e=!0;let a=n(canvas.elt);if("mousedown"===i.type)C.x=i.clientX-a.left,C.y=i.clientY-a.top;else{let e=i.touches[0];C.x=e.clientX-a.left,C.y=e.clientY-a.top}if(Object.assign(M,{type:M.type,mouse:new vector(C.x,C.y),iVector:mySketch.gs.transform.iVector,jVector:mySketch.gs.transform.jVector}),"move"===M.type)C.prev={x:C.x,y:C.y},C.vel={x:0,y:0},clearInterval(t);else if(M.type.search("axises")>-1){let e=s.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),t=s.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=30,a={x:s.distToLine(M.mouse,e),y:s.distToLine(M.mouse,t)};if(a.x<i&&a.y<i)M.axis="xy",M.xSpace=mySketch.gs.transform.xSapce,M.ySpace=mySketch.gs.transform.ySapce,M.xAngle=mySketch.gs.transform.xAngle,M.yAngle=mySketch.gs.transform.yAngle,M.transformOrigin=new vector(mySketch.gs.center.x,mySketch.gs.center.y),M.xPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penXaxis.color),M.yPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penYaxis.color),mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155),mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155);else if(a.x<i){M.axis="x",M.space=mySketch.gs.transform.xSapce,M.angle=mySketch.gs.transform.xAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.x!==mySketch.gs.center.x&&(e=M.mouse),M.transformOrigin=e,M.penColor=[mySketch.coor.coorSettings.penXaxis.color].slice()[0],mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155)}else if(a.y<i){M.axis="y",M.space=mySketch.gs.transform.ySapce,M.angle=mySketch.gs.transform.yAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.y!==mySketch.gs.center.y&&(e=M.mouse),M.transformOrigin=e,M.penColor=[mySketch.coor.coorSettings.penYaxis.color].slice()[0],mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155)}else M.axis=void 0;M.increment=0,mySketch.draw()}else if("zoom"===M.type){let e=document.createElement("div");e.classList.add("zoom-box"),canvasParent.append(e),M.boxElt=e,M.pxViewport={}}i.preventDefault()};canvasParent.addEventListener("mousedown",i),canvasParent.addEventListener("touchstart",i);let a=t=>{if(e){let e=n(canvas.elt);if("mousemove"===t.type)C.x=t.clientX-e.left,C.y=t.clientY-e.top;else{let s=t.touches[0];C.x=s.clientX-e.left,C.y=s.clientY-e.top}switch(M.type){case"move":mySketch.gs.transform.translate(new vector(C.x,C.y).subtract(M.mouse)),mySketch.update(),M.mouse=new vector(C.x,C.y);break;case"scale-axises":!function(e){if("x"==M.axis){let e=M.mouse,t=s.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),i=(math.dist(C.x,C.y,e.x,e.y)**2-s.distToLine(new vector(C.x,C.y),t)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.xAngle),new vector(C.x,C.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin,mySketch.gs.transform.xSpace+=i*s-M.increment,mySketch.gs.transform.reformXspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.iVector.mag/M.iVector.mag).toFixed(2)}`])}else if("y"==M.axis){let e=M.mouse,t=s.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=(math.dist(C.x,C.y,e.x,e.y)**2-s.distToLine(new vector(C.x,C.y),t)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(C.x,C.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin,mySketch.gs.transform.ySpace+=i*s-M.increment,mySketch.gs.transform.reformYspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.jVector.mag/M.jVector.mag).toFixed(2)}`])}else if("xy"==M.axis){let e=s.lineEquation(-(mySketch.gs.transform.yAngle+mySketch.gs.transform.xAngle)/2,mySketch.gs.center),t=s.projectionToLine(M.mouse,e),i=(math.dist(C.x,C.y,t.x,t.y)**2-s.distToLine(new vector(C.x,C.y),e)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let e=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(C.x,C.y).subtract(t)),s=e<Math.PI/2?1:e>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin;let a=(mySketch.gs.transform.ySpace+(i*s-M.increment))/mySketch.gs.transform.ySpace;a=math.constrain(a,.9,1.1),mySketch.gs.transform.ySpace*=a,mySketch.gs.transform.xSpace*=a,mySketch.gs.transform.reformYspace(),mySketch.gs.transform.reformXspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.jVector.mag/M.jVector.mag).toFixed(2)}`])}}();break;case"rotate-axises":!function(e){if("x"==M.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=angles.snapAngle(M.angle-t,[0,Math.PI]);let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("y"==M.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.yAngle=angles.snapAngle(M.angle-t,[Math.PI/2,3*Math.PI/2]);let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("xy"==M.axis&&math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=M.xAngle-t,mySketch.gs.transform.yAngle=M.yAngle-t;let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle)}`,`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle)}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}();break;case"zoom":!function(e){let t={xmin:M.mouse.x,ymin:M.mouse.y,xmax:C.x,ymax:C.y};M.pxViewport.xmin=Math.min(t.xmin,t.xmax),M.pxViewport.ymin=Math.min(t.ymin,t.ymax),M.pxViewport.xmax=Math.max(t.xmin,t.xmax),M.pxViewport.ymax=Math.max(t.ymin,t.ymax),M.pxViewport.width=M.pxViewport.xmax-M.pxViewport.xmin,M.pxViewport.height=M.pxViewport.ymax-M.pxViewport.ymin,t=M.pxViewport,t.width<10&&t.height<10&&(t.width=0,t.height=0);if(document.querySelector("#subtools-zoom-rr").checked||e.shiftKey){let e=angles.minAngle(vector.fromAngle(0),new vector(mySketch.gs.width,mySketch.gs.height)),i=s.lineEquation(e,M.mouse),a=s.projectionToLine(new vector(C.x,C.y),i);t={xmin:M.mouse.x,ymin:M.mouse.y,xmax:Math.round(a.x),ymax:Math.round(a.y)},M.pxViewport.xmin=Math.min(t.xmin,t.xmax),M.pxViewport.ymin=Math.min(t.ymin,t.ymax),M.pxViewport.xmax=Math.max(t.xmin,t.xmax),M.pxViewport.ymax=Math.max(t.ymin,t.ymax),M.pxViewport.width=M.pxViewport.xmax-M.pxViewport.xmin,M.pxViewport.height=M.pxViewport.ymax-M.pxViewport.ymin,t=M.pxViewport}else M.boxElt.classList.remove("v"),M.boxElt.classList.remove("h"),t.height<10&&t.width>10?(M.boxElt.classList.add("v"),t.ymin=0,t.ymax=mySketch.gs.height,t.height=mySketch.gs.height):t.height>10&&t.width<10&&(M.boxElt.classList.add("h"),t.xmin=0,t.xmax=mySketch.gs.width,t.width=mySketch.gs.width);let i=mySketch.coor.coorSettings.background.isDark()?"#fff5":"#0005";M.boxElt.setAttribute("style",`--left: ${t.xmin}px; --top: ${t.ymin}px; --width: ${t.width}px; --height: ${t.height}px; --background: ${i}`)}(t)}t.preventDefault()}};function n(e){let t={left:0,top:0};return e.offsetParent&&(t=n(e.offsetParent)),{left:e.offsetLeft+t.left,top:e.offsetTop+t.top}}window.addEventListener("mousemove",a,!0),window.addEventListener("touchmove",a,{passive:!1,capture:!0});let r=s=>{if(e)if(e=!1,"move"===M.type){for(clearInterval(t),C.vel=new vector(C.vel.x,C.vel.y);C.vel.mag>50;)C.vel=C.vel.mult(.9);t=setInterval(()=>{C.vel.mag>1&&(C.vel=C.vel.mult(.9)),mySketch.gs.transform.translate(C.vel),mySketch.update(),C.vel.mag<=1&&clearInterval(t)},10)}else M.type.search("axises")>-1?("x"==M.axis?mySketch.coor.coorSettings.penXaxis.color=M.penColor:"y"==M.axis?mySketch.coor.coorSettings.penYaxis.color=M.penColor:"xy"==M.axis&&(mySketch.coor.coorSettings.penXaxis.color=M.xPenColor,mySketch.coor.coorSettings.penYaxis.color=M.yPenColor),mySketch.draw()):"zoom"===M.type&&(M.boxElt.remove(),M.pxViewport.width&&M.pxViewport.height&&(mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(mySketch.gs.transform.getViewport(M.pxViewport))),o(["x: {",`  xmin: ${mySketch.gs.viewport.xmin},`,`  xmax: ${mySketch.gs.viewport.xmax}`,"},","y: {",`  ymin: ${mySketch.gs.viewport.ymin},`,`  ymax: ${mySketch.gs.viewport.ymax}`,"}"]),mySketch.update())};function o(e){let t='<div class="subtools-details">';for(let s of e)t+="<p>"+s+"</p>";t+="</div>",M.details.setContent(t),M.details.show()}window.addEventListener("mouseup",r),window.addEventListener("touchend",r),canvasParent.addEventListener("mousewheel",e=>{e.preventDefault();let t=n(canvas.elt);C.x=e.clientX-t.left,C.y=e.clientY-t.top;let s=mySketch.gs.center,i=C;MathPackage.Core.dist(C.x,C.y,s.x,s.y)<30&&(i=s),e.wheelDelta>0?(mySketch.gs.transform.zoomIn(new vector(i.x,i.y)),mySketch.update()):(mySketch.gs.transform.zoomOut(new vector(i.x,i.y)),mySketch.update())})}function z(){window.addEventListener("resize",E),window.addEventListener("mouseup",(function(e){A.mouseDownForInterval&&(A.mouseDownForInterval=!1,clearInterval(A.backspaceInterval)),A.hideKeyPad=!0})),window.addEventListener("touchend",(function(e){A.mouseDownForInterval&&(A.mouseDownForInterval=!1,clearInterval(A.backspaceInterval)),A.hideKeyPad=!0})),window.addEventListener("mousedown",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(A.showHideKeyBtn.className);A.hideKeyPad&&t&&A.showHideKeyBtn.click()})),window.addEventListener("touchstart",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(A.showHideKeyBtn.className);A.hideKeyPad&&t&&A.showHideKeyBtn.click()})),document.querySelector("#add-new-control").addEventListener("click",e=>{O(new x)}),document.querySelector("#show-hide-sidebar").addEventListener("click",(function(e){let t=$(this),s=t.hasClass("visible"),i=s?"visible":"unvisible",a=s?"unvisible":"visible";s?document.body.querySelector(".app-container").appendChild(this):_.querySelector(".header").append(this),t.removeClass(i),t.addClass(a),_.classList.remove(i),_.classList.add(a),E()})),q(),function(){let e=e=>{setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update())},20)},20)},20)},20)},20)},20)},20)})};document.querySelector("#zoom-in-btn").addEventListener("click",()=>{e("in")}),document.querySelector("#zoom-out-btn").addEventListener("click",()=>{e("out")}),document.querySelectorAll('.subtools-container input[type*="radio"]').forEach(e=>{M.type=e.checked?e.dataset.type:M.type,e.addEventListener("change",()=>{M.type=e.checked?e.dataset.type:M.type})}),document.querySelector("#home").addEventListener("click",()=>{mySketch.gs.reset(),mySketch.update()}),document.querySelector("#centrate").addEventListener("click",()=>{mySketch.gs.centrate(),mySketch.update()})}()}function I(){A.showHideKeyBtn.addEventListener("click",(function(e){/\svisible\s|^visible\s|\svisible$/.test(_.className)||document.querySelector("#show-hide-sidebar").click();let t=document.querySelector(".keypad-container"),s=$(this).hasClass("visible"),i=s?"visible":"unvisible",a=s?"unvisible":"visible";A.showHideKeyBtn.classList.remove(i),A.showHideKeyBtn.classList.add(a),t.classList.remove(i),t.classList.add(a),s?document.body.querySelector(".app-container").appendChild(A.showHideKeyBtn):t.insertBefore(A.showHideKeyBtn,t.firstElementChild),V.smallScreen&&E(),A.focusedControl.focus()})),SUI.tabs(document.body.querySelector(".keypad-container .tabs-1")),function(){let e=$(".keypad-container"),t=$(A.showHideKeyBtn);e.bind("focusin",(function(){A.mathField.focus()})),$(document.body).delegate("[cancel-hiding-keypad]","mousedown touchstart",(function(e){A.hideKeyPad=!1})),$(".control").delegate(".main","touchstart",(function(e){t.hasClass("hide")&&t.click()})),$(".keypad-container .rows button[mq-cmd]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.cmd($(" > div.active > span.active",e).attr("mq-cmd")):e.hasClass("shiftable")?A.mathField.cmd($(" > span.active",e).attr("mq-cmd")):A.mathField.cmd(this.getAttribute("mq-cmd")),A.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-write]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.write($(" > div.active > span.active",e).attr("mq-write")):e.hasClass("shiftable")?A.mathField.write($(" > span.active",e).attr("mq-write")):A.mathField.write(this.getAttribute("mq-write")),A.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-func]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.write($(" > div.active > span.active",e).attr("mq-func")):e.hasClass("shiftable")?A.mathField.write($(" > span.active",e).attr("mq-func")):A.mathField.write(this.getAttribute("mq-func")),A.mathField.cmd("("),A.focusedControl.focus()}))})),$(".space").on("click",(function(){A.mathField.keystroke("Right")})),$(".backspace").on("mousedown",(function(){""==A.mathField.latex()?A.focusedControl.remove():A.mathField.keystroke("Backspace"),A.mouseDownForInterval=!0,setTimeout((function(){A.mouseDownForInterval&&(A.backspaceInterval=setInterval((function(){A.mathField.keystroke("Backspace")}),120))}),400)})),$(".go-left").on("click",(function(){A.mathField.keystroke("Left")})),$(".go-right").on("click",(function(){A.mathField.keystroke("Right")})),$(".go-up").on("click",(function(){A.mathField.keystroke("Up")})),$(".go-down").on("click",(function(){A.mathField.keystroke("Down")})),$(".enter").on("click",(function(){O(new x,parseInt(A.focusedControl.orderELT.textContent))})),$(".shift").on("click",(function(){let e=$(this),t=e.parents(".rows");if(e.hasClass("active"))e.removeClass("active"),e.addClass("lock"),t.removeClass("shift-active"),t.addClass("shift-lock");else if(e.hasClass("lock")){$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.removeClass("lock"),t.removeClass("shift-lock")}else{$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.addClass("active"),t.addClass("shift-active")}})),$(".keypad-container .rows button").not(".shift, .double-shift").on("click",(function(){let e=$(this).parents(".rows");if(e.hasClass("shift-active")){let t=$("button.shift",e);$(".shiftable > span, .double-shiftable > div > span",e).toggleClass("active"),t.removeClass("active"),e.removeClass("shift-active")}})),$(".double-shift").on("click",(function(){let e=$(this);$(".double-shiftable > div",e.parents(".rows")).toggleClass("active"),e.toggleClass("active")}))}()}function F(e){window.MP=MathPackage,window.angles=MP.Angles,window.lines=MP.Lines,window.math=MP.Core,window.drawing=l,window.vector=MP.entities.Vector,window.MQ=MathQuill.getInterface(2),MQ.config({sumStartsWithNEquals:!0,supSubsRequireOperand:!0,autoSubscriptNumerals:!0,autoCommands:"pi theta sqrt abs floor ceil round random sum int prod",maxDepth:10}),window.mySketch=new b(e),window.canvas=mySketch.canvas,window.canvasParent=e,E.prevSize={width:1e3,height:1e3},V(),E.prevSize={width:window.innerWidth,height:window.innerHeight};let t=$(".math-field");for(let e=0;e<t.length;e++)MQ.StaticMath(t[e]);let s=$('\n      <li class="control">\n        <div class="side-status" cancel-move>\n          <div class="order-container">\n            <span class=\'order\'>123</span>\n          </div>\n        </div>\n        <div class="main" cancel-move cancel-hiding-keypad>\n          <div class=script-container><span type="text" class="script">NEW</span></div>\n        </div>\n        <div class="side-ctrl">\n          <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n          <span class="move">\n            <div>\n              <span>..</span>\n              <span>..</span>\n              <span>..</span>\n            </div>\n          </span>\n        </div>\n      </li>\n      ')[0];document.body.querySelector("#add-new-control").append(s),z(),I(),function(){var e=_.querySelector(".resizer");let t={};$(e).draggable({axis:"x",containment:L(_),start:s=>{e.classList.add("dragging"),t.intialWidth=_.clientWidth,t.intialOffset=s.pageX,t.cursor=document.body.style.cursor,document.body.style.cursor="e-resize"},stop:()=>{e.classList.remove("dragging"),_.style.flexBasis=e.style.left,document.body.style.cursor=t.cursor},drag:()=>{_.style.flexBasis=e.style.left,E(!1)}})}(),function(){var e=document.querySelector(".outer-controls"),t=e.querySelector(".inner-controls");let s=!0;$(".controls.sortable").sortable({axis:"y",cancel:".control [cancel-move]",start:function(i,a){s=!0,e.classList.add("sorting"),t.clientHeight>e.clientHeight&&(e.style.overflowY="scroll"),a.item[0].classList.add("dragging");let n=a.item[0].getAttribute("id");for(let e in mySketch.children)e.id!==n||e.focus()},stop:function(t,i){s?(e.classList.remove("sorting"),e.style.overflowY="auto",i.item[0].classList.remove("dragging")):s=!1},update:function(){P()}}),$(".controls.sortable").disableSelection()}(),E(),mySketch.gs.centrate(),mySketch.update(),console.log("%cPLOTTO","background: black; color: white; font: 50px consolas;"),console.log("%cWe are sciCave","color: blue; font: 25px consolas;"),O(new x)}return F(document.querySelector("#canvas-parent")),F}));
=======
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).PLOTTO=t()}(this,(function(){"use strict";class e extends Error{constructor(e){super('"'+e+'" has been defined before.'),this.id=e}}class t extends Error{constructor(e){super(""),this.undef=e}}function s(){return(Date.now()+s.randomNameNum++).toString(36)}s.randomNameNum=0;let i={log:function(e,t=10){return Math.log10(e)/Math.log10(t)},ln:e=>Math.log(e,Math.E),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),asec:e=>Math.acos(1/e),acsc:e=>Math.asin(1/e),acot:e=>Math.atan(1/e),sinh:e=>(Math.exp(e)-Math.exp(-e))/2,cosh:e=>(Math.exp(e)+Math.exp(-e))/2,tanh:e=>Math.sinh(e)/Math.cosh(-e),asinh:e=>Math.ln(e+Math.sqrt(e**2+1)),acosh:e=>Math.ln(e+Math.sqrt(e**2-1)),atanh:e=>.5*Math.ln((1+e)/(1-e)),sech:e=>1/Math.cosh(e),csch:e=>1/Math.sinh(e),coth:e=>1/Math.tanh(e),asech:e=>Math.acosh(1/e),acsch:e=>Math.asinh(1/e),acoth:e=>Math.atanh(1/e),fact:e=>e%1!=0||e<0?NaN:Math.__fact(e),__fact:e=>0===e?1:e*Math.__fact(e-1),gcd:(...e)=>{let t=Math.abs(e[0]),s=Math.abs(e[1]);if(t%1!=0||s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s);for(let i=2;i<e.length;i++){if(s=Math.abs(e[i]),s%1!=0)return NaN;t=s>t?Math.gcd2(s,t):Math.gcd2(t,s)}return t},gcd2:(e,t)=>0==t?e:Math.gcd(t,e%t),lcm:(...e)=>{let t,s=1;for(let i=0;i<e.length;i++){if(t=e[i],t%1!=0)return NaN;s*=t}return Math.abs(s)/Math.pow(Math.gcd(...e),e.length-1)},mod:(e,t)=>e%t};Object.assign(Math,i);let a={pi:Math.PI,e:Math.E};function n(e,s,i=!0,a=!0){let n;if(n=e instanceof MagicalParser.Node?MathPackage.Parser.parsedTOjsFunction(e,s,"Math",i):"object"===(typeof e).toLowerCase()?MathPackage.Parser.maximaTOjsFunction(MathPackage.Parser.latexTOmaxima(e.value),s,"Math",i):MathPackage.Parser.maximaTOjsFunction(e,s,"Math",i),a){if(n.undef.vars.length>0||n.undef.funcs.length>0)throw new t(n.undef);return n.func}return n.func}Object.assign(Math,a);class r{constructor(e,t){if(this.handlers=e.handlers||{},this.renderable=!e.hasOwnProperty("renderable")||e.renderable,e.hasOwnProperty("handlers")&&delete e.handlers,e.hasOwnProperty("renderable")&&delete e.renderable,!e.sketch)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has sketch property, or it is falsy value");this.sketch=e.sketch,this.gs=this.sketch.gs,this.coorManager=this.gs.coorManager,delete e.sketch,e.id=e.id||s(),Object.assign(this,e),t&&t(this),this.sketch.children.set(this.id,this)}get id(){return this._id}set id(e){this._id=this.sketch.gs.checkId(e)}update(e=[]){if(this.renderable)try{this._update(this.sketch.childrenCanvas,e)}catch(e){this.error(e)}this.handlers.onupdate&&this.handlers.onupdate(...e)}draw(){this.renderable&&this._draw(this.sketch.childrenCanvas)}_update(e){}_draw(e){}remove(e=[]){this._remove(),this.sketch.children.delete(this.id),this.handlers.onremove&&this.handlers.onremove(...e)}_remove(){}error(e){this.handlers.onerror(e)}}class o{constructor(e={}){if(this.elt=e.canvas||document.createElement("canvas"),e.parent&&(e.parent.appendChild(this.elt),this.elt.width=e.parent.clientWidth,this.elt.height=e.parent.clientHeight),e.attributes)for(let t in e.attributes)this.elt.setAttribute(t,e.attributes[t]);this.font={width:15,family:"Arial"},this.ctx=this.elt.getContext("2d"),this.ctx.textBaseline="top"}get width(){return this.elt.width}get height(){return this.elt.height}resize(e,t){let s=["lineJoin","textBaseline","miterLimit","lineWidth"],i={};for(let e of s)i[e]=this.ctx[e];this.elt.width=e,this.elt.height=t,Object.assign(this.ctx,i)}clear(e,t){e?(t=t||[0,0,this.elt.clientWidth,this.elt.clientHeight],this.ctx.fillStyle=e,this.ctx.fillRect(...t)):(t=t||[0,0,this.elt.clientWidth,this.elt.clientHeight],this.ctx.clearRect(...t))}setFont(e){e.size&&(this.font.size=e.size),e.family&&(this.font.family=e.family),this.ctx.font=`${this.font.size}px ${this.font.family}`}measureString(e){let t=this.ctx.measureText(e);return t.height=this.font.size,t}get transform(){return this._trans}set transform(e){this._trans=e;this._trans[0],this._trans[2],this._trans[1],this._trans[3]}setTransform(...e){this.transform=e,this.ctx.setTransform(...e)}getTransform(){return this.transform}get lineWidth(){return this.lw}set lineWidth(e){let t=((this._trans[0]+this._trans[2])**2+(this._trans[1]+this._trans[3])**2)**.5;this.ctx.lineWidth=e/t,this.lw=e}line(e,t,s,i){this.ctx.moveTo(e,t),this.ctx.lineTo(s,i)}ellipse(e,t,s,i,a=0,n=0,r=2*Math.PI,o=!1){i=i||s,this.ctx.beginPath(),this.ctx.ellipse(e,t,s,i||s,a,n,r,o),this.ctx.fill(),this.ctx.stroke()}}class h{constructor(e,t,s,i){this.r=e,this.g=t,this.b=s,this.a=i}get brightness(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,a=e;return t>i&&(i=t),s>i&&(i=s),t<a&&(a=t),s<a&&(a=s),(i+a)/2}get hue(){if(this.r==this.g&&this.g==this.b)return 0;let e=this.r/255,t=this.g/255,s=this.b/255,i=0,a=e,n=e;t>a&&(a=t),s>a&&(a=s),t<n&&(n=t),s<n&&(n=s);let r=a-n;return e==a?i=(t-s)/r:t==a?i=2+(s-e)/r:s==a&&(i=4+(e-t)/r),i*=60,i<0&&(i+=360),i}get saturation(){let e=this.r/255,t=this.g/255,s=this.b/255,i=e,a=e;return t>i&&(i=t),s>i&&(i=s),t<a&&(a=t),s<a&&(a=s),i==a?0:(i+a)/2<=.5?(i-a)/(i+a):(i-a)/(2-i-a)}isDark(){return!(this.brightness>.4)}toArray(e={}){return[e.r||0===e.r?e.r:this.r,e.g||0===e.g?e.g:this.g,e.b||0===e.b?e.b:this.b,e.a||0===e.a?e.a:this.a]}toString(e={}){return`rgba(${this.toArray(e).join(", ")})`}}class c{static brightness(e){let t=e.r/255,s=e.g/255,i=e.b/255,a=t,n=t;return s>a&&(a=s),i>a&&(a=i),s<n&&(n=s),i<n&&(n=i),(a+n)/2}static hue(e){if(e.r==e.g&&e.g==e.b)return 0;let t=e.r/255,s=e.g/255,i=e.b/255,a=0,n=t,r=t;s>n&&(n=s),i>n&&(n=i),s<r&&(r=s),i<r&&(r=i);let o=n-r;return t==n?a=(s-i)/o:s==n?a=2+(i-t)/o:i==n&&(a=4+(t-s)/o),a*=60,a<0&&(a+=360),a}static saturation(e){let t=e.r/255,s=e.g/255,i=e.b/255,a=t,n=t;return s>a&&(a=s),i>a&&(a=i),s<n&&(n=s),i<n&&(n=i),a==n?0:(a+n)/2<=.5?(a-n)/(a+n):(a-n)/(2-a-n)}static isDark(e){return!(c.brightness(e)>.35)}static randomColor(){return new h(MathPackage.Core.random(255),MathPackage.Core.random(255),MathPackage.Core.random(255))}static randomDarkColor(){let e=c.randomColor();do{e=c.randomColor()}while(!e.isDark());return e}static randomLightColor(){let e=c.randomColor();do{e=c.randomColor()}while(e.isDark());return e}}var l=Object.freeze({__proto__:null,pen:class{constructor(e,t=1,s="solid"){this.color=e,this.weight=t,this.style=s}setup(e){(e=e instanceof o?e.ctx:e).strokeStyle=this.color.toString(),e.lineWidth=this.weight}},color:h,colorPackage:c,measureString:function(e){return canvas.elt.getContext("2d").measureText(e)}});class g extends r{constructor(e){let t=e.id;if(!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+propName+" property, or it is falsy value");if(!e.pen){let t=e.sketch.coor.coorSettings.background.isDark()?l.colorPackage.randomLightColor():l.colorPackage.randomDarkColor();t.a=155,e.pen=new l.pen(t,2)}super(e,e=>{e.expression=n(e.expr,["x"],!0),e.path=new Path2D,t&&(Math[e.id]=e.expression)})}static fromString(e,t){if(str.replace(/==+/,"").indexOf("=")>-1)throw new Error('there is "=" opertor!');return new g({expr:e,sketch:t})}async _update(e){let t,s,i,a,n=new Path2D;for(let e=this.gs.viewport.xmin;e<=this.gs.viewport.xmax;e+=this.gs.drawingStep){t=this.coorManager.coorTOpx(e,this.expression(e)),i=this.coorManager.coorTOpx(e-this.gs.drawingStep/2,this.expression(e-this.gs.drawingStep/2)),!isNaN(t.x)&&!isNaN(t.y)&&Math.abs(t.x)<1e5&&Math.abs(t.y)<1e5&&(a&&(Math.sign(t.y-i.y)===Math.sign(i.y-s.y)||Math.abs(t.y-s.y)/this.gs.drawingStep<20)||!a)?(a?n.lineTo(t.x,t.y):n.moveTo(t.x,t.y),s={x:t.x,y:t.y},a=!0):a&&(a=!1)}this.path=n}_draw(e){let t=e.ctx;t.strokeStyle=this.pen.color.toString(),t.lineWidth=this.pen.weight,t.stroke(this.path)}_remove(){delete Math[this.id]}toString(){return this.expression}}class d extends r{constructor(e){let t;if(e.pen=e.pen||new drawing.pen(new drawing.color(0,0,255),10),t="x",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="y",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");super(e,e=>{e.x=n(e.x),e.y=n(e.y)})}static fromString(e,t){if(e){let s,i=/^\s*\(\s*(.+?)\s*,\s*(.+?)\s*\)\s*$/;if(e.replace(i,(e,i,a)=>{s=new d({sketch:t,x:i,y:a})}),s)return s;throw new Error("error while trying to add a point: "+e)}throw new Error("your str is empty :'(")}draw(e,t=[]){if(this.renderable){switch(this.pen.style){case"solid":e.strokeWeight(2),e.stroke(200),e.fill(...this.pen.color.toArray().splice(0,3),150);break;case"shallow":e.ctx.lineWidth=3,e.ctx.strokeStyle(this.pen.color.toString()),e.ctx.fillStyle(this.sketch.coor.coorSettings.background.toString())}let t=this.coorManager.coorTOpx(this.x.eval(),this.y.eval());e.ellipse(t.x,t.y,this.pen.weight,this.pen.weight)}this.handlers.onupdate&&this.handlers.onupdate(...t)}toString(){return`(${this.x}, ${this.y})`}}class m extends r{constructor(e){let t;if(t="expr",!e.expr)throw new Error("Your options passed to the shetchChild is not valid, it doesn't has expr property, or it is falsy value");super(e,e=>{e.evalFunc=n(e.expr)})}static fromString(e,t){if(e)return new m({expr:expr});throw new Error("your expression is empty :'(")}eval(){return this.evalFunc()}}class p extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="value",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");super(e,e=>{if(!e.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${e.id} is invalid.`);e.value={valueOf:n(e.value)},Math[e.id]=e.value})}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}_remove(){delete Math[this.id]}}class u extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="expr",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");if(t="params",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has name property, or it is falsy value");super(e,t=>{if(!t.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${t.id} is invalid.`);t.func=n(e.expr,e.params),Math[t.id]=t.func})}_remove(){delete Math[this.id]}}class y extends r{constructor(e){super(e)}}class f extends r{constructor(e){let t;if(t="id",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");if(t="value",!e[t])throw new Error("Your options passed to the shetchChild is not valid, it doesn't has "+t+" property, or it is falsy value");super(e,e=>{if(!e.id.match(/[a-zA-Z_]+\d*/))throw new Error(`${e.id} is invalid.`);Math[e.id]=e.value})}setValue(e,t=[]){Math[this.id]=e,this.handlers.onchange&&this.handlers.onchange(...t)}getValue(){return Math[this.id]}_remove(){delete Math[this.id]}}class x{constructor(e){this.elt=document.createElement("div"),this.elt.innerHTML=`\n      <li class="control" id="${this.id}">\n         <div class="side-status" cancel-move>\n            <div class="order-container">\n               <span class='order'>12</span>\n            </div>\n         </div>\n         <div class='main' cancel-move>\n            <div class=script-container>\n               <span type="text" class="script"></span>\n            </div>\n         </div>\n         <div class="side-ctrl">\n            <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n            <span class="move">\n               <div>\n                  <span>..</span>\n                  <span>..</span>\n                  <span>..</span>\n               </div>\n            </span>\n         </div>\n      </li>\n      `,this.elt=this.elt.childNodes[1],this.status="ready",this.graphChild=e||new y({sketch:mySketch,control:this}),this.__updateElts(null,this.graphChild),this.setEvents()}get id(){return this._id}set id(e){this._id=e,this.elt.id=e}get graphChild(){return this._graphChild}set graphChild(e){e instanceof m?e.handlers.onupdate=()=>{this.__updateEvalExpr()}:e instanceof f&&(e.handlers.onchange=(e=!0,t=!0)=>{e&&(this.specialProps.$slider[0].value=this._graphChild.getValue()),t&&mySketch.update(!0,!1)}),this._graphChild=e,this.id=e.id}setEvents(){let e=this.elt.querySelector(".script");this.removeELT=this.elt.querySelector(".remove"),this.orderELT=this.elt.querySelector(".order");let t=MQ.MathField(e,{handlers:{edit:()=>{this.update(t.latex())},enter:()=>{this.enter()}}});this.mathField=t,this.elt.querySelector(".main").addEventListener("focusin",e=>{this.focus(!1)}),this.elt.querySelector(".main").addEventListener("focusout",e=>{this.blur(!1)}),this.removeELT.addEventListener("click",e=>{this.remove()})}async update(e){if(!this.disableHandling)if("ready"===this.status){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),this.status="updating",this._graphChild.remove(),this.id=void 0;try{let t=this._graphChild;if(""===e)this.parsedScript=new MagicalParser.Node(""),this.graphChild=new y({sketch:mySketch});else{if(e&&(this.parsedScript=null,this.parsedScript=mySketch.scriptParser.parse(MathPackage.Parser.latexTOmaxima(e)),this.vars=this.__getAll(this.parsedScript,{type:"variable"}).map(e=>e.name),this.funcs=this.__getAll(this.parsedScript,{type:"functionCalling"}).map(e=>e.name)),!this.parsedScript)return;let t={handlers:{onremove:e=>{e&&this.remove(!1)},onerror:e=>{this.error(e)}},control:this};this.graphChild&&this.graphChild.pen&&(t.pen=this.graphChild.pen),this.graphChild=mySketch.childFromParsed(this.parsedScript,t)}this.__updateElts(t,this.graphChild)}catch(e){this.error(e)}this.id||this._graphChild&&(this.id=this._graphChild.id,mySketch.children.set(this.id,this.graphChild)),this.__updateDependants(),mySketch.update(),"re-update"===this.status?(this.status="ready",this.update(this.mathField.latex())):"updating"===this.status&&(this.status="ready")}else this.status="re-update"}__getAll(e,t={}){let s=[];if(e.check(t))return[e];for(let i=0;i<e.args.length;i++)s=s.concat(this.__getAll(e.args[i],t));return s}__updateDependants(e){if(this._graphChild instanceof p||this._graphChild instanceof f){let t=mySketch.children.size;mySketch.children.forEach(s=>{t--,t<0||s&&s!==this._graphChild&&s.control.vars&&s.control.vars.find(t=>this._graphChild.id===t||e&&t===e.id)&&s.control.update()})}if(this._graphChild instanceof u){let t=mySketch.children.size;mySketch.children.forEach(s=>{t--,t<0||s&&s.control!==this&&s.control.vars&&s.control.funcs.find(t=>this._graphChild.id===t||e&&t===e.id)&&s.control.update()})}}setScript(e,t=!0){t||(this.disableHandling=!0),this.mathField.latex(e),t||(this.disableHandling=!1)}focus(e=!0){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),A.focusedControl&&A.focusedControl!==this&&A.focusedControl.blur(),A.focusedControl=this,A.mathField=this.mathField,e&&this.mathField.focus(),this.elt.classList.add("focus")}blur(e=!0){e&&this.mathField.blur(),this.elt.classList.remove("focus")}enter(){let e=parseInt(this.orderELT.textContent);if(1===this.isError){this.blur();let t=this.elt.querySelectorAll(".not-exist .var");for(let s of t)s.click(),e++;let s=this.elt.querySelectorAll(".not-exist .func");for(let t of s)t.click(),e++}O(new x,e)}error(e){if(e instanceof t){let t=e.undef,s=t.vars.reduce((e,t)=>e+t+", ","").slice(0,-2),i=t.funcs.reduce((e,t)=>e+t+", ","").slice(0,-2),a=(s?`undefined vars [${s}]`:"")+(i?`, undefined funcs [${i}]`:"");this.error(new Error(a+", click the button to add.")),1===this.isError&&this.elt.querySelector(".main .not-exist").remove();let n="",r="";t.vars.length>0&&(n="<div><span>vars: </span>",n+=t.vars.reduce((e,t)=>e+`<button class="var btn-3">${t}</button>`,"")||"",n+=t.vars.length>1?'<button class="all-vars btn-1">all</button>':"",n+="</div>"),t.funcs.length>0&&(r="<div><span>funcs: </span>",r+=t.funcs.reduce((e,t)=>e+`<button class="func btn-3">${t}</button>`,"")||"",r+=t.funcs.length>1?'<button class="all-funcs btn-1">all</button>':"",r+="</div>");let o=$(`<div class='not-exist'>${n+r}</div>`),h=this;$(".var",o).bind("click",(function(){O(`${this.innerText} = 1`,parseInt(h.orderELT.textContent))})),$(".func",o).bind("click",(function(){let e,t="a",s=0;for(;Math.hasOwnProperty(t)&&!e;)s>300?(t="a",e=1):t=s>100?String.fromCharCode(math.random(65,90)):String.fromCharCode(math.random(97,122)),s++;O(`${this.textContent}\\left(${t}\\right) = ${t}`,parseInt(h.orderELT.textContent))})),$(".all-vars",o).bind("click",()=>{let e=this.elt.querySelectorAll(".not-exist .var");for(let t of e)t.click()}),$(".all-funcs",o).bind("click",()=>{let e=this.elt.querySelectorAll(".not-exist .func");for(let t of e)t.click()}),this.elt.querySelector(".main").append(o[0]),this.isError=1}else{if(this.isError){this.elt.querySelector(".error-elt").setAttribute("aria-label",e.message)}else{this.elt.classList.add("error"),this.isError=!0,this.graphChild.renderable=!1;let t=$('\n            <div class="error-elt">\n               <i class="fas fa-bug"></i>\n            </div>\n            ');t[0].setAttribute("data-balloon-pos","right"),t[0].setAttribute("aria-label",e.message),t.hide(),this.elt.querySelector(".side-status").append(t[0]),t.fadeOut(0).delay(200).fadeIn(500)}console.log(e)}}remove(e=!0){this._graphChild instanceof f&&$(".slider-outer",this.elt).hasClass("play")&&$(".play-pause",this.elt).trigger("click"),function(e){if(e===A.focusedControl){let t=e.elt.previousElementSibling||e.elt.nextElementSibling;t&&mySketch.children.get(t.getAttribute("id")).control.focus()}e.elt.remove();var t=document.querySelector(".controls"),s=t.parentElement.querySelector("#add-new-control");0===t.childElementCount&&(s.classList.add("animate-shake"),t.parentElement.classList.add("blink-error"),setTimeout(()=>{s.classList.remove("animate-shake"),t.parentElement.classList.remove("blink-error"),O(new x)},400))}(this),e&&(this.graphChild&&this.graphChild.remove(),this.__updateDependants()),mySketch.update()}__updateElts(e,t){if(e&&t&&e.constructor!==t.constructor){this.elt.querySelectorAll(".special-elt").forEach(e=>{e.remove()})}1===this.isError&&this.elt.querySelector(".not-exist").remove(),this.isError&&(this.elt.classList.remove("error"),this.elt.querySelector(".error-elt").remove(),this.isError=!1),t&&(t instanceof y?this.__toEmpty():t instanceof g?e instanceof g?this.__updateXfunction():this.__toXfunction():t instanceof m?e instanceof m?this.__updateEvalExpr():this.__toEvalExpr():t instanceof p?e instanceof p?this.__updateVariable():this.__toVariable():t instanceof f&&(e instanceof f?this.__updateSlider():this.__toSlider()))}__toEmpty(){this.elt.querySelector(".side-status")}__toXfunction(){let e=this.elt.querySelector(".side-status"),t=$('<div class="visible-elt special-elt visible"><div class="inner"></div></div>');t.bind("click",()=>{t.toggleClass("visible"),this.graphChild.renderable=t.hasClass("visible"),this.graphChild.update(),mySketch.draw()}),e.append(t[0]),this.__updateXfunction()}__updateXfunction(){this.elt.querySelector(".side-status").querySelector(".visible").setAttribute("style",`--color: ${this.graphChild.pen.color.toString()}`)}__toEvalExpr(){let e=$('<div class="value special-elt"><span></span></div>');e.hide(),this.elt.querySelector(".main").append(e[0]),e.fadeIn();let t=$('<div class="value-type special-elt" type=decimal>\n            <span><i class="fas fa-divide"></i></span>\n         </div>');this.elt.querySelector(".side-status").append(t[0]),t.click(()=>{switch(t.attr("type")){case"decimal":t.attr("type","fract"),e.height(56);break;case"fract":t.attr("type","quotient"),e.height(56);break;case"quotient":t.attr("type","decimal"),e.height(33)}this.__updateEvalExpr()}),this.specialProps={valueType:t[0],valueElt:e[0]}}__updateEvalExpr(){try{let e=this.graphChild.eval();if(isNaN(e))this.specialProps.valueElt.innerHTML="<span>NaN</span>";else switch(e+=0,e=parseFloat(e.toFixed(10)),this.specialProps.valueType.getAttribute("type")){case"decimal":this.specialProps.valueElt.innerHTML=`<span>${e}</span>`;break;case"fract":if(e.indexOf(".")>-1&&e.split(".")[1].length<5){let t=MathPackage.Core.fraction(e);1===t.denominator?this.specialProps.valueElt.innerHTML=`<span>${t.numerator}</span>`:(this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}else this.specialProps.valueElt.innerHTML=`<span>${e}</span>`;break;case"quotient":if(e.indexOf(".")>-1&&e.split(".")[1].length<5){let t=MathPackage.Core.quotientRemainder(e);0===t.numerator?this.specialProps.valueElt.innerHTML=`<span>${t.quotient}</span>`:(0==t.quotient?this.specialProps.valueElt.innerHTML=`<span>\\frac{${t.numerator}}{${t.denominator}}</span>`:this.specialProps.valueElt.innerHTML=`<span>${t.quotient}\\frac{${t.numerator}}{${t.denominator}}</span>`,MQ.StaticMath(this.specialProps.valueElt.children[0]))}else this.specialProps.valueElt.innerHTML=`<span>${e}</span>`}}catch(e){this.specialProps.valueElt.innerHTML="<span>NaN</span>",this.error(e)}}__toSlider(){let e=$('\n      <div class="slider-outer special-elt">\n         <div class=\'range-container\'>\n            <span class=\'slider-controller-toggle\'>\n               <i class="fas fa-angle-right right"></i>\n            </span>\n            <input type=range class=slider min=-5 max=5 step=0.01 />\n            <span class=\'play-pause\'>\n               <svg role="img" width=15 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                  <path class="path"></path>\n               </sbg>\n            </span>\n         </div>\n         <div class=\'slider-controller\'>\n            <label>min</label>:<span class="math-field min">-5</span>\n            <label>max</label>:<span class="math-field max">5</span>\n            <label>step</label>:<span class="math-field step">0.01</span>\n         </div>\n      </div>');this.elt.querySelector(".main").append(e[0]);let t=$(".slider",e),s={min:MQ.MathField(e[0].querySelector(".slider-controller .math-field.min"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].min=n(s.min.latex())()}}}),max:MQ.MathField(e[0].querySelector(".slider-controller .math-field.max"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].max=n(s.max.latex())()}}}),step:MQ.MathField(e[0].querySelector(".slider-controller .math-field.step"),{handlers:{edit:function(){e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].step=n(s.step.latex())()}}}),dir:"oscillate",speed:400,speedModifier:1};this.specialProps={$slider:t,attrs:s,invokeOnchange:!0},t.on("change",(e,...s)=>{this.specialProps.invokeOnchange&&(this.graphChild.setValue(parseFloat(t[0].value),s),this.setScript(this.graphChild.id+" = "+t[0].value,!1))}).on("mousemove touchmove",()=>{t[0].ismousedown&&t.trigger("change",!1)}).on("mousedown touchstart",()=>{e.hasClass("play")&&$(".play-pause",e).trigger("click"),t[0].ismousedown=!0}).on("mouseup touchend",()=>{t[0].ismousedown=!1}),$(".slider-controller-toggle",e).bind("click",()=>{e.toggleClass("controller-opended")}),$(".play-pause",e).bind("click",()=>{e.toggleClass("play"),e.hasClass("play")?T.push(this):T.pop(this)}),this.__updateSlider()}__updateSlider(){let e=this.specialProps.$slider[0],t=this.graphChild.getValue();this.specialProps.attrs.min.latex(Math.min(parseFloat(e.min),parseFloat(t))),this.specialProps.attrs.max.latex(Math.max(parseFloat(e.max),parseFloat(t))),this.specialProps.invokeOnchange=!1,e.value=t,this.specialProps.invokeOnchange=!0}__toVariable(){this.specialProps={}}__updateVariable(){}}class v{constructor(e){this.gs=e,this.coorManager=e.coorManager,this.handlers={},this.angleMargin=angles.deg(20),this.zoomLimits=[80,180],this.zoomLimits[1]=2*this.zoomLimits[1]/5<this.zoomLimits[0]?5*this.zoomLimits[0]/2+1:this.zoomLimits[0],this.zoomRatio=1.1,this.invokeOnchange=!0,this.reset()}get iVector(){return vector.fromAngle(-this.xAngle).mult(this.xScale)}get jVector(){return vector.fromAngle(-this.yAngle).mult(this.yScale)}getTransform(){let e=this.iVector,t=this.jVector,s=this.center;return{a:e.x,b:e.y,c:t.x,d:t.y,e:s.x,f:s.y}}get transformOrigin(){return this._transformOrigin}set transformOrigin(e){if(e&&e instanceof vector){this._transformOrigin={pxVector:e};let t=this.coorManager.pxTOcoor(e.x,e.y);this._transformOrigin.coorVector=new vector(t.x,t.y)}else this._transformOrigin=void 0}get xAngle(){return this._xAngle}set xAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._yAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._yAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._yAngle+Math.PI-this.angleMargin)))))}this._xAngle=t}get yAngle(){return this._yAngle}set yAngle(e){let t=angles.constrainAngle(e);if(angles.minAngle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{type:"lines"})<this.angleMargin){let e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle),{dir:"clockwise"});e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle)),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle-this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1),{dir:"clockwise"}),e<this.angleMargin&&e>0?t=angles.constrainAngle(this._xAngle+Math.PI+this.angleMargin):(e=angles.angle(vector.fromAngle(t),vector.fromAngle(this._xAngle).mult(-1)),e<this.angleMargin&&e>0&&(t=angles.constrainAngle(this._xAngle+Math.PI-this.angleMargin)))))}this._yAngle=t}rotate(e,t="rad"){if(!isNaN(e)){"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.xAngle+=e,this.yAngle+=e,this.invokeOnchange=s,this.onchange()}}rotateX(e,t="rad"){if(!isNaN(e)){"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.xAngle+=e,this.invokeOnchange=s,this.onchange()}}rotateY(e,t="rad"){if(!isNaN(e)){this.invokeOnchange=!1,"deg"===t&&(e=e/180*Math.PI);let s=this.invokeOnchange;this.invokeOnchange=!1,this.yAngle+=e,this.invokeOnchange=s,this.onchange()}}get center(){return this._center}set center(e){this._center=e,this.onchange(this.invokeOnchange,!1)}translate(e){this.center=new vector(this._center.x+e.x,this._center.y+e.y)}zoomIn(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e;let t=this.invokeOnchange;this.invokeOnchange=!1,this.xZoomIn(),this.yZoomIn(),this.invokeOnchange=t,this.onchange()}zoomOut(e){e=e||new vector(this.gs.width/2,this.gs.height/2),this.transformOrigin=e;let t=this.invokeOnchange;this.invokeOnchange=!1,this.xZoomOut(),this.yZoomOut(),this.invokeOnchange=t,this.onchange()}xZoomIn(){this.xSpace<=this.zoomLimits[1]&&(this.xSpace*=this.zoomRatio),this.reformXspace(),this.onchange()}xZoomOut(){this.xSpace>=this.zoomLimits[0]&&(this.xSpace/=this.zoomRatio),this.reformXspace(),this.onchange()}yZoomIn(){this.ySpace<=this.zoomLimits[1]&&(this.ySpace*=this.zoomRatio),this.reformYspace(),this.onchange()}yZoomOut(){this.ySpace>=this.zoomLimits[0]&&(this.ySpace/=this.zoomRatio),this.reformYspace(),this.onchange()}setViewport(e,t){e.xmin=0===e.xmin?0:e.xmin||this.gs.viewport.xmin,e.xmax=0===e.xmax?0:e.xmax||this.gs.viewport.xmax,e.ymin=0===e.ymin?0:e.ymin||this.gs.viewport.ymin,e.ymax=0===e.ymax?0:e.ymax||this.gs.viewport.ymax;let s=this.invokeOnchange;this.invokeOnchange=!1;let i=this.coorManager.pxTOcoor(this.gs.width/2,this.gs.height/2),a=this.xSpace,n=this.ySpace;this.xSpace=this.xSpace/((e.xmax-e.xmin)/(this.gs.viewport.xmax-this.gs.viewport.xmin)),t?this.ySpace*=this.xSpace/a:this.ySpace=this.ySpace/((e.ymax-e.ymin)/(this.gs.viewport.ymax-this.gs.viewport.ymin)),(this.ySpace<=0||this.xSpace<=0||isNaN(this.xSpace)||!isFinite(this.xSpace)||isNaN(this.ySpace)||!isFinite(this.ySpace))&&(this.xSpace=a,this.ySpace=n),this.reformXspace(),this.reformYspace(),this.onchange(!0);let r=this.coorManager.coorTOpx(e.xmin,e.ymax);if(r=new vector(r.x,r.y),this.translate(r.mult(-1)),this.onchange(!0),t){let t=this.coorManager.coorTOpx(i.x,(e.ymax+e.ymin)/2);this.translate(new vector(0,this.gs.height/2-t.y))}this.onchange(),this.invokeOnchange=s}getViewport(e){e.xmin=e.xmin||0,e.xmax=e.xmax||this.gs.width,e.ymin=e.ymin||0,e.ymax=e.ymax||this.gs.height;let t=this.coorManager.xTOcoor(e.xmin,Math.tan(this.yAngle)>0?e.ymin:e.ymax),s=this.coorManager.xTOcoor(e.xmax,Math.tan(this.yAngle)<=0?e.ymin:e.ymax),i=this.coorManager.yTOcoor(Math.tan(this.xAngle)>0?e.xmax:e.xmin,e.ymax),a=this.coorManager.yTOcoor(Math.tan(this.xAngle)<=0?e.xmax:e.xmin,e.ymin);return{xmin:s<t?s:t,xmax:s>t?s:t,ymin:a<i?a:i,ymax:a>i?a:i}}reformXspace(){let e=!1;for(;this.xSpace>this.zoomLimits[1];){if(5==this.xZoomingState){this.xZoomingState=2;let e=.4;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=1;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(1==this.xZoomingState){this.xZoomingState=5;let e=.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}e=!0}if(!e)for(;this.xSpace<this.zoomLimits[0];)if(1==this.xZoomingState){this.xZoomingState=2;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(2==this.xZoomingState){this.xZoomingState=5;let e=2.5;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}else if(5==this.xZoomingState){this.xZoomingState=1;let e=2;this.xSpaceValue=this.xSpaceValue*e,this.xSpace=this.xSpace*e}}reformYspace(){let e=!1;for(;this.ySpace>this.zoomLimits[1];){if(5==this.yZoomingState){this.yZoomingState=2;let e=.4;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=1;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(1==this.yZoomingState){this.yZoomingState=5;let e=.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}e=!0}if(!e)for(;this.ySpace<this.zoomLimits[0];)if(1==this.yZoomingState){this.yZoomingState=2;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(2==this.yZoomingState){this.yZoomingState=5;let e=2.5;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}else if(5==this.yZoomingState){this.yZoomingState=1;let e=2;this.ySpaceValue=this.ySpaceValue*e,this.ySpace=this.ySpace*e}}reset(){this.transformOrigin=void 0,this.xSpace=120,this.xSpaceValue=2,this.xSpaceModifier=1,this.xZoomingState=2,this.ySpace=120,this.ySpaceValue=2,this.ySpaceModifier=1,this.yZoomingState=2,this._xAngle=0,this._yAngle=Math.PI/2,this._center=new vector(this.gs.width/2,this.gs.height/2),this.onchange()}assign(e,t){e.xSpace=t.xSpace,e.xSpaceValue=t.xSpaceValue,e.xSpaceModifier=t.xSpaceModifier,e.xZoomingState=t.xZoomingState,e.ySpace=t.ySpace,e.ySpaceValue=t.ySpaceValue,e.ySpaceModifier=t.ySpaceModifier,e.yZoomingState=t.yZoomingState,e._xAngle=t._xAngle,e._yAngle=t._yAngle,e._center=t._center}onchange(e=this.invokeOnchange,t=!0){if(e){let e=this.xSpaceModifier+Math.abs(Math.cos(this.xAngle-this.yAngle)),s=this.ySpaceModifier+Math.abs(Math.cos(this.xAngle-this.yAngle));this.xScale=this.xSpace*e/this.xSpaceValue,this.yScale=this.ySpace*s/this.ySpaceValue;let i=!math.isNumeric(this.xScale)||!math.isNumeric(this.yScale)||!math.isNumeric(this.center.x)||!math.isNumeric(this.center.y)||this.transformOrigin&&t&&(!math.isNumeric(this.transformOrigin.coorVector.x)||!math.isNumeric(this.transformOrigin.coorVector.y)||!math.isNumeric(this.transformOrigin.pxVector.x)||!math.isNumeric(this.transformOrigin.pxVector.y));if(i){let e=this.invokeOnchange;this.invokeOnchange=!1;try{this.assign(this,this.lastVersion.transform)}catch(e){this.reset()}return this.invokeOnchange=e,void this.onchange(!0)}this.coorManager.transform=this.getTransform();let a=this.getViewport({xmin:0,xmax:this.gs.width,ymin:0,ymax:this.gs.height});if(a.width=a.xmax-a.xmin,a.height=a.ymax-a.ymin,this.gs.viewport=a,this.gs.drawingStep=(this.gs.viewport.xmax-this.gs.viewport.xmin)/1e4,i=!math.isNumeric(this.gs.viewport.xmin)||!math.isNumeric(this.gs.viewport.xmax)||!math.isNumeric(this.gs.viewport.ymin)||!math.isNumeric(this.gs.viewport.ymax)||!math.isNumeric(this.gs.drawingStep)||this.gs.viewport.xmax-this.gs.viewport.xmin>1e12||this.gs.viewport.ymax-this.gs.viewport.ymin>1e12||this.gs.viewport.xmax-this.gs.viewport.xmin<1e-12||this.gs.viewport.ymax-this.gs.viewport.ymin<1e-12||this.gs.viewport.xmin+this.gs.drawingStep/2<=this.gs.viewport.xmin||this.gs.viewport.xmax-this.gs.drawingStep/2>=this.gs.viewport.xmax,i&&this.lastVersion){let e=this.invokeOnchange;this.invokeOnchange=!1;try{this.assign(this,this.lastVersion.transform)}catch(e){this.reset()}return this.invokeOnchange=e,void this.onchange(!0)}{if(this.transformOrigin&&t){let e=this.invokeOnchange;this.invokeOnchange=!1;let t=this.coorManager.coorTOpx(...this.transformOrigin.coorVector.toArray());return this.translate(this.transformOrigin.pxVector.subtract(t)),this.onchange(!0,!1),void(this.invokeOnchange=e)}this.handlers.onchange&&this.handlers.onchange();let e={};this.assign(e,this),this.lastVersion={transform:e}}}}}class S{constructor(e){this.transform=e||{a:1,b:0,c:0,d:1,e:0,f:0}}get transform(){return this.trans}set transform(e){this.e=e.e,this.f=e.f,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d;let t=(e=>{let t={},s=e.a*e.d-e.c*e.b;return t.a=e.d/s,t.d=e.a/s,t.c=-e.c/s,t.b=-e.b/s,t})(e);this.ia=t.a,this.ib=t.b,this.ic=t.c,this.id=t.d}coorTOpx(e,t){return{x:this.xToPixel(e,t),y:this.yToPixel(e,t)}}pxTOcoor(e,t){return{x:this.xTOcoor(e,t),y:this.yTOcoor(e,t)}}xToPixel(e,t){return this.a*e+this.c*t+this.e}yToPixel(e,t){return this.b*e+this.d*t+this.f}xTOcoor(e,t){return e-=this.e,t-=this.f,this.ia*e+this.ic*t}yTOcoor(e,t){return e-=this.e,t-=this.f,this.ib*e+this.id*t}}class w{constructor(e,t,s){this.sketch=e,this._width=t,this._height=s,this.coorManager=new S,this.transform=new v(this),this.center=new vector(this.width/2,this.height/2),this.physicsRun=!1}get coor(){return this.sketch.coor}get width(){return this._width||0}set width(e){this._width=e,this.transform.onchange()}get height(){return this._height||0}set height(e){this._height=e,this.transform.onchange()}get center(){return this.transform.center}set center(e){this.transform.center=e}get iVector(){return this.transform.iVector}get jVector(){return this.transform.jVector}centrate(){this.transform.center=new vector(this.width/2,this.height/2)}reset(){this.transform.reset()}checkId(t){if(!t)throw new Error("can't set a falsy value to the name of this sketch child.");let s=t.replace(/^\s*([_a-zA-z]+\d*)\s*$/,"$1");if(!s)throw new Error(`"${t}" is not valid to use.`);if(this.sketch.children.has(t))throw new e(t);if(Math.hasOwnProperty(t))throw new e(t);return s}}class k{constructor(e,t){this.gs=e,this.coorManager=this.gs.coorManager;let s={type:"default",xUnit:"",yUnit:"",background:new drawing.color(255,255,255,255),font:"Georgia",drawDecimalLines:!0,drawMainLines:!0,drawAxisesLines:!0,drawPolarCircles:!1,drawPolarLines:!1,drawPolarAngles:!1,drawNumbers:!0,decimalLinesSpace:5,polarCirclesSpace:5,polarLinesAnglesSpace:6,penDecimalLines:null,penMainLines:null,penXaxis:null,penYaxis:null,penPolarCircles:null,penPolarLines:null,autoRefiningOnZoomimg:!0};Object.assign(s,{color:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),antiBackground:s.background.isDark()?new drawing.color(200,200,200,255):new drawing.color(50,50,50,1),drawDecimalLines:!s.background.isDark(),penDecimalLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,30/255):new drawing.color(50,50,50,30/255),1),penMainLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,100/255),1),penXaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penYaxis:new drawing.pen(s.background.isDark()?new drawing.color(255,255,255,150/255):new drawing.color(0,0,0,150/255),2),penPolarCircles:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1),penPolarLines:new drawing.pen(s.background.isDark()?new drawing.color(200,200,200,100/255):new drawing.color(50,50,50,50/255),1)}),Object.assign(s,{fillColor:s.color.toString(),fillColorDim:s.color.toString({a:.5})}),t?(this.coorSettings={},Object.assign(this.coorSettings,s),Object.assign(this.coorSettings,t)):this.coorSettings=s}draw(e){switch(this.coorSettings.type){case"default":this.custom(e);break;case"rad":this.radian(e)}}custom(e,t=1){let s,i,a,n;if(s=Math.floor(this.gs.viewport.xmin/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,a=Math.ceil(this.gs.viewport.xmax/this.gs.transform.xSpaceValue/t)*t*this.gs.transform.xSpaceValue,i=Math.floor(this.gs.viewport.ymin/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,n=Math.ceil(this.gs.viewport.ymax/this.gs.transform.ySpaceValue)*this.gs.transform.ySpaceValue,this.coorSettings.drawDecimalLines){e.ctx.beginPath(),this.coorSettings.penDecimalLines.setup(e);for(let r=s;r<=a;r+=this.gs.transform.xSpaceValue*t/this.coorSettings.decimalLinesSpace)e.line(this.coorManager.xToPixel(r,i),this.coorManager.yToPixel(r,i),this.coorManager.xToPixel(r,n),this.coorManager.yToPixel(r,n));for(let t=i;t<=n;t+=this.gs.transform.ySpaceValue/this.coorSettings.decimalLinesSpace)e.line(this.coorManager.xToPixel(s,t),this.coorManager.yToPixel(s,t),this.coorManager.xToPixel(a,t),this.coorManager.yToPixel(a,t));e.ctx.stroke()}if(this.coorSettings.drawMainLines){e.ctx.beginPath(),this.coorSettings.penMainLines.setup(e);for(let r=s;r<=a;r+=this.gs.transform.xSpaceValue*t)e.line(this.coorManager.xToPixel(r,i),this.coorManager.yToPixel(r,i),this.coorManager.xToPixel(r,n),this.coorManager.yToPixel(r,n));for(let t=i;t<=n;t+=this.gs.transform.ySpaceValue)e.line(this.coorManager.xToPixel(s,t),this.coorManager.yToPixel(s,t),this.coorManager.xToPixel(a,t),this.coorManager.yToPixel(a,t));e.ctx.stroke()}if(this.coorSettings.drawAxisesLines&&(e.ctx.beginPath(),this.coorSettings.penXaxis.setup(e),e.line(this.coorManager.xToPixel(s,0),this.coorManager.yToPixel(s,0),this.coorManager.xToPixel(a,0),this.coorManager.yToPixel(a,0)),e.ctx.stroke(),e.ctx.beginPath(),this.coorSettings.penYaxis.setup(e),e.line(this.coorManager.xToPixel(0,i),this.coorManager.yToPixel(0,i),this.coorManager.xToPixel(0,n),this.coorManager.yToPixel(0,n)),e.ctx.stroke()),this.coorSettings.drawNumbers){let r,o,h,c,l;s=Math.floor(s/this.gs.transform.xSpaceValue/t),a=Math.ceil(a/this.gs.transform.xSpaceValue/t),i=Math.floor(i/this.gs.transform.ySpaceValue),n=Math.ceil(n/this.gs.transform.ySpaceValue),e.ctx.fillStyle=this.coorSettings.fillColor,e.ctx.strokeStyle=this.coorSettings.background.toString(),e.ctx.lineWidth=3,e.setFont({size:15}),Math.abs(Math.tan(this.gs.transform.yAngle))>Math.abs(Math.tan(this.gs.transform.xAngle))?(c="v",l="h"):(c="h",l="v");for(let i=s;i<=a;i+=1)if(o=i*this.gs.transform.xSpaceValue,h=Math.abs(o)<.001||Math.abs(o)>=999999?o.toExponential(3).replace(/\.?0+e\+?/,"×10^"):o.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=o){h+=(t===Math.PI/2?"pi":"")+this.coorSettings.xUnit;let s=this.__getLabelPos(e,this.coorManager.coorTOpx(o,0),h,c,this.gs.transform.jVector);e.ctx.strokeText(h,s.x,s.y),e.ctx.fillText(h,s.x,s.y)}for(let t=i;t<=n;t+=1)if(r=t*this.gs.transform.ySpaceValue,h=Math.abs(r)<.001||Math.abs(r)>=999999?r.toExponential(3).replace(/\.?0+e\+?/,"×10^"):r.toFixed(3).replace(/0+$/,"").replace(/\.$/,""),0!=r){h+=this.coorSettings.yUnit;let t=this.__getLabelPos(e,this.coorManager.coorTOpx(0,r),h,l,this.gs.transform.iVector);e.ctx.strokeText(h,t.x,t.y),e.ctx.fillText(h,t.x,t.y)}}}radian(e){this.custom(e,Math.PI/2)}__getLabelPos(e,t,s,i,a){let n=e.measureString(s);if(n.height=10,t=new vector(t.x+4,t.y+4),"h"===i){let e=[10,this.gs.width-n.width-10];if(t.x<e[0]){let s=(e[0]-t.x)/a.x;return t.add(a.mult(s))}if(t.x>e[1]){let s=(e[1]-t.x)/a.x;return t.add(a.mult(s))}return t}{let e=[10,this.gs.height-n.height-10];if(t.y<e[0]){let s=(e[0]-t.y)/a.y;return t.add(a.mult(s))}if(t.y>e[1]){let s=(e[1]-t.y)/a.y;return t.add(a.mult(s))}return t}}}class b{constructor(e){this.canvas=new o({parent:e,attributes:{id:"canvas"}}),this.childrenCanvas=new o({parent:e,attributes:{id:"children-canvas"}}),this.gs=new w(this,this.canvas.width,this.canvas.height),this.coor=new k(this.gs),this.children=new Map,this.scriptParser=new MagicalParser.CustomParsers.Math,this.childrenCanvas.ctx.miterLimit=1}childFromScript(e,t={}){let s=this.getChildParser.parse(e.replace(/\^/g,"**"));return childFromParsed(s,t)}childFromParsed(e,t={}){if(t.sketch=this,""===e.type)return new y(t);if("="===e.name){let s=e.args[0],i=e.args[1];if(s.check({type:"variable",name:"y"})&&!i.contains({type:"variable",name:"y"}))return new g(Object.assign(t,{expr:i}));if(s.check({type:"functionCalling"})){if(1==s.args.length&&s.args[0].check({type:"variable",name:"x"})&&!i.contains({type:"variable",name:"y"}))return new g({sketch:this,expr:i,id:s.name});{let e,a=[];if(s.args[0].check({type:"separator",name:","}))for(let t of s.args[0].args)"variable"===t.type?a.push(t.name):e=!0;else"variable"!==s.args[0].type&&(e=!0),e||a.push(s.args[0].name);if(!e)return new u(Object.assign(t,{id:s.name,params:a,expr:i}))}}else{if("variable"===s.type&&"number"===i.type)return new f(Object.assign(t,{id:s.name,value:i.value}));if("variable"===s.type&&i.check({type:"prefixOperator",name:"-"})&&"number"===i.args[0].type)return new f(Object.assign(t,{id:s.name,value:-i.args[0].value}));if("variable"===s.type)return new p(Object.assign(t,{id:s.name,value:i}))}}else{if(e.contains({type:"variable",name:"x"}))return new g(Object.assign(t,{expr:e}));if(e.check({type:"block",name:"()"})&&1==e.args.length&&e.args[0].check({type:"separator",name:",",length:2})&&!vars.contains("t"))return new d(Object.assign({x:e.args[0].args[0],y:e.args[0].args[1]},t))}return new m(Object.assign(t,{expr:e,drawable:!1}))}getChildById(e){return this.children.get(e)}update(e=!0,t=!0){if("updating"===this.status||"re-updating"===this.status)this.status="re-update";else{this.status="updating";for(let e of this.children.values())e&&e.update();e&&this.draw(t),"re-update"===this.status?(this.status="ready",this.update(e,t)):this.status="ready"}}draw(e=!0){e&&(this.canvas.clear(),this.coor.draw(this.canvas)),this.childrenCanvas.clear();for(let e of this.children.values())e&&e.draw(this.childrenCanvas)}}var M={details:SUI.TempMessege({layer:!1,toolsbar:!0,onhoverFix:!0,position:{bottom:20,left:20},duration:2500,content:'<p style="background: green; color:white;">There is no god but Allah',parent:document.querySelector("#canvas-parent").parentElement})},C={x:void 0,y:void 0},A={backspaceInterval:void 0,mouseDownForInterval:!1,showHideKeyBtn:document.querySelector(".sh-keypad"),mathField:document.querySelector(".script")},_=document.querySelector(".sidebar-container");function P(){let e=document.querySelectorAll(".controls li"),t=1;for(let s of e)s.setAttribute("index",t-1),s.querySelector(".order").textContent=t++}function O(e,t="last",s=!0){let i=e;"string"===(typeof e).toLowerCase()&&(i=new x,i.mathField.latex(e));var a=document.querySelector(".controls");let n="last"===(t=math.isNumeric(t)&&t>a.childElementCount-1?"last":t)?a.childElementCount-1:t;n>-1&&"last"!==t?(i.elt.querySelector(".order").textContent=n+1,a.insertBefore(i.elt,a.children[n]),P()):(i.elt.setAttribute("index",a.childElementCount),i.elt.querySelector(".order").textContent=a.childElementCount+1,a.appendChild(i.elt)),s&&i.focus()}function E(e=!0){V(),mySketch.canvas.resize(canvasParent.clientWidth,canvasParent.clientHeight),mySketch.childrenCanvas.resize(canvasParent.clientWidth,canvasParent.clientHeight),mySketch.gs.transform.invokeOnchange=!1,mySketch.gs.width=canvasParent.clientWidth,mySketch.gs.height=canvasParent.clientHeight;let t=mySketch.gs.viewport;mySketch.gs.transform.onchange(!0),mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(t,!0),mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),e&&$(".resizer",_).draggable("option","containment",L(_)),mySketch.update(),E.prevSize={width:window.innerWidth,height:window.innerHeight}}function V(){window.innerWidth<=600&&E.prevSize.width>600?(document.body.querySelector(".app-container").classList.remove("large-screen"),document.body.querySelector(".app-container").classList.add("small-screen")):window.innerWidth>600&&E.prevSize.width<=600&&(document.body.querySelector(".app-container").classList.add("large-screen"),document.body.querySelector(".app-container").classList.remove("small-screen"))}function L(e){let t=window.getComputedStyle(e),s=parseInt(t.minWidth.replace("px","")),i=parseInt(t.maxWidth.replace("px",""));return s>i?[s,0,s,parseInt(t.height.replace("px",""))]:[s,0,i,parseInt(t.height.replace("px",""))]}V.prevSize={width:window.innerWidth,height:window.innerHeight};var T={workingSliders:[],interval:0,status:"all-stoped",push:function(e){let t=e.specialProps.$slider,s=t[0],i=e.specialProps.attrs,a={min:parseFloat(s.min),max:parseFloat(s.max),step:parseFloat(s.step),value:e.graphChild.getValue()},n={current:(a.value-a.min)/a.step,prev:(a.value-a.min)/a.step,max:(a.max-a.min)/a.step};this.workingSliders.push({sliderControl:e,stepConfig:n,sliderConfig:a,attrs:i,$slider:t}),"all-stoped"===this.status&&(this.status="working",this.startSlidersInterval())},pop:function(e){for(let t=0;t<this.workingSliders.length;t++)e===this.workingSliders[t].sliderControl&&this.workingSliders.splice(t,1);0===this.workingSliders.length&&(this.status="all-stoped",clearInterval(this.interval))},startSlidersInterval:function(){this.interval=setInterval(()=>{for(let e of this.workingSliders){let t=e.stepConfig,s=e.sliderConfig,i=e.$slider;if(t.current+=e.attrs.speed*e.attrs.speedModifier/1e3*15,Math.abs(t.current-t.prev)>1){switch(e.attrs.dir){case"oscillate":{let a=s.min+t.current*s.step;t.current<0||t.current>t.max?e.attrs.speedModifier*=-1:(i[0].value=a,i.trigger("change",!0,!1));break}case"forwards":{let e=s.min+t.current*s.step;t.current>t.max?t.current=0:(i[0].value=e,i.trigger("change",!0,!1));break}case"backwards":{let e=s.min+t.current*s.step;t.current<0?t.current=t.max:(i[0].value=e,i.trigger("change",!0,!1));break}}t.prev=t.current}}mySketch.update(!0,!1)},15)}};function q(){let e,t,s=MathPackage.Lines,i=i=>{e=!0;let a=n(canvas.elt);if("mousedown"===i.type)C.x=i.clientX-a.left,C.y=i.clientY-a.top;else{let e=i.touches[0];C.x=e.clientX-a.left,C.y=e.clientY-a.top}if(Object.assign(M,{type:M.type,mouse:new vector(C.x,C.y),iVector:mySketch.gs.transform.iVector,jVector:mySketch.gs.transform.jVector}),"move"===M.type)C.prev={x:C.x,y:C.y},C.vel={x:0,y:0},clearInterval(t);else if(M.type.search("axises")>-1){let e=s.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),t=s.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=30,a={x:s.distToLine(M.mouse,e),y:s.distToLine(M.mouse,t)};if(a.x<i&&a.y<i)M.axis="xy",M.xSpace=mySketch.gs.transform.xSapce,M.ySpace=mySketch.gs.transform.ySapce,M.xAngle=mySketch.gs.transform.xAngle,M.yAngle=mySketch.gs.transform.yAngle,M.transformOrigin=new vector(mySketch.gs.center.x,mySketch.gs.center.y),M.xPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penXaxis.color),M.yPenColor=Object.assign(new drawing.color,mySketch.coor.coorSettings.penYaxis.color),mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155),mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155);else if(a.x<i){M.axis="x",M.space=mySketch.gs.transform.xSapce,M.angle=mySketch.gs.transform.xAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.x!==mySketch.gs.center.x&&(e=M.mouse),M.transformOrigin=e,M.penColor=[mySketch.coor.coorSettings.penXaxis.color].slice()[0],mySketch.coor.coorSettings.penXaxis.color=new drawing.color(255,0,0,155)}else if(a.y<i){M.axis="y",M.space=mySketch.gs.transform.ySapce,M.angle=mySketch.gs.transform.yAngle;let e=new vector(math.constrain(mySketch.gs.center.x,0,mySketch.gs.width),math.constrain(mySketch.gs.center.y,0,mySketch.gs.height));e.y!==mySketch.gs.center.y&&(e=M.mouse),M.transformOrigin=e,M.penColor=[mySketch.coor.coorSettings.penYaxis.color].slice()[0],mySketch.coor.coorSettings.penYaxis.color=new drawing.color(255,0,0,155)}else M.axis=void 0;M.increment=0,mySketch.draw()}else if("zoom"===M.type){let e=document.createElement("div");e.classList.add("zoom-box"),canvasParent.append(e),M.boxElt=e,M.pxViewport={}}i.preventDefault()};canvasParent.addEventListener("mousedown",i),canvasParent.addEventListener("touchstart",i);let a=t=>{if(e){let e=n(canvas.elt);if("mousemove"===t.type)C.x=t.clientX-e.left,C.y=t.clientY-e.top;else{let s=t.touches[0];C.x=s.clientX-e.left,C.y=s.clientY-e.top}switch(M.type){case"move":mySketch.gs.transform.translate(new vector(C.x,C.y).subtract(M.mouse)),mySketch.update(),M.mouse=new vector(C.x,C.y);break;case"scale-axises":!function(e){if("x"==M.axis){let e=M.mouse,t=s.lineEquation(-mySketch.gs.transform.xAngle,mySketch.gs.center),i=(math.dist(C.x,C.y,e.x,e.y)**2-s.distToLine(new vector(C.x,C.y),t)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.xAngle),new vector(C.x,C.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin,mySketch.gs.transform.xSpace+=i*s-M.increment,mySketch.gs.transform.reformXspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.iVector.mag/M.iVector.mag).toFixed(2)}`])}else if("y"==M.axis){let e=M.mouse,t=s.lineEquation(-mySketch.gs.transform.yAngle,mySketch.gs.center),i=(math.dist(C.x,C.y,e.x,e.y)**2-s.distToLine(new vector(C.x,C.y),t)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let t=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(C.x,C.y).subtract(e)),s=t<Math.PI/2?1:t>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin,mySketch.gs.transform.ySpace+=i*s-M.increment,mySketch.gs.transform.reformYspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.jVector.mag/M.jVector.mag).toFixed(2)}`])}else if("xy"==M.axis){let e=s.lineEquation(-(mySketch.gs.transform.yAngle+mySketch.gs.transform.xAngle)/2,mySketch.gs.center),t=s.projectionToLine(M.mouse,e),i=(math.dist(C.x,C.y,t.x,t.y)**2-s.distToLine(new vector(C.x,C.y),e)**2)**.5;if(mySketch.gs.transform.transformOrigin=void 0,!isNaN(i)){let e=angles.minAngle(vector.fromAngle(-mySketch.gs.transform.yAngle),new vector(C.x,C.y).subtract(t)),s=e<Math.PI/2?1:e>Math.PI/2?-1:0;mySketch.gs.transform.transformOrigin=M.transformOrigin;let a=(mySketch.gs.transform.ySpace+(i*s-M.increment))/mySketch.gs.transform.ySpace;a=math.constrain(a,.9,1.1),mySketch.gs.transform.ySpace*=a,mySketch.gs.transform.xSpace*=a,mySketch.gs.transform.reformYspace(),mySketch.gs.transform.reformXspace(),M.increment=i*s}mySketch.gs.transform.onchange(!0),mySketch.update(),o([`*${(mySketch.gs.jVector.mag/M.jVector.mag).toFixed(2)}`])}}();break;case"rotate-axises":!function(e){if("x"==M.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=angles.snapAngle(M.angle-t,[0,Math.PI]);let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("y"==M.axis){if(math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.yAngle=angles.snapAngle(M.angle-t,[Math.PI/2,3*Math.PI/2]);let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle.toFixed(2))}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}else if("xy"==M.axis&&math.dist(mySketch.gs.center.x,mySketch.gs.center.y,C.x,C.y)>10){let e=M.mouse,t=angles.angle(M.mouse.subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)),new vector(C.x,C.y).subtract(new vector(mySketch.gs.center.x,mySketch.gs.center.y)));if(t=angles.constrainAngle(t),!isNaN(t)){mySketch.gs.transform.xAngle=M.xAngle-t,mySketch.gs.transform.yAngle=M.yAngle-t;let s=mySketch.gs.center;e=s.add(M.mouse.subtract(s).rotate(t))}mySketch.gs.transform.invokeOnchange=!0,mySketch.gs.transform.onchange(),mySketch.update(),o([`xAngle: ${angles.stringDegAngle(mySketch.gs.transform.xAngle)}`,`yAngle: ${angles.stringDegAngle(mySketch.gs.transform.yAngle)}`,`rotationAngle: ${angles.stringDegAngle(-t)}`])}}();break;case"zoom":!function(e){let t={xmin:M.mouse.x,ymin:M.mouse.y,xmax:C.x,ymax:C.y};M.pxViewport.xmin=Math.min(t.xmin,t.xmax),M.pxViewport.ymin=Math.min(t.ymin,t.ymax),M.pxViewport.xmax=Math.max(t.xmin,t.xmax),M.pxViewport.ymax=Math.max(t.ymin,t.ymax),M.pxViewport.width=M.pxViewport.xmax-M.pxViewport.xmin,M.pxViewport.height=M.pxViewport.ymax-M.pxViewport.ymin,t=M.pxViewport,t.width<10&&t.height<10&&(t.width=0,t.height=0);if(document.querySelector("#subtools-zoom-rr").checked||e.shiftKey){let e=angles.minAngle(vector.fromAngle(0),new vector(mySketch.gs.width,mySketch.gs.height)),i=s.lineEquation(e,M.mouse),a=s.projectionToLine(new vector(C.x,C.y),i);t={xmin:M.mouse.x,ymin:M.mouse.y,xmax:Math.round(a.x),ymax:Math.round(a.y)},M.pxViewport.xmin=Math.min(t.xmin,t.xmax),M.pxViewport.ymin=Math.min(t.ymin,t.ymax),M.pxViewport.xmax=Math.max(t.xmin,t.xmax),M.pxViewport.ymax=Math.max(t.ymin,t.ymax),M.pxViewport.width=M.pxViewport.xmax-M.pxViewport.xmin,M.pxViewport.height=M.pxViewport.ymax-M.pxViewport.ymin,t=M.pxViewport}else M.boxElt.classList.remove("v"),M.boxElt.classList.remove("h"),t.height<10&&t.width>10?(M.boxElt.classList.add("v"),t.ymin=0,t.ymax=mySketch.gs.height,t.height=mySketch.gs.height):t.height>10&&t.width<10&&(M.boxElt.classList.add("h"),t.xmin=0,t.xmax=mySketch.gs.width,t.width=mySketch.gs.width);let i=mySketch.coor.coorSettings.background.isDark()?"#fff5":"#0005";M.boxElt.setAttribute("style",`--left: ${t.xmin}px; --top: ${t.ymin}px; --width: ${t.width}px; --height: ${t.height}px; --background: ${i}`)}(t)}t.preventDefault()}};function n(e){let t={left:0,top:0};return e.offsetParent&&(t=n(e.offsetParent)),{left:e.offsetLeft+t.left,top:e.offsetTop+t.top}}window.addEventListener("mousemove",a,!0),window.addEventListener("touchmove",a,{passive:!1,capture:!0});let r=s=>{if(e)if(e=!1,"move"===M.type){for(clearInterval(t),C.vel=new vector(C.vel.x,C.vel.y);C.vel.mag>50;)C.vel=C.vel.mult(.9);t=setInterval(()=>{C.vel.mag>1&&(C.vel=C.vel.mult(.9)),mySketch.gs.transform.translate(C.vel),mySketch.update(),C.vel.mag<=1&&clearInterval(t)},10)}else M.type.search("axises")>-1?("x"==M.axis?mySketch.coor.coorSettings.penXaxis.color=M.penColor:"y"==M.axis?mySketch.coor.coorSettings.penYaxis.color=M.penColor:"xy"==M.axis&&(mySketch.coor.coorSettings.penXaxis.color=M.xPenColor,mySketch.coor.coorSettings.penYaxis.color=M.yPenColor),mySketch.draw()):"zoom"===M.type&&(M.boxElt.remove(),M.pxViewport.width&&M.pxViewport.height&&(mySketch.gs.transform.transformOrigin=void 0,mySketch.gs.transform.setViewport(mySketch.gs.transform.getViewport(M.pxViewport))),o(["x: {",`  xmin: ${mySketch.gs.viewport.xmin},`,`  xmax: ${mySketch.gs.viewport.xmax}`,"},","y: {",`  ymin: ${mySketch.gs.viewport.ymin},`,`  ymax: ${mySketch.gs.viewport.ymax}`,"}"]),mySketch.update())};function o(e){let t='<div class="subtools-details">';for(let s of e)t+="<p>"+s+"</p>";t+="</div>",M.details.setContent(t),M.details.show()}window.addEventListener("mouseup",r),window.addEventListener("touchend",r),canvasParent.addEventListener("mousewheel",e=>{e.preventDefault();let t=n(canvas.elt);C.x=e.clientX-t.left,C.y=e.clientY-t.top;let s=mySketch.gs.center,i=C;MathPackage.Core.dist(C.x,C.y,s.x,s.y)<30&&(i=s),e.wheelDelta>0?(mySketch.gs.transform.zoomIn(new vector(i.x,i.y)),mySketch.update()):(mySketch.gs.transform.zoomOut(new vector(i.x,i.y)),mySketch.update())})}function z(){window.addEventListener("resize",E),window.addEventListener("mouseup",(function(e){A.mouseDownForInterval&&(A.mouseDownForInterval=!1,clearInterval(A.backspaceInterval)),A.hideKeyPad=!0})),window.addEventListener("touchend",(function(e){A.mouseDownForInterval&&(A.mouseDownForInterval=!1,clearInterval(A.backspaceInterval)),A.hideKeyPad=!0})),window.addEventListener("mousedown",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(A.showHideKeyBtn.className);A.hideKeyPad&&t&&A.showHideKeyBtn.click()})),window.addEventListener("touchstart",(function(e){let t=/\svisible\s|^visible\s|\svisible$/.test(A.showHideKeyBtn.className);A.hideKeyPad&&t&&A.showHideKeyBtn.click()})),document.querySelector("#add-new-control").addEventListener("click",e=>{O(new x)}),document.querySelector("#show-hide-sidebar").addEventListener("click",(function(e){let t=$(this),s=t.hasClass("visible"),i=s?"visible":"unvisible",a=s?"unvisible":"visible";s?document.body.querySelector(".app-container").appendChild(this):_.querySelector(".header").append(this),t.removeClass(i),t.addClass(a),_.classList.remove(i),_.classList.add(a),E()})),q(),function(){let e=e=>{setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update()),setTimeout(()=>{"in"==e?(mySketch.gs.transform.zoomIn(),mySketch.update()):(mySketch.gs.transform.zoomOut(),mySketch.update())},20)},20)},20)},20)},20)},20)},20)})};document.querySelector("#zoom-in-btn").addEventListener("click",()=>{e("in")}),document.querySelector("#zoom-out-btn").addEventListener("click",()=>{e("out")}),document.querySelectorAll('.subtools-container input[type*="radio"]').forEach(e=>{M.type=e.checked?e.dataset.type:M.type,e.addEventListener("change",()=>{M.type=e.checked?e.dataset.type:M.type})}),document.querySelector("#home").addEventListener("click",()=>{mySketch.gs.reset(),mySketch.update()}),document.querySelector("#centrate").addEventListener("click",()=>{mySketch.gs.centrate(),mySketch.update()})}()}function I(){A.showHideKeyBtn.addEventListener("click",(function(e){/\svisible\s|^visible\s|\svisible$/.test(_.className)||document.querySelector("#show-hide-sidebar").click();let t=document.querySelector(".keypad-container"),s=$(this).hasClass("visible"),i=s?"visible":"unvisible",a=s?"unvisible":"visible";A.showHideKeyBtn.classList.remove(i),A.showHideKeyBtn.classList.add(a),t.classList.remove(i),t.classList.add(a),s?document.body.querySelector(".app-container").appendChild(A.showHideKeyBtn):t.insertBefore(A.showHideKeyBtn,t.firstElementChild),V.smallScreen&&E(),A.focusedControl.focus()})),SUI.tabs(document.body.querySelector(".keypad-container .tabs-1")),function(){let e=$(".keypad-container"),t=$(A.showHideKeyBtn);e.bind("focusin",(function(){A.mathField.focus()})),$(document.body).delegate("[cancel-hiding-keypad]","mousedown touchstart",(function(e){A.hideKeyPad=!1})),$(".control").delegate(".main","touchstart",(function(e){t.hasClass("hide")&&t.click()})),$(".keypad-container .rows button[mq-cmd]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.cmd($(" > div.active > span.active",e).attr("mq-cmd")):e.hasClass("shiftable")?A.mathField.cmd($(" > span.active",e).attr("mq-cmd")):A.mathField.cmd(this.getAttribute("mq-cmd")),A.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-write]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.write($(" > div.active > span.active",e).attr("mq-write")):e.hasClass("shiftable")?A.mathField.write($(" > span.active",e).attr("mq-write")):A.mathField.write(this.getAttribute("mq-write")),A.focusedControl.focus()}))})),$(".keypad-container .rows button[mq-func]").each((function(e){$(this).on("click",(function(){let e=$(this);e.hasClass("double-shiftable")?A.mathField.write($(" > div.active > span.active",e).attr("mq-func")):e.hasClass("shiftable")?A.mathField.write($(" > span.active",e).attr("mq-func")):A.mathField.write(this.getAttribute("mq-func")),A.mathField.cmd("("),A.focusedControl.focus()}))})),$(".space").on("click",(function(){A.mathField.keystroke("Right")})),$(".backspace").on("mousedown",(function(){""==A.mathField.latex()?A.focusedControl.remove():A.mathField.keystroke("Backspace"),A.mouseDownForInterval=!0,setTimeout((function(){A.mouseDownForInterval&&(A.backspaceInterval=setInterval((function(){A.mathField.keystroke("Backspace")}),120))}),400)})),$(".go-left").on("click",(function(){A.mathField.keystroke("Left")})),$(".go-right").on("click",(function(){A.mathField.keystroke("Right")})),$(".go-up").on("click",(function(){A.mathField.keystroke("Up")})),$(".go-down").on("click",(function(){A.mathField.keystroke("Down")})),$(".enter").on("click",(function(){O(new x,parseInt(A.focusedControl.orderELT.textContent))})),$(".shift").on("click",(function(){let e=$(this),t=e.parents(".rows");if(e.hasClass("active"))e.removeClass("active"),e.addClass("lock"),t.removeClass("shift-active"),t.addClass("shift-lock");else if(e.hasClass("lock")){$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.removeClass("lock"),t.removeClass("shift-lock")}else{$(".shiftable > span, .double-shiftable > div > span",t).toggleClass("active"),e.addClass("active"),t.addClass("shift-active")}})),$(".keypad-container .rows button").not(".shift, .double-shift").on("click",(function(){let e=$(this).parents(".rows");if(e.hasClass("shift-active")){let t=$("button.shift",e);$(".shiftable > span, .double-shiftable > div > span",e).toggleClass("active"),t.removeClass("active"),e.removeClass("shift-active")}})),$(".double-shift").on("click",(function(){let e=$(this);$(".double-shiftable > div",e.parents(".rows")).toggleClass("active"),e.toggleClass("active")}))}()}function F(e){window.MP=MathPackage,window.angles=MP.Angles,window.lines=MP.Lines,window.math=MP.Core,window.drawing=l,window.vector=MP.entities.Vector,window.MQ=MathQuill.getInterface(2),MQ.config({sumStartsWithNEquals:!0,supSubsRequireOperand:!0,autoSubscriptNumerals:!0,autoCommands:"pi theta sqrt abs floor ceil round random sum int prod",maxDepth:10}),window.mySketch=new b(e),window.canvas=mySketch.canvas,window.canvasParent=e,E.prevSize={width:1e3,height:1e3},V(),E.prevSize={width:window.innerWidth,height:window.innerHeight};let t=$(".math-field");for(let e=0;e<t.length;e++)MQ.StaticMath(t[e]);let s=$('\n      <li class="control">\n        <div class="side-status" cancel-move>\n          <div class="order-container">\n            <span class=\'order\'>123</span>\n          </div>\n        </div>\n        <div class="main" cancel-move cancel-hiding-keypad>\n          <div class=script-container><span type="text" class="script">NEW</span></div>\n        </div>\n        <div class="side-ctrl">\n          <button class="closebtn-2 remove" cancel-move><div class="inner"></div></button>\n          <span class="move">\n            <div>\n              <span>..</span>\n              <span>..</span>\n              <span>..</span>\n            </div>\n          </span>\n        </div>\n      </li>\n      ')[0];document.body.querySelector("#add-new-control").append(s),z(),I(),function(){var e=_.querySelector(".resizer");let t={};$(e).draggable({axis:"x",containment:L(_),start:s=>{e.classList.add("dragging"),t.intialWidth=_.clientWidth,t.intialOffset=s.pageX,t.cursor=document.body.style.cursor,document.body.style.cursor="e-resize"},stop:()=>{e.classList.remove("dragging"),_.style.flexBasis=e.style.left,document.body.style.cursor=t.cursor},drag:()=>{_.style.flexBasis=e.style.left,E(!1)}})}(),function(){var e=document.querySelector(".outer-controls"),t=e.querySelector(".inner-controls");let s=!0;$(".controls.sortable").sortable({axis:"y",cancel:".control [cancel-move]",start:function(i,a){s=!0,e.classList.add("sorting"),t.clientHeight>e.clientHeight&&(e.style.overflowY="scroll"),a.item[0].classList.add("dragging");let n=a.item[0].getAttribute("id");for(let e in mySketch.children)e.id!==n||e.focus()},stop:function(t,i){s?(e.classList.remove("sorting"),e.style.overflowY="auto",i.item[0].classList.remove("dragging")):s=!1},update:function(){P()}}),$(".controls.sortable").disableSelection()}(),E(),mySketch.gs.centrate(),mySketch.update(),console.log("%cPLOTTO","background: black; color: white; font: 50px consolas;"),console.log("%cWe are sciCave","color: blue; font: 25px consolas;"),O(new x)}return F(document.querySelector("#canvas-parent")),F}));
>>>>>>> 799267a896bc398cdad6e65a4b8870f1834e4cbd
//# sourceMappingURL=app.js.map
